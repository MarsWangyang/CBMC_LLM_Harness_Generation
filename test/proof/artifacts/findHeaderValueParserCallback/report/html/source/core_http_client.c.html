
<html>
<head>
<title>source/core_http_client.c</title>
<link rel="stylesheet" type="text/css" href="../viewer.css">
</head>

<body>
<div class="code">
<div id="1" class="line none">    1 /*</div><div id="2" class="line none">    2  * coreHTTP v3.1.1</div><div id="3" class="line none">    3  * Copyright (C) 2024 Amazon.com, Inc. or its affiliates.  All Rights Reserved.</div><div id="4" class="line none">    4  *</div><div id="5" class="line none">    5  * SPDX-License-Identifier: MIT</div><div id="6" class="line none">    6  *</div><div id="7" class="line none">    7  * Permission is hereby granted, free of charge, to any person obtaining a copy of</div><div id="8" class="line none">    8  * this software and associated documentation files (the "Software"), to deal in</div><div id="9" class="line none">    9  * the Software without restriction, including without limitation the rights to</div><div id="10" class="line none">   10  * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</div><div id="11" class="line none">   11  * the Software, and to permit persons to whom the Software is furnished to do so,</div><div id="12" class="line none">   12  * subject to the following conditions:</div><div id="13" class="line none">   13  *</div><div id="14" class="line none">   14  * The above copyright notice and this permission notice shall be included in all</div><div id="15" class="line none">   15  * copies or substantial portions of the Software.</div><div id="16" class="line none">   16  *</div><div id="17" class="line none">   17  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</div><div id="18" class="line none">   18  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS</div><div id="19" class="line none">   19  * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR</div><div id="20" class="line none">   20  * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</div><div id="21" class="line none">   21  * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</div><div id="22" class="line none">   22  * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</div><div id="23" class="line none">   23  */</div><div id="24" class="line none">   24 </div><div id="25" class="line none">   25 /**</div><div id="26" class="line none">   26  * @file core_http_client.c</div><div id="27" class="line none">   27  * @brief Implements the user-facing functions in core_http_client.h.</div><div id="28" class="line none">   28  */</div><div id="29" class="line none">   29 #include &lt;assert.h&gt;</div><div id="30" class="line none">   30 #include &lt;string.h&gt;</div><div id="31" class="line none">   31 #include &lt;ctype.h&gt;</div><div id="32" class="line none">   32 </div><div id="33" class="line none">   33 #include "core_http_client.h"</div><div id="34" class="line none">   34 #include "core_http_client_private.h"</div><div id="35" class="line none">   35 </div><div id="36" class="line none">   36 /*-----------------------------------------------------------*/</div><div id="37" class="line none">   37 </div><div id="38" class="line none">   38 /**</div><div id="39" class="line none">   39  * @brief When #HTTPResponse_t.getTime is set to NULL in #HTTPClient_Send then</div><div id="40" class="line none">   40  * this function will replace that field.</div><div id="41" class="line none">   41  *</div><div id="42" class="line none">   42  * @return This function always returns zero.</div><div id="43" class="line none">   43  */</div><div id="44" class="line none">   44 static uint32_t <a href="core_http_client.c.html#523">getZeroTimestampMs</a>( void );</div><div id="45" class="line none">   45 </div><div id="46" class="line none">   46 /**</div><div id="47" class="line none">   47  * @brief Adds the Content-Length header field and value to the</div><div id="48" class="line none">   48  * @p pRequestHeaders.</div><div id="49" class="line none">   49  *</div><div id="50" class="line none">   50  * @param[in] pRequestHeaders Request header buffer information.</div><div id="51" class="line none">   51  * @param[in] contentLength The Content-Length header value to write.</div><div id="52" class="line none">   52  *</div><div id="53" class="line none">   53  * @return #HTTPSuccess if successful. If there was insufficient memory in the</div><div id="54" class="line none">   54  * application buffer, then #HTTPInsufficientMemory is returned.</div><div id="55" class="line none">   55  */</div><div id="56" class="line none">   56 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1894">addContentLengthHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="57" class="line none">   57                                             size_t <a href="include/core_http_client.h.html#554">contentLength</a> );</div><div id="58" class="line none">   58 </div><div id="59" class="line none">   59 /**</div><div id="60" class="line none">   60  * @brief Send the HTTP body over the transport send interface.</div><div id="61" class="line none">   61  *</div><div id="62" class="line none">   62  * @param[in] pTransport Transport interface.</div><div id="63" class="line none">   63  * @param[in] getTimestampMs Function to retrieve a timestamp in milliseconds.</div><div id="64" class="line none">   64  * @param[in] pRequestBodyBuf Request body buffer.</div><div id="65" class="line none">   65  * @param[in] reqBodyBufLen Length of the request body buffer.</div><div id="66" class="line none">   66  *</div><div id="67" class="line none">   67  * @return #HTTPSuccess if successful. If there was a network error or less</div><div id="68" class="line none">   68  * bytes than what was specified were sent, then #HTTPNetworkError is</div><div id="69" class="line none">   69  * returned.</div><div id="70" class="line none">   70  */</div><div id="71" class="line none">   71 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1964">sendHttpBody</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="72" class="line none">   72                                   <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="73" class="line none">   73                                   const uint8_t * pRequestBodyBuf,</div><div id="74" class="line none">   74                                   size_t reqBodyBufLen );</div><div id="75" class="line none">   75 </div><div id="76" class="line none">   76 /**</div><div id="77" class="line none">   77  * @brief A strncpy replacement with HTTP header validation.</div><div id="78" class="line none">   78  *</div><div id="79" class="line none">   79  * This function checks for `\r` and `\n` in the @p pSrc while copying.</div><div id="80" class="line none">   80  * This function checks for `:` in the @p pSrc, if @p isField is set to 1.</div><div id="81" class="line none">   81  *</div><div id="82" class="line none">   82  * @param[in] pDest The destination buffer to copy to.</div><div id="83" class="line none">   83  * @param[in] pSrc The source buffer to copy from.</div><div id="84" class="line none">   84  * @param[in] len The length of @p pSrc to copy to pDest.</div><div id="85" class="line none">   85  * @param[in] isField Set to 0 to indicate that @p pSrc is a field. Set to 1 to</div><div id="86" class="line none">   86  * indicate that @p pSrc is a value.</div><div id="87" class="line none">   87  *</div><div id="88" class="line none">   88  * @return @p pDest if the copy was successful, NULL otherwise.</div><div id="89" class="line none">   89  */</div><div id="90" class="line none">   90 static char * <a href="core_http_client.c.html#1293">httpHeaderStrncpy</a>( char * pDest,</div><div id="91" class="line none">   91                                  const char * pSrc,</div><div id="92" class="line none">   92                                  size_t len,</div><div id="93" class="line none">   93                                  uint8_t isField );</div><div id="94" class="line none">   94 </div><div id="95" class="line none">   95 /**</div><div id="96" class="line none">   96  * @brief Write header based on parameters. This method also adds a trailing</div><div id="97" class="line none">   97  * "\r\n". If a trailing "\r\n" already exists in the HTTP header, this method</div><div id="98" class="line none">   98  * backtracks in order to write over it and updates the length accordingly.</div><div id="99" class="line none">   99  *</div><div id="100" class="line none">  100  * @param[in] pRequestHeaders Request header buffer information.</div><div id="101" class="line none">  101  * @param[in] pField The ISO 8859-1 encoded header field name to write.</div><div id="102" class="line none">  102  * @param[in] fieldLen The byte length of the header field name.</div><div id="103" class="line none">  103  * @param[in] pValue The ISO 8859-1 encoded header value to write.</div><div id="104" class="line none">  104  * @param[in] valueLen The byte length of the header field value.</div><div id="105" class="line none">  105  *</div><div id="106" class="line none">  106  * @return #HTTPSuccess if successful. If there was insufficient memory in the</div><div id="107" class="line none">  107  * application buffer, then #HTTPInsufficientMemory is returned.</div><div id="108" class="line none">  108  */</div><div id="109" class="line none">  109 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1342">addHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="110" class="line none">  110                                const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="111" class="line none">  111                                size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="112" class="line none">  112                                const char * pValue,</div><div id="113" class="line none">  113                                size_t valueLen );</div><div id="114" class="line none">  114 </div><div id="115" class="line none">  115 /**</div><div id="116" class="line none">  116  * @brief Add the byte range request header to the request headers store in</div><div id="117" class="line none">  117  * #HTTPRequestHeaders_t.pBuffer once all the parameters are validated.</div><div id="118" class="line none">  118  *</div><div id="119" class="line none">  119  * @param[in] pRequestHeaders Request header buffer information.</div><div id="120" class="line none">  120  * @param[in] rangeStartOrlastNbytes Represents either the starting byte</div><div id="121" class="line none">  121  * for a range OR the last N number of bytes in the requested file.</div><div id="122" class="line none">  122  * @param[in] rangeEnd The ending range for the requested file. For end of file</div><div id="123" class="line none">  123  * byte in Range Specifications 2. and 3., #HTTP_RANGE_REQUEST_END_OF_FILE</div><div id="124" class="line none">  124  * should be passed.</div><div id="125" class="line none">  125  *</div><div id="126" class="line none">  126  * @return #HTTPSuccess if successful. If there was insufficient memory in the</div><div id="127" class="line none">  127  * application buffer, then #HTTPInsufficientMemory is returned.</div><div id="128" class="line none">  128  */</div><div id="129" class="line none">  129 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1442">addRangeHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="130" class="line none">  130                                     int32_t rangeStartOrlastNbytes,</div><div id="131" class="line none">  131                                     int32_t rangeEnd );</div><div id="132" class="line none">  132 </div><div id="133" class="line none">  133 /**</div><div id="134" class="line none">  134  * @brief Get the status of the HTTP response given the parsing state and how</div><div id="135" class="line none">  135  * much data is in the response buffer.</div><div id="136" class="line none">  136  *</div><div id="137" class="line none">  137  * @param[in] parsingState State of the parsing on the HTTP response.</div><div id="138" class="line none">  138  * @param[in] totalReceived The amount of network data received in the response</div><div id="139" class="line none">  139  * buffer.</div><div id="140" class="line none">  140  * @param[in] responseBufferLen The length of the response buffer.</div><div id="141" class="line none">  141  *</div><div id="142" class="line none">  142  * @return Returns #HTTPSuccess if the parsing state is complete. If</div><div id="143" class="line none">  143  * the parsing state denotes it never started, then return #HTTPNoResponse. If</div><div id="144" class="line none">  144  * the parsing state is incomplete, then if the response buffer is not full</div><div id="145" class="line none">  145  * #HTTPPartialResponse is returned. If the parsing state is incomplete, then</div><div id="146" class="line none">  146  * if the response buffer is full #HTTPInsufficientMemory is returned.</div><div id="147" class="line none">  147  */</div><div id="148" class="line none">  148 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1985">getFinalResponseStatus</a>( <a href="include/core_http_client_private.h.html#215">HTTPParsingState_t</a> parsingState,</div><div id="149" class="line none">  149                                             size_t totalReceived,</div><div id="150" class="line none">  150                                             size_t responseBufferLen );</div><div id="151" class="line none">  151 </div><div id="152" class="line none">  152 /**</div><div id="153" class="line none">  153  * @brief Send the HTTP request over the network.</div><div id="154" class="line none">  154  *</div><div id="155" class="line none">  155  * @param[in] pTransport Transport interface.</div><div id="156" class="line none">  156  * @param[in] getTimestampMs Function to retrieve a timestamp in milliseconds.</div><div id="157" class="line none">  157  * @param[in] pRequestHeaders Request headers to send over the network.</div><div id="158" class="line none">  158  * @param[in] pRequestBodyBuf Request body buffer to send over the network.</div><div id="159" class="line none">  159  * @param[in] reqBodyBufLen Length of the request body buffer.</div><div id="160" class="line none">  160  * @param[in] sendFlags Application provided flags to #HTTPClient_Send.</div><div id="161" class="line none">  161  *</div><div id="162" class="line none">  162  * @return Returns #HTTPSuccess if successful. Please see #HTTPClient_SendHttpHeaders and</div><div id="163" class="line none">  163  * #sendHttpBody for other statuses returned.</div><div id="164" class="line none">  164  */</div><div id="165" class="line none">  165 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2166">sendHttpRequest</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="166" class="line none">  166                                      <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="167" class="line none">  167                                      <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="168" class="line none">  168                                      const uint8_t * pRequestBodyBuf,</div><div id="169" class="line none">  169                                      size_t reqBodyBufLen,</div><div id="170" class="line none">  170                                      uint32_t sendFlags );</div><div id="171" class="line none">  171 </div><div id="172" class="line none">  172 /**</div><div id="173" class="line none">  173  * @brief Converts an integer value to its ASCII representation in the passed</div><div id="174" class="line none">  174  * buffer.</div><div id="175" class="line none">  175  *</div><div id="176" class="line none">  176  * @param[in] value The value to convert to ASCII.</div><div id="177" class="line none">  177  * @param[out] pBuffer The buffer to store the ASCII representation of the</div><div id="178" class="line none">  178  * integer.</div><div id="179" class="line none">  179  * @param[in] bufferLength The length of pBuffer.</div><div id="180" class="line none">  180  *</div><div id="181" class="line none">  181  * @return Returns the number of bytes written to @p pBuffer.</div><div id="182" class="line none">  182  */</div><div id="183" class="line none">  183 static uint8_t <a href="core_http_client.c.html#1238">convertInt32ToAscii</a>( int32_t value,</div><div id="184" class="line none">  184                                     char * <a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="185" class="line none">  185                                     size_t bufferLength );</div><div id="186" class="line none">  186 </div><div id="187" class="line none">  187 /**</div><div id="188" class="line none">  188  * @brief This method writes the request line (first line) of the HTTP Header</div><div id="189" class="line none">  189  * into #HTTPRequestHeaders_t.pBuffer and updates length accordingly.</div><div id="190" class="line none">  190  *</div><div id="191" class="line none">  191  * @param pRequestHeaders Request header buffer information.</div><div id="192" class="line none">  192  * @param pMethod The HTTP request method e.g. "GET", "POST", "PUT", or "HEAD".</div><div id="193" class="line none">  193  * @param methodLen The byte length of the request method.</div><div id="194" class="line none">  194  * @param pPath The Request-URI to the objects of interest, e.g. "/path/to/item.txt".</div><div id="195" class="line none">  195  * @param pathLen The byte length of the request path.</div><div id="196" class="line none">  196  *</div><div id="197" class="line none">  197  * @return #HTTPSuccess if successful. If there was insufficient memory in the</div><div id="198" class="line none">  198  * application buffer, then #HTTPInsufficientMemory is returned.</div><div id="199" class="line none">  199  */</div><div id="200" class="line none">  200 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1513">writeRequestLine</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="201" class="line none">  201                                       const char * <a href="include/core_http_client.h.html#400">pMethod</a>,</div><div id="202" class="line none">  202                                       size_t <a href="include/core_http_client.h.html#401">methodLen</a>,</div><div id="203" class="line none">  203                                       const char * <a href="include/core_http_client.h.html#406">pPath</a>,</div><div id="204" class="line none">  204                                       size_t <a href="include/core_http_client.h.html#407">pathLen</a> );</div><div id="205" class="line none">  205 </div><div id="206" class="line none">  206 /**</div><div id="207" class="line none">  207  * @brief Find the specified header field in the response buffer.</div><div id="208" class="line none">  208  *</div><div id="209" class="line none">  209  * @param[in] pBuffer The response buffer to parse.</div><div id="210" class="line none">  210  * @param[in] bufferLen The length of the response buffer to parse.</div><div id="211" class="line none">  211  * @param[in] pField The header field to search for.</div><div id="212" class="line none">  212  * @param[in] fieldLen The length of pField.</div><div id="213" class="line none">  213  * @param[out] pValueLoc The location of the the header value found in pBuffer.</div><div id="214" class="line none">  214  * @param[out] pValueLen The length of pValue.</div><div id="215" class="line none">  215  *</div><div id="216" class="line none">  216  * @return One of the following:</div><div id="217" class="line none">  217  * - #HTTPSuccess when header is found in the response.</div><div id="218" class="line none">  218  * - #HTTPHeaderNotFound if requested header is not found in response.</div><div id="219" class="line none">  219  * - #HTTPInvalidResponse if passed response is invalid for parsing.</div><div id="220" class="line none">  220  * - #HTTPParserInternalError for any parsing errors.</div><div id="221" class="line none">  221  */</div><div id="222" class="line none">  222 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2445">findHeaderInResponse</a>( const uint8_t * <a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="223" class="line none">  223                                           size_t <a href="include/core_http_client.h.html#381">bufferLen</a>,</div><div id="224" class="line none">  224                                           const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="225" class="line none">  225                                           size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="226" class="line none">  226                                           const char ** <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="227" class="line none">  227                                           size_t * <a href="include/core_http_client_private.h.html#227">pValueLen</a> );</div><div id="228" class="line none">  228 </div><div id="229" class="line none">  229 /**</div><div id="230" class="line none">  230  * @brief The "on_header_field" callback for the HTTP parser used by the</div><div id="231" class="line none">  231  * #findHeaderInResponse function. The callback checks whether the parser</div><div id="232" class="line none">  232  * header field matched the header being searched for, and sets a flag to</div><div id="233" class="line none">  233  * represent reception of the header accordingly.</div><div id="234" class="line none">  234  *</div><div id="235" class="line none">  235  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="236" class="line none">  236  * @param[in] pFieldLoc The location of the parsed header field in the response</div><div id="237" class="line none">  237  * buffer.</div><div id="238" class="line none">  238  * @param[in] fieldLen The length of the header field.</div><div id="239" class="line none">  239  *</div><div id="240" class="line none">  240  * @return Returns #LLHTTP_CONTINUE_PARSING to indicate continuation with</div><div id="241" class="line none">  241  * parsing.</div><div id="242" class="line none">  242  */</div><div id="243" class="line none">  243 static int <a href="core_http_client.c.html#2312">findHeaderFieldParserCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="244" class="line none">  244                                           const char * pFieldLoc,</div><div id="245" class="line none">  245                                           size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a> );</div><div id="246" class="line none">  246 </div><div id="247" class="line none">  247 /**</div><div id="248" class="line none">  248  * @brief The "on_header_value" callback for the HTTP parser used by the</div><div id="249" class="line none">  249  * #findHeaderInResponse function. The callback sets the user-provided output</div><div id="250" class="line none">  250  * parameters for header value if the requested header's field was found in the</div><div id="251" class="line none">  251  * @ref findHeaderFieldParserCallback function.</div><div id="252" class="line none">  252  *</div><div id="253" class="line none">  253  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="254" class="line none">  254  * @param[in] pValueLoc The location of the parsed header value in the response</div><div id="255" class="line none">  255  * buffer.</div><div id="256" class="line none">  256  * @param[in] valueLen The length of the header value.</div><div id="257" class="line none">  257  *</div><div id="258" class="line none">  258  * @return Returns #LLHTTP_STOP_PARSING, if the header field/value pair are</div><div id="259" class="line none">  259  * found, otherwise #LLHTTP_CONTINUE_PARSING is returned.</div><div id="260" class="line none">  260  */</div><div id="261" class="line none">  261 static int <a href="core_http_client.c.html#2354">findHeaderValueParserCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="262" class="line none">  262                                           const char * <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="263" class="line none">  263                                           size_t valueLen );</div><div id="264" class="line none">  264 </div><div id="265" class="line none">  265 /**</div><div id="266" class="line none">  266  * @brief The "on_header_complete" callback for the HTTP parser used by the</div><div id="267" class="line none">  267  * #findHeaderInResponse function.</div><div id="268" class="line none">  268  *</div><div id="269" class="line none">  269  * This callback will only be invoked if the requested header is not found in</div><div id="270" class="line none">  270  * the response. This callback is used to signal the parser to halt execution</div><div id="271" class="line none">  271  * if the requested header is not found.</div><div id="272" class="line none">  272  *</div><div id="273" class="line none">  273  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="274" class="line none">  274  *</div><div id="275" class="line none">  275  * @return Returns #LLHTTP_STOP_PARSING_NO_HEADER for the parser to halt further</div><div id="276" class="line none">  276  * execution, as all headers have been parsed in the response.</div><div id="277" class="line none">  277  */</div><div id="278" class="line none">  278 static int <a href="core_http_client.c.html#2413">findHeaderOnHeaderCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="279" class="line none">  279 </div><div id="280" class="line none">  280 </div><div id="281" class="line none">  281 /**</div><div id="282" class="line none">  282  * @brief Initialize the parsing context for parsing a response fresh from the</div><div id="283" class="line none">  283  * server.</div><div id="284" class="line none">  284  *</div><div id="285" class="line none">  285  * @param[in] pParsingContext The parsing context to initialize.</div><div id="286" class="line none">  286  * @param[in] pRequestHeaders Request headers for the corresponding HTTP request.</div><div id="287" class="line none">  287  */</div><div id="288" class="line none">  288 static void <a href="core_http_client.c.html#1000">initializeParsingContextForFirstResponse</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext,</div><div id="289" class="line none">  289                                                       const <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders );</div><div id="290" class="line none">  290 </div><div id="291" class="line none">  291 /**</div><div id="292" class="line none">  292  * @brief Parses the response buffer in @p pResponse.</div><div id="293" class="line none">  293  *</div><div id="294" class="line none">  294  * This function may be invoked multiple times for different parts of the the</div><div id="295" class="line none">  295  * HTTP response. The state of what was last parsed in the response is kept in</div><div id="296" class="line none">  296  * @p pParsingContext.</div><div id="297" class="line none">  297  *</div><div id="298" class="line none">  298  * @param[in,out] pParsingContext The response parsing state.</div><div id="299" class="line none">  299  * @param[in,out] pResponse The response information to be updated.</div><div id="300" class="line none">  300  * @param[in] parseLen The next length to parse in pResponse-&gt;pBuffer.</div><div id="301" class="line none">  301  *</div><div id="302" class="line none">  302  * @return One of the following:</div><div id="303" class="line none">  303  * - #HTTPSuccess</div><div id="304" class="line none">  304  * - #HTTPInvalidParameter</div><div id="305" class="line none">  305  * - Please see #processLlhttpError for parsing errors returned.</div><div id="306" class="line none">  306  */</div><div id="307" class="line none">  307 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1161">parseHttpResponse</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext,</div><div id="308" class="line none">  308                                        <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="309" class="line none">  309                                        size_t parseLen );</div><div id="310" class="line none">  310 </div><div id="311" class="line none">  311 /**</div><div id="312" class="line none">  312  * @brief Callback invoked during llhttp_execute() to indicate the start of</div><div id="313" class="line none">  313  * the HTTP response message.</div><div id="314" class="line none">  314  *</div><div id="315" class="line none">  315  * This callback is invoked when an "H" in the "HTTP/1.1" that starts a response</div><div id="316" class="line none">  316  * is found.</div><div id="317" class="line none">  317  *</div><div id="318" class="line none">  318  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="319" class="line none">  319  *</div><div id="320" class="line none">  320  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="321" class="line none">  321  */</div><div id="322" class="line none">  322 static int <a href="core_http_client.c.html#617">httpParserOnMessageBeginCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="323" class="line none">  323 </div><div id="324" class="line none">  324 /**</div><div id="325" class="line none">  325  * @brief Callback invoked during llhttp_execute() when the HTTP response</div><div id="326" class="line none">  326  * status-code and its associated reason-phrase are found.</div><div id="327" class="line none">  327  *</div><div id="328" class="line none">  328  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="329" class="line none">  329  * @param[in] pLoc Location of the HTTP response reason-phrase string in the</div><div id="330" class="line none">  330  * response message buffer.</div><div id="331" class="line none">  331  * @param[in] length Length of the HTTP response status code string.</div><div id="332" class="line none">  332  *</div><div id="333" class="line none">  333  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="334" class="line none">  334  */</div><div id="335" class="line none">  335 static int <a href="core_http_client.c.html#636">httpParserOnStatusCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="336" class="line none">  336                                        const char * pLoc,</div><div id="337" class="line none">  337                                        size_t length );</div><div id="338" class="line none">  338 </div><div id="339" class="line none">  339 /**</div><div id="340" class="line none">  340  * @brief Callback invoked during llhttp_execute() when the HTTP response</div><div id="341" class="line none">  341  * status parsing is complete.</div><div id="342" class="line none">  342  *</div><div id="343" class="line none">  343  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="344" class="line none">  344  *</div><div id="345" class="line none">  345  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="346" class="line none">  346  */</div><div id="347" class="line none">  347 static int <a href="core_http_client.c.html#677">httpParserOnStatusCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="348" class="line none">  348 </div><div id="349" class="line none">  349 /**</div><div id="350" class="line none">  350  * @brief Callback invoked during llhttp_execute() when an HTTP response</div><div id="351" class="line none">  351  * header field is found.</div><div id="352" class="line none">  352  *</div><div id="353" class="line none">  353  * If only part of the header field was found, then parsing of the next part of</div><div id="354" class="line none">  354  * the response message will invoke this callback in succession.</div><div id="355" class="line none">  355  *</div><div id="356" class="line none">  356  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="357" class="line none">  357  * @param[in] pLoc Location of the header field string in the response</div><div id="358" class="line none">  358  * message buffer.</div><div id="359" class="line none">  359  * @param[in] length Length of the header field.</div><div id="360" class="line none">  360  *</div><div id="361" class="line none">  361  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="362" class="line none">  362  */</div><div id="363" class="line none">  363 static int <a href="core_http_client.c.html#709">httpParserOnHeaderFieldCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="364" class="line none">  364                                             const char * pLoc,</div><div id="365" class="line none">  365                                             size_t length );</div><div id="366" class="line none">  366 </div><div id="367" class="line none">  367 /**</div><div id="368" class="line none">  368  * @brief Callback invoked during llhttp_execute() when an HTTP response</div><div id="369" class="line none">  369  * header value is found.</div><div id="370" class="line none">  370  *</div><div id="371" class="line none">  371  * This header value corresponds to the header field that was found in the</div><div id="372" class="line none">  372  * immediately preceding httpParserOnHeaderFieldCallback().</div><div id="373" class="line none">  373  *</div><div id="374" class="line none">  374  * If only part of the header value was found, then parsing of the next part of</div><div id="375" class="line none">  375  * the response message will invoke this callback in succession.</div><div id="376" class="line none">  376  *</div><div id="377" class="line none">  377  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="378" class="line none">  378  * @param[in] pLoc Location of the header value in the response message buffer.</div><div id="379" class="line none">  379  * @param[in] length Length of the header value.</div><div id="380" class="line none">  380  *</div><div id="381" class="line none">  381  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="382" class="line none">  382  */</div><div id="383" class="line none">  383 static int <a href="core_http_client.c.html#766">httpParserOnHeaderValueCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="384" class="line none">  384                                             const char * pLoc,</div><div id="385" class="line none">  385                                             size_t length );</div><div id="386" class="line none">  386 </div><div id="387" class="line none">  387 /**</div><div id="388" class="line none">  388  * @brief Callback invoked during llhttp_execute() when the end of the</div><div id="389" class="line none">  389  * headers are found.</div><div id="390" class="line none">  390  *</div><div id="391" class="line none">  391  * The end of the headers is signaled in a HTTP response message by another</div><div id="392" class="line none">  392  * "\r\n" after the final header line.</div><div id="393" class="line none">  393  *</div><div id="394" class="line none">  394  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="395" class="line none">  395  *</div><div id="396" class="line none">  396  * @return #LLHTTP_CONTINUE_PARSING to continue parsing.</div><div id="397" class="line none">  397  * #LLHTTP_STOP_PARSING_NO_BODY is returned if the response is for a HEAD request.</div><div id="398" class="line none">  398  */</div><div id="399" class="line none">  399 static int <a href="core_http_client.c.html#810">httpParserOnHeadersCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="400" class="line none">  400 </div><div id="401" class="line none">  401 /**</div><div id="402" class="line none">  402  * @brief Callback invoked during llhttp_execute() when the HTTP response</div><div id="403" class="line none">  403  * body is found.</div><div id="404" class="line none">  404  *</div><div id="405" class="line none">  405  * If only part of the response body was found, then parsing of the next part of</div><div id="406" class="line none">  406  * the response message will invoke this callback in succession.</div><div id="407" class="line none">  407  *</div><div id="408" class="line none">  408  * This callback will be also invoked in succession if the response body is of</div><div id="409" class="line none">  409  * type "Transfer-Encoding: chunked". This callback will be invoked after each</div><div id="410" class="line none">  410  * chunk header.</div><div id="411" class="line none">  411  *</div><div id="412" class="line none">  412  * The follow is an example of a Transfer-Encoding chunked response:</div><div id="413" class="line none">  413  *</div><div id="414" class="line none">  414  * @code</div><div id="415" class="line none">  415  * HTTP/1.1 200 OK\r\n</div><div id="416" class="line none">  416  * Content-Type: text/plain\r\n</div><div id="417" class="line none">  417  * Transfer-Encoding: chunked\r\n</div><div id="418" class="line none">  418  * \r\n</div><div id="419" class="line none">  419  * d\r\n</div><div id="420" class="line none">  420  * Hello World! \r\n</div><div id="421" class="line none">  421  * 7\r\n</div><div id="422" class="line none">  422  * I am a \r\n</div><div id="423" class="line none">  423  * a\r\n</div><div id="424" class="line none">  424  * developer.\r\n</div><div id="425" class="line none">  425  * 0\r\n</div><div id="426" class="line none">  426  * \r\n</div><div id="427" class="line none">  427  * @endcode</div><div id="428" class="line none">  428  *</div><div id="429" class="line none">  429  * The first invocation of this callback will contain @p pLoc = "Hello World!"</div><div id="430" class="line none">  430  * and @p length = 13.</div><div id="431" class="line none">  431  * The second invocation of this callback will contain @p pLoc = "I am a " and</div><div id="432" class="line none">  432  * @p length = 7.</div><div id="433" class="line none">  433  * The third invocation of this callback will contain @p pLoc = "developer." and</div><div id="434" class="line none">  434  * @p length = 10.</div><div id="435" class="line none">  435  *</div><div id="436" class="line none">  436  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="437" class="line none">  437  * @param[in] pLoc - Pointer to the body string in the response message buffer.</div><div id="438" class="line none">  438  * @param[in] length - The length of the body found.</div><div id="439" class="line none">  439  *</div><div id="440" class="line none">  440  * @return Zero to continue parsing. All other return values will stop parsing</div><div id="441" class="line none">  441  * and llhttp_execute() will return with the same value.</div><div id="442" class="line none">  442  */</div><div id="443" class="line none">  443 static int <a href="core_http_client.c.html#909">httpParserOnBodyCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="444" class="line none">  444                                      const char * pLoc,</div><div id="445" class="line none">  445                                      size_t length );</div><div id="446" class="line none">  446 </div><div id="447" class="line none">  447 /**</div><div id="448" class="line none">  448  * @brief Callback invoked during llhttp_execute() to indicate the the</div><div id="449" class="line none">  449  * completion of an HTTP response message.</div><div id="450" class="line none">  450  *</div><div id="451" class="line none">  451  * When there is no response body, the end of the response message is when the</div><div id="452" class="line none">  452  * headers end. This is indicated by another "\r\n" after the final header line.</div><div id="453" class="line none">  453  *</div><div id="454" class="line none">  454  * When there is response body, the end of the response message is when the</div><div id="455" class="line none">  455  * full "Content-Length" value is parsed following the end of the headers. If</div><div id="456" class="line none">  456  * there is no Content-Length header, then llhttp_execute() expects a</div><div id="457" class="line none">  457  * zero length-ed parsing data to indicate the end of the response.</div><div id="458" class="line none">  458  *</div><div id="459" class="line none">  459  * For a "Transfer-Encoding: chunked" type of response message, the complete</div><div id="460" class="line none">  460  * response message is signaled by a terminating chunk header with length zero.</div><div id="461" class="line none">  461  *</div><div id="462" class="line none">  462  * See https://github.com/nodejs/llhttp for more information.</div><div id="463" class="line none">  463  *</div><div id="464" class="line none">  464  * @param[in] pHttpParser Parsing object containing state and callback context.</div><div id="465" class="line none">  465  *</div><div id="466" class="line none">  466  * @return Zero to continue parsing. All other return values will stop parsing</div><div id="467" class="line none">  467  * and llhttp_execute() will return with the same value.</div><div id="468" class="line none">  468  */</div><div id="469" class="line none">  469 static int <a href="core_http_client.c.html#981">httpParserOnMessageCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="470" class="line none">  470 </div><div id="471" class="line none">  471 /**</div><div id="472" class="line none">  472  * @brief When a complete header is found the HTTP response header count</div><div id="473" class="line none">  473  * increases and the application is notified.</div><div id="474" class="line none">  474  *</div><div id="475" class="line none">  475  * This function is invoked only in callbacks that could follow</div><div id="476" class="line none">  476  * #httpParserOnHeaderValueCallback. These callbacks are</div><div id="477" class="line none">  477  * #httpParserOnHeaderFieldCallback and #httpParserOnHeadersCompleteCallback.</div><div id="478" class="line none">  478  * A header field and value is not is not known to be complete until</div><div id="479" class="line none">  479  * #httpParserOnHeaderValueCallback is not called in succession.</div><div id="480" class="line none">  480  *</div><div id="481" class="line none">  481  * @param[in] pParsingContext Parsing state containing information to notify</div><div id="482" class="line none">  482  * the application of a complete header.</div><div id="483" class="line none">  483  */</div><div id="484" class="line none">  484 static void <a href="core_http_client.c.html#568">processCompleteHeader</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext );</div><div id="485" class="line none">  485 </div><div id="486" class="line none">  486 /**</div><div id="487" class="line none">  487  * @brief When parsing is complete an error could be indicated in</div><div id="488" class="line none">  488  * pHttpParser-&gt;error. This function translates that error into a library</div><div id="489" class="line none">  489  * specific error code.</div><div id="490" class="line none">  490  *</div><div id="491" class="line none">  491  * @param[in] pHttpParser Third-party HTTP parsing context.</div><div id="492" class="line none">  492  *</div><div id="493" class="line none">  493  * @return One of the following:</div><div id="494" class="line none">  494  * - #HTTPSuccess</div><div id="495" class="line none">  495  * - #HTTPSecurityAlertExtraneousResponseData</div><div id="496" class="line none">  496  * - #HTTPSecurityAlertInvalidChunkHeader</div><div id="497" class="line none">  497  * - #HTTPSecurityAlertInvalidProtocolVersion</div><div id="498" class="line none">  498  * - #HTTPSecurityAlertInvalidStatusCode</div><div id="499" class="line none">  499  * - #HTTPSecurityAlertInvalidCharacter</div><div id="500" class="line none">  500  * - #HTTPSecurityAlertInvalidContentLength</div><div id="501" class="line none">  501  * - #HTTPParserInternalError</div><div id="502" class="line none">  502  */</div><div id="503" class="line none">  503 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1041">processLlhttpError</a>( const <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser );</div><div id="504" class="line none">  504 </div><div id="505" class="line none">  505 /**</div><div id="506" class="line none">  506  * @brief Compares at most the first n bytes of str1 and str2 without case sensitivity</div><div id="507" class="line none">  507  * and n must be less than the actual size of either string.</div><div id="508" class="line none">  508  *</div><div id="509" class="line none">  509  * @param[in] str1 First string to be compared.</div><div id="510" class="line none">  510  * @param[in] str2 Second string to be compared.</div><div id="511" class="line none">  511  * @param[in] n The maximum number of characters to be compared.</div><div id="512" class="line none">  512  *</div><div id="513" class="line none">  513  * @return One of the following:</div><div id="514" class="line none">  514  * 0 if str1 is equal to str2</div><div id="515" class="line none">  515  * 1 if str1 is not equal to str2.</div><div id="516" class="line none">  516  */</div><div id="517" class="line none">  517 static int8_t <a href="core_http_client.c.html#529">caseInsensitiveStringCmp</a>( const char * str1,</div><div id="518" class="line none">  518                                         const char * str2,</div><div id="519" class="line none">  519                                         size_t n );</div><div id="520" class="line none">  520 </div><div id="521" class="line none">  521 /*-----------------------------------------------------------*/</div><div id="522" class="line none">  522 </div><div id="523" class="line none">  523 static uint32_t <a href="core_http_client.c.html#523">getZeroTimestampMs</a>( void )</div><div id="524" class="line none">  524 {</div><div id="525" class="line none">  525     return 0U;</div><div id="526" class="line none">  526 }</div><div id="527" class="line none">  527 </div><div id="528" class="line none">  528 /*-----------------------------------------------------------*/</div><div id="529" class="line none">  529 static int8_t <a href="core_http_client.c.html#529">caseInsensitiveStringCmp</a>( const char * str1,</div><div id="530" class="line none">  530                                         const char * str2,</div><div id="531" class="line none">  531                                         size_t n )</div><div id="532" class="line none">  532 {</div><div id="533" class="line none">  533     size_t i = 0U;</div><div id="534" class="line none">  534     /* Inclusion of temporary variables for MISRA rule 13.2 compliance */</div><div id="535" class="line none">  535     char firstChar;</div><div id="536" class="line none">  536     char secondChar;</div><div id="537" class="line none">  537     /* Get the offset from a lowercase to capital character in a MISRA compliant way */</div><div id="538" class="line none">  538     int8_t offset = 'a' - 'A';</div><div id="539" class="line none">  539 </div><div id="540" class="line none">  540     for( i = 0U; i &lt; n; i++ )</div><div id="541" class="line none">  541     {</div><div id="542" class="line none">  542         firstChar = str1[ i ];</div><div id="543" class="line none">  543         secondChar = str2[ i ];</div><div id="544" class="line none">  544 </div><div id="545" class="line none">  545         /* Subtract offset to go from lowercase to uppercase ASCII character */</div><div id="546" class="line none">  546         if( ( firstChar &gt;= 'a' ) &amp;&amp; ( firstChar &lt;= 'z' ) )</div><div id="547" class="line none">  547         {</div><div id="548" class="line none">  548             firstChar = ( char ) ( firstChar - offset );</div><div id="549" class="line none">  549         }</div><div id="550" class="line none">  550 </div><div id="551" class="line none">  551         if( ( secondChar &gt;= 'a' ) &amp;&amp; ( secondChar &lt;= 'z' ) )</div><div id="552" class="line none">  552         {</div><div id="553" class="line none">  553             secondChar = ( char ) ( secondChar - offset );</div><div id="554" class="line none">  554         }</div><div id="555" class="line none">  555 </div><div id="556" class="line none">  556         if( ( firstChar ) != ( secondChar ) )</div><div id="557" class="line none">  557         {</div><div id="558" class="line none">  558             break;</div><div id="559" class="line none">  559         }</div><div id="560" class="line none">  560     }</div><div id="561" class="line none">  561 </div><div id="562" class="line none">  562     return ( i == n ) ? 0 : 1;</div><div id="563" class="line none">  563 }</div><div id="564" class="line none">  564 </div><div id="565" class="line none">  565 </div><div id="566" class="line none">  566 /*-----------------------------------------------------------*/</div><div id="567" class="line none">  567 </div><div id="568" class="line none">  568 static void <a href="core_http_client.c.html#568">processCompleteHeader</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext )</div><div id="569" class="line none">  569 {</div><div id="570" class="line none">  570     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="571" class="line none">  571 </div><div id="572" class="line none">  572     assert( pParsingContext != NULL );</div><div id="573" class="line none">  573     assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="574" class="line none">  574 </div><div id="575" class="line none">  575     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="576" class="line none">  576 </div><div id="577" class="line none">  577     /* A header is complete when both the last header field and value have been</div><div id="578" class="line none">  578      * filled in. */</div><div id="579" class="line none">  579     if( ( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> != NULL ) &amp;&amp;</div><div id="580" class="line none">  580         ( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> != NULL ) )</div><div id="581" class="line none">  581     {</div><div id="582" class="line none">  582         assert( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#561">headerCount</a> &lt; SIZE_MAX );</div><div id="583" class="line none">  583         /* Increase the header count. */</div><div id="584" class="line none">  584         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#561">headerCount</a>++;</div><div id="585" class="line none">  585 </div><div id="586" class="line none">  586         LogDebug( ( "Response parsing: Found complete header: "</div><div id="587" class="line none">  587                     "HeaderField=%.*s, HeaderValue=%.*s",</div><div id="588" class="line none">  588                     ( int ) ( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> ),</div><div id="589" class="line none">  589                     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a>,</div><div id="590" class="line none">  590                     ( int ) ( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> ),</div><div id="591" class="line none">  591                     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> ) );</div><div id="592" class="line none">  592 </div><div id="593" class="line none">  593         /* If the application registered a callback, then it must be notified. */</div><div id="594" class="line none">  594         if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#494">pHeaderParsingCallback</a> != NULL )</div><div id="595" class="line none">  595         {</div><div id="596" class="line none">  596             <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#494">pHeaderParsingCallback</a>-&gt;<a href="include/core_http_client.h.html#443">onHeaderCallback</a>(</div><div id="597" class="line none">  597                 <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#494">pHeaderParsingCallback</a>-&gt;<a href="include/core_http_client.h.html#453">pContext</a>,</div><div id="598" class="line none">  598                 pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a>,</div><div id="599" class="line none">  599                 pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a>,</div><div id="600" class="line none">  600                 pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a>,</div><div id="601" class="line none">  601                 pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a>,</div><div id="602" class="line none">  602                 <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a> );</div><div id="603" class="line none">  603         }</div><div id="604" class="line none">  604 </div><div id="605" class="line none">  605         /* Prepare the next header field and value for the first invocation of</div><div id="606" class="line none">  606          * httpParserOnHeaderFieldCallback() and</div><div id="607" class="line none">  607          * httpParserOnHeaderValueCallback(). */</div><div id="608" class="line none">  608         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> = NULL;</div><div id="609" class="line none">  609         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> = 0U;</div><div id="610" class="line none">  610         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> = NULL;</div><div id="611" class="line none">  611         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> = 0U;</div><div id="612" class="line none">  612     }</div><div id="613" class="line none">  613 }</div><div id="614" class="line none">  614 </div><div id="615" class="line none">  615 /*-----------------------------------------------------------*/</div><div id="616" class="line none">  616 </div><div id="617" class="line none">  617 static int <a href="core_http_client.c.html#617">httpParserOnMessageBeginCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="618" class="line none">  618 {</div><div id="619" class="line none">  619     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="620" class="line none">  620 </div><div id="621" class="line none">  621     assert( pHttpParser != NULL );</div><div id="622" class="line none">  622     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="623" class="line none">  623 </div><div id="624" class="line none">  624     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="625" class="line none">  625 </div><div id="626" class="line none">  626     /* Parsing has initiated. */</div><div id="627" class="line none">  627     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#299">state</a> = <a href="include/core_http_client_private.h.html#213">HTTP_PARSING_INCOMPLETE</a>;</div><div id="628" class="line none">  628 </div><div id="629" class="line none">  629     LogDebug( ( "Response parsing: Found the start of the response message." ) );</div><div id="630" class="line none">  630 </div><div id="631" class="line none">  631     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="632" class="line none">  632 }</div><div id="633" class="line none">  633 </div><div id="634" class="line none">  634 /*-----------------------------------------------------------*/</div><div id="635" class="line none">  635 </div><div id="636" class="line none">  636 static int <a href="core_http_client.c.html#636">httpParserOnStatusCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="637" class="line none">  637                                        const char * pLoc,</div><div id="638" class="line none">  638                                        size_t length )</div><div id="639" class="line none">  639 {</div><div id="640" class="line none">  640     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="641" class="line none">  641     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="642" class="line none">  642 </div><div id="643" class="line none">  643     assert( pHttpParser != NULL );</div><div id="644" class="line none">  644     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="645" class="line none">  645     assert( pLoc != NULL );</div><div id="646" class="line none">  646 </div><div id="647" class="line none">  647     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="648" class="line none">  648     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="649" class="line none">  649 </div><div id="650" class="line none">  650     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="651" class="line none">  651 </div><div id="652" class="line none">  652     /* Set the location of what to parse next. */</div><div id="653" class="line none">  653     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;pLoc[ length ];</div><div id="654" class="line none">  654 </div><div id="655" class="line none">  655     /* Initialize the first header field and value to be passed to the user</div><div id="656" class="line none">  656      * callback. */</div><div id="657" class="line none">  657     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> = NULL;</div><div id="658" class="line none">  658     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> = 0U;</div><div id="659" class="line none">  659     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> = NULL;</div><div id="660" class="line none">  660     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> = 0U;</div><div id="661" class="line none">  661 </div><div id="662" class="line none">  662     /* httpParserOnStatusCallback() is reached because llhttp_execute() has</div><div id="663" class="line none">  663      * successfully read the HTTP response status code. */</div><div id="664" class="line none">  664     <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a> = ( uint16_t ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#40">status_code</a> );</div><div id="665" class="line none">  665 </div><div id="666" class="line none">  666     LogDebug( ( "Response parsing: Found the Reason-Phrase: "</div><div id="667" class="line none">  667                 "StatusCode=%u, ReasonPhrase=%.*s",</div><div id="668" class="line none">  668                 ( unsigned int ) <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a>,</div><div id="669" class="line none">  669                 ( int ) length,</div><div id="670" class="line none">  670                 pLoc ) );</div><div id="671" class="line none">  671 </div><div id="672" class="line none">  672     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="673" class="line none">  673 }</div><div id="674" class="line none">  674 </div><div id="675" class="line none">  675 /*-----------------------------------------------------------*/</div><div id="676" class="line none">  676 </div><div id="677" class="line none">  677 static int <a href="core_http_client.c.html#677">httpParserOnStatusCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="678" class="line none">  678 {</div><div id="679" class="line none">  679     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="680" class="line none">  680     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="681" class="line none">  681 </div><div id="682" class="line none">  682     assert( pHttpParser != NULL );</div><div id="683" class="line none">  683     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="684" class="line none">  684 </div><div id="685" class="line none">  685     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="686" class="line none">  686     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="687" class="line none">  687 </div><div id="688" class="line none">  688     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="689" class="line none">  689 </div><div id="690" class="line none">  690     /* Initialize the first header field and value to be passed to the user</div><div id="691" class="line none">  691      * callback. */</div><div id="692" class="line none">  692     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> = NULL;</div><div id="693" class="line none">  693     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> = 0U;</div><div id="694" class="line none">  694     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> = NULL;</div><div id="695" class="line none">  695     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> = 0U;</div><div id="696" class="line none">  696 </div><div id="697" class="line none">  697     /* httpParserOnStatusCompleteCallback() is reached because llhttp_execute()</div><div id="698" class="line none">  698      * has successfully read the HTTP response status code. */</div><div id="699" class="line none">  699     <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a> = ( uint16_t ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#40">status_code</a> );</div><div id="700" class="line none">  700 </div><div id="701" class="line none">  701     LogDebug( ( "Response parsing: StatusCode=%u",</div><div id="702" class="line none">  702                 ( unsigned int ) <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a> ) );</div><div id="703" class="line none">  703 </div><div id="704" class="line none">  704     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="705" class="line none">  705 }</div><div id="706" class="line none">  706 </div><div id="707" class="line none">  707 /*-----------------------------------------------------------*/</div><div id="708" class="line none">  708 </div><div id="709" class="line none">  709 static int <a href="core_http_client.c.html#709">httpParserOnHeaderFieldCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="710" class="line none">  710                                             const char * pLoc,</div><div id="711" class="line none">  711                                             size_t length )</div><div id="712" class="line none">  712 {</div><div id="713" class="line none">  713     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="714" class="line none">  714     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="715" class="line none">  715 </div><div id="716" class="line none">  716     assert( pHttpParser != NULL );</div><div id="717" class="line none">  717     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="718" class="line none">  718     assert( pLoc != NULL );</div><div id="719" class="line none">  719 </div><div id="720" class="line none">  720     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="721" class="line none">  721     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="722" class="line none">  722 </div><div id="723" class="line none">  723     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="724" class="line none">  724 </div><div id="725" class="line none">  725     /* If this is the first time httpParserOnHeaderFieldCallback() has been</div><div id="726" class="line none">  726      * invoked on a response, then the start of the response headers is NULL. */</div><div id="727" class="line none">  727     if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> == NULL )</div><div id="728" class="line none">  728     {</div><div id="729" class="line none">  729         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> = ( const uint8_t * ) pLoc;</div><div id="730" class="line none">  730     }</div><div id="731" class="line none">  731 </div><div id="732" class="line none">  732     /* Set the location of what to parse next. */</div><div id="733" class="line none">  733     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;pLoc[ length ];</div><div id="734" class="line none">  734 </div><div id="735" class="line none">  735     /* The httpParserOnHeaderFieldCallback() always follows the</div><div id="736" class="line none">  736      * httpParserOnHeaderValueCallback() if there is another header field. When</div><div id="737" class="line none">  737      * httpParserOnHeaderValueCallback() is not called in succession, then a</div><div id="738" class="line none">  738      * complete header has been found. */</div><div id="739" class="line none">  739     <a href="core_http_client.c.html#568">processCompleteHeader</a>( pParsingContext );</div><div id="740" class="line none">  740 </div><div id="741" class="line none">  741     /* If httpParserOnHeaderFieldCallback() is invoked in succession, then the</div><div id="742" class="line none">  742      * last time llhttp_execute() was called only part of the header field</div><div id="743" class="line none">  743      * was parsed. The indication of successive invocations is a non-NULL</div><div id="744" class="line none">  744      * pParsingContext-&gt;pLastHeaderField. */</div><div id="745" class="line none">  745     if( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> == NULL )</div><div id="746" class="line none">  746     {</div><div id="747" class="line none">  747         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> = pLoc;</div><div id="748" class="line none">  748         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> = length;</div><div id="749" class="line none">  749     }</div><div id="750" class="line none">  750     else</div><div id="751" class="line none">  751     {</div><div id="752" class="line none">  752         assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> &lt;= SIZE_MAX - length );</div><div id="753" class="line none">  753         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#305">lastHeaderFieldLen</a> += length;</div><div id="754" class="line none">  754     }</div><div id="755" class="line none">  755 </div><div id="756" class="line none">  756     LogDebug( ( "Response parsing: Found a header field: "</div><div id="757" class="line none">  757                 "HeaderField=%.*s",</div><div id="758" class="line none">  758                 ( int ) length,</div><div id="759" class="line none">  759                 pLoc ) );</div><div id="760" class="line none">  760 </div><div id="761" class="line none">  761     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="762" class="line none">  762 }</div><div id="763" class="line none">  763 </div><div id="764" class="line none">  764 /*-----------------------------------------------------------*/</div><div id="765" class="line none">  765 </div><div id="766" class="line none">  766 static int <a href="core_http_client.c.html#766">httpParserOnHeaderValueCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="767" class="line none">  767                                             const char * pLoc,</div><div id="768" class="line none">  768                                             size_t length )</div><div id="769" class="line none">  769 {</div><div id="770" class="line none">  770     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="771" class="line none">  771 </div><div id="772" class="line none">  772     assert( pHttpParser != NULL );</div><div id="773" class="line none">  773     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="774" class="line none">  774     assert( pLoc != NULL );</div><div id="775" class="line none">  775 </div><div id="776" class="line none">  776     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="777" class="line none">  777 </div><div id="778" class="line none">  778     /* Set the location of what to parse next. */</div><div id="779" class="line none">  779     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;pLoc[ length ];</div><div id="780" class="line none">  780 </div><div id="781" class="line none">  781     /* If httpParserOnHeaderValueCallback() is invoked in succession, then the</div><div id="782" class="line none">  782      * last time llhttp_execute() was called only part of the header field</div><div id="783" class="line none">  783      * was parsed. The indication of successive invocations is a non-NULL</div><div id="784" class="line none">  784      * pParsingContext-&gt;pLastHeaderField. */</div><div id="785" class="line none">  785     if( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> == NULL )</div><div id="786" class="line none">  786     {</div><div id="787" class="line none">  787         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#306">pLastHeaderValue</a> = pLoc;</div><div id="788" class="line none">  788         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> = length;</div><div id="789" class="line none">  789     }</div><div id="790" class="line none">  790     else</div><div id="791" class="line none">  791     {</div><div id="792" class="line none">  792         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#307">lastHeaderValueLen</a> += length;</div><div id="793" class="line none">  793     }</div><div id="794" class="line none">  794 </div><div id="795" class="line none">  795     /* Given that httpParserOnHeaderFieldCallback() is ALWAYS invoked before</div><div id="796" class="line none">  796      * httpParserOnHeaderValueCallback() is invoked, then the last header field</div><div id="797" class="line none">  797      * should never be NULL. This would indicate a bug in the llhttp library. */</div><div id="798" class="line none">  798     assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#304">pLastHeaderField</a> != NULL );</div><div id="799" class="line none">  799 </div><div id="800" class="line none">  800     LogDebug( ( "Response parsing: Found a header value: "</div><div id="801" class="line none">  801                 "HeaderValue=%.*s",</div><div id="802" class="line none">  802                 ( int ) length,</div><div id="803" class="line none">  803                 pLoc ) );</div><div id="804" class="line none">  804 </div><div id="805" class="line none">  805     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="806" class="line none">  806 }</div><div id="807" class="line none">  807 </div><div id="808" class="line none">  808 /*-----------------------------------------------------------*/</div><div id="809" class="line none">  809 </div><div id="810" class="line none">  810 static int <a href="core_http_client.c.html#810">httpParserOnHeadersCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="811" class="line none">  811 {</div><div id="812" class="line none">  812     int shouldContinueParse = <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="813" class="line none">  813     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="814" class="line none">  814     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="815" class="line none">  815 </div><div id="816" class="line none">  816     assert( pHttpParser != NULL );</div><div id="817" class="line none">  817     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="818" class="line none">  818 </div><div id="819" class="line none">  819     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="820" class="line none">  820     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="821" class="line none">  821 </div><div id="822" class="line none">  822     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="823" class="line none">  823     assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> != NULL );</div><div id="824" class="line none">  824 </div><div id="825" class="line none">  825     /* Flag indicating that the headers have been completely signed - useful for libraries built on top of corehttp. */</div><div id="826" class="line none">  826     <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#568">areHeadersComplete</a> = 1;</div><div id="827" class="line none">  827 </div><div id="828" class="line none">  828     /* The current location to parse was updated in previous callbacks and MUST</div><div id="829" class="line none">  829      * always be within the response buffer. */</div><div id="830" class="line none">  830     assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> &gt;= ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> ) );</div><div id="831" class="line none">  831     assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> &lt; ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> + <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> ) );</div><div id="832" class="line none">  832 </div><div id="833" class="line none">  833     /* `\r\n\r\n`, `\r\n\n`, `\n\r\n`, and `\n\n` are all valid indicators of</div><div id="834" class="line none">  834      * the end of the response headers. To reduce complexity these characters</div><div id="835" class="line none">  835      * are not included in the response headers length returned to the user. */</div><div id="836" class="line none">  836 </div><div id="837" class="line none">  837     /* If headers existed, then pResponse-&gt;pHeaders was set during the first</div><div id="838" class="line none">  838      * call to httpParserOnHeaderFieldCallback(). */</div><div id="839" class="line none">  839     if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> != NULL )</div><div id="840" class="line none">  840     {</div><div id="841" class="line none">  841         /* The start of the headers ALWAYS come before the the end of the headers. */</div><div id="842" class="line none">  842         assert( ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> ) &lt; pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> );</div><div id="843" class="line none">  843 </div><div id="844" class="line none">  844         /* MISRA Ref 10.8.1 [Essential type casting] */</div><div id="845" class="line none">  845         /* More details at: https://github.com/FreeRTOS/coreHTTP/blob/main/MISRA.md#rule-108 */</div><div id="846" class="line none">  846         /* coverity[misra_c_2012_rule_10_8_violation] */</div><div id="847" class="line none">  847         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = ( size_t ) ( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> - ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> ) );</div><div id="848" class="line none">  848     }</div><div id="849" class="line none">  849     else</div><div id="850" class="line none">  850     {</div><div id="851" class="line none">  851         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = 0U;</div><div id="852" class="line none">  852     }</div><div id="853" class="line none">  853 </div><div id="854" class="line none">  854     /* MISRA Ref 14.3.1 [Configuration dependent invariant] */</div><div id="855" class="line none">  855     /* More details at: https://github.com/FreeRTOS/coreHTTP/blob/main/MISRA.md#rule-143 */</div><div id="856" class="line none">  856     /* coverity[misra_c_2012_rule_14_3_violation] */</div><div id="857" class="line none">  857     if( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#30">content_length</a> != UINT64_MAX )</div><div id="858" class="line none">  858     {</div><div id="859" class="line none">  859         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#554">contentLength</a> = ( size_t ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#30">content_length</a> );</div><div id="860" class="line none">  860     }</div><div id="861" class="line none">  861     else</div><div id="862" class="line none">  862     {</div><div id="863" class="line none">  863         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#554">contentLength</a> = 0U;</div><div id="864" class="line none">  864     }</div><div id="865" class="line none">  865 </div><div id="866" class="line none">  866     /* If the Connection: close header was found this flag will be set. */</div><div id="867" class="line none">  867     if( ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#39">flags</a> &amp; ( unsigned int ) ( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#90">F_CONNECTION_CLOSE</a> ) ) != 0U )</div><div id="868" class="line none">  868     {</div><div id="869" class="line none">  869         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#583">respFlags</a> |= <a href="include/core_http_client.h.html#146">HTTP_RESPONSE_CONNECTION_CLOSE_FLAG</a>;</div><div id="870" class="line none">  870     }</div><div id="871" class="line none">  871 </div><div id="872" class="line none">  872     /* If the Connection: keep-alive header was found this flag will be set. */</div><div id="873" class="line none">  873     if( ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#39">flags</a> &amp; ( unsigned int ) ( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#89">F_CONNECTION_KEEP_ALIVE</a> ) ) != 0U )</div><div id="874" class="line none">  874     {</div><div id="875" class="line none">  875         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#583">respFlags</a> |= <a href="include/core_http_client.h.html#154">HTTP_RESPONSE_CONNECTION_KEEP_ALIVE_FLAG</a>;</div><div id="876" class="line none">  876     }</div><div id="877" class="line none">  877 </div><div id="878" class="line none">  878     /* llhttp_execute() requires that callback implementations must</div><div id="879" class="line none">  879      * indicate that parsing stops on headers complete, if response is to a HEAD</div><div id="880" class="line none">  880      * request. A HEAD response will contain Content-Length, but no body. If</div><div id="881" class="line none">  881      * the parser is not stopped here, then it will try to keep parsing past the</div><div id="882" class="line none">  882      * end of the headers up to the Content-Length found. */</div><div id="883" class="line none">  883     if( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#301">isHeadResponse</a> == 1U )</div><div id="884" class="line none">  884     {</div><div id="885" class="line none">  885         shouldContinueParse = <a href="include/core_http_client_private.h.html#179">LLHTTP_STOP_PARSING_NO_BODY</a>;</div><div id="886" class="line none">  886     }</div><div id="887" class="line none">  887 </div><div id="888" class="line none">  888     /* If headers are present in the response, then</div><div id="889" class="line none">  889      * httpParserOnHeadersCompleteCallback() always follows</div><div id="890" class="line none">  890      * the httpParserOnHeaderValueCallback(). When</div><div id="891" class="line none">  891      * httpParserOnHeaderValueCallback() is not called in succession, then a</div><div id="892" class="line none">  892      * complete header has been found. */</div><div id="893" class="line none">  893     <a href="core_http_client.c.html#568">processCompleteHeader</a>( pParsingContext );</div><div id="894" class="line none">  894 </div><div id="895" class="line none">  895     LogDebug( ( "Response parsing: Found the end of the headers." ) );</div><div id="896" class="line none">  896 </div><div id="897" class="line none">  897     /* If there is HTTP_RESPONSE_DO_NOT_PARSE_BODY_FLAG opt-in we should stop</div><div id="898" class="line none">  898      * parsing here. */</div><div id="899" class="line none">  899     if( ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#575">respOptionFlags</a> &amp; <a href="include/core_http_client.h.html#175">HTTP_RESPONSE_DO_NOT_PARSE_BODY_FLAG</a> ) != 0U )</div><div id="900" class="line none">  900     {</div><div id="901" class="line none">  901         shouldContinueParse = ( int ) <a href="include/core_http_client_private.h.html#173">LLHTTP_PAUSE_PARSING</a>;</div><div id="902" class="line none">  902     }</div><div id="903" class="line none">  903 </div><div id="904" class="line none">  904     return shouldContinueParse;</div><div id="905" class="line none">  905 }</div><div id="906" class="line none">  906 </div><div id="907" class="line none">  907 /*-----------------------------------------------------------*/</div><div id="908" class="line none">  908 </div><div id="909" class="line none">  909 static int <a href="core_http_client.c.html#909">httpParserOnBodyCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="910" class="line none">  910                                      const char * pLoc,</div><div id="911" class="line none">  911                                      size_t length )</div><div id="912" class="line none">  912 {</div><div id="913" class="line none">  913     int shouldContinueParse = <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="914" class="line none">  914     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="915" class="line none">  915     <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="916" class="line none">  916     char * pNextWriteLoc = NULL;</div><div id="917" class="line none">  917 </div><div id="918" class="line none">  918     assert( pHttpParser != NULL );</div><div id="919" class="line none">  919     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="920" class="line none">  920     assert( pLoc != NULL );</div><div id="921" class="line none">  921 </div><div id="922" class="line none">  922     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="923" class="line none">  923     <a href="include/core_http_client_private.h.html#300">pResponse</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="924" class="line none">  924 </div><div id="925" class="line none">  925     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="926" class="line none">  926     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> != NULL );</div><div id="927" class="line none">  927     assert( pLoc &gt;= ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> ) );</div><div id="928" class="line none">  928     assert( pLoc &lt; ( const char * ) ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> + <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> ) );</div><div id="929" class="line none">  929 </div><div id="930" class="line none">  930     /* If this is the first time httpParserOnBodyCallback() has been invoked,</div><div id="931" class="line none">  931      * then the start of the response body is NULL. */</div><div id="932" class="line none">  932     if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a> == NULL )</div><div id="933" class="line none">  933     {</div><div id="934" class="line none">  934         /* Ideally the start of the body should follow right after the header</div><div id="935" class="line none">  935          * end indicating characters, but to reduce complexity and ensure users</div><div id="936" class="line none">  936          * are given the correct start of the body, we set the start of the body</div><div id="937" class="line none">  937          * to what the parser tells us is the start. This could come after the</div><div id="938" class="line none">  938          * initial transfer encoding chunked header. */</div><div id="939" class="line none">  939         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a> = ( const uint8_t * ) ( pLoc );</div><div id="940" class="line none">  940         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#538">bodyLen</a> = 0U;</div><div id="941" class="line none">  941     }</div><div id="942" class="line none">  942 </div><div id="943" class="line none">  943     /* The next location to write. */</div><div id="944" class="line none">  944 </div><div id="945" class="line none">  945     /* MISRA Ref 11.8.1 [Removal of const from pointer] */</div><div id="946" class="line none">  946     /* More details at: https://github.com/FreeRTOS/coreHTTP/blob/main/MISRA.md#rule-118 */</div><div id="947" class="line none">  947     /* coverity[misra_c_2012_rule_11_8_violation] */</div><div id="948" class="line none">  948     pNextWriteLoc = ( char * ) ( &amp;( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a>[ <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#538">bodyLen</a> ] ) );</div><div id="949" class="line none">  949 </div><div id="950" class="line none">  950     /* If the response is of type Transfer-Encoding: chunked, then actual body</div><div id="951" class="line none">  951      * will follow the the chunked header. This body data is in a later location</div><div id="952" class="line none">  952      * and must be moved up in the buffer. When pLoc is greater than the current</div><div id="953" class="line none">  953      * end of the body, that signals the parser found a chunk header. */</div><div id="954" class="line none">  954 </div><div id="955" class="line none">  955     /* MISRA Ref 18.3.1 [Pointer comparison] */</div><div id="956" class="line none">  956     /* More details at: https://github.com/FreeRTOS/coreHTTP/blob/main/MISRA.md#rule-183 */</div><div id="957" class="line none">  957     /* coverity[pointer_parameter] */</div><div id="958" class="line none">  958     /* coverity[misra_c_2012_rule_18_3_violation] */</div><div id="959" class="line none">  959     if( pLoc &gt; pNextWriteLoc )</div><div id="960" class="line none">  960     {</div><div id="961" class="line none">  961         /* memmove is used instead of memcpy because memcpy has undefined behavior</div><div id="962" class="line none">  962          * when source and destination locations in memory overlap. */</div><div id="963" class="line none">  963         ( void ) memmove( pNextWriteLoc, pLoc, length );</div><div id="964" class="line none">  964     }</div><div id="965" class="line none">  965 </div><div id="966" class="line none">  966     /* Increase the length of the body found. */</div><div id="967" class="line none">  967     <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#538">bodyLen</a> += length;</div><div id="968" class="line none">  968 </div><div id="969" class="line none">  969     /* Set the next location of parsing. */</div><div id="970" class="line none">  970     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;pLoc[ length ];</div><div id="971" class="line none">  971 </div><div id="972" class="line none">  972     LogDebug( ( "Response parsing: Found the response body: "</div><div id="973" class="line none">  973                 "BodyLength=%lu",</div><div id="974" class="line none">  974                 ( unsigned long ) length ) );</div><div id="975" class="line none">  975 </div><div id="976" class="line none">  976     return shouldContinueParse;</div><div id="977" class="line none">  977 }</div><div id="978" class="line none">  978 </div><div id="979" class="line none">  979 /*-----------------------------------------------------------*/</div><div id="980" class="line none">  980 </div><div id="981" class="line none">  981 static int <a href="core_http_client.c.html#981">httpParserOnMessageCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="982" class="line none">  982 {</div><div id="983" class="line none">  983     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext = NULL;</div><div id="984" class="line none">  984 </div><div id="985" class="line none">  985     assert( pHttpParser != NULL );</div><div id="986" class="line none">  986     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="987" class="line none">  987 </div><div id="988" class="line none">  988     pParsingContext = ( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * ) ( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> );</div><div id="989" class="line none">  989 </div><div id="990" class="line none">  990     /* The response message is complete. */</div><div id="991" class="line none">  991     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#299">state</a> = <a href="include/core_http_client_private.h.html#214">HTTP_PARSING_COMPLETE</a>;</div><div id="992" class="line none">  992 </div><div id="993" class="line none">  993     LogDebug( ( "Response parsing: Response message complete." ) );</div><div id="994" class="line none">  994 </div><div id="995" class="line none">  995     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="996" class="line none">  996 }</div><div id="997" class="line none">  997 </div><div id="998" class="line none">  998 /*-----------------------------------------------------------*/</div><div id="999" class="line none">  999 </div><div id="1000" class="line none"> 1000 static void <a href="core_http_client.c.html#1000">initializeParsingContextForFirstResponse</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext,</div><div id="1001" class="line none"> 1001                                                       const <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders )</div><div id="1002" class="line none"> 1002 {</div><div id="1003" class="line none"> 1003     assert( pParsingContext != NULL );</div><div id="1004" class="line none"> 1004     assert( pRequestHeaders != NULL );</div><div id="1005" class="line none"> 1005     assert( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> &gt;= <a href="include/core_http_client_private.h.html#204">HTTP_MINIMUM_REQUEST_LINE_LENGTH</a> );</div><div id="1006" class="line none"> 1006 </div><div id="1007" class="line none"> 1007     /* Initialize the callbacks that llhttp_execute will invoke. */</div><div id="1008" class="line none"> 1008     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#416">llhttp_settings_init</a>( &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a> ) );</div><div id="1009" class="line none"> 1009     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#332">on_message_begin</a> = <a href="core_http_client.c.html#617">httpParserOnMessageBeginCallback</a>;</div><div id="1010" class="line none"> 1010     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#336">on_status</a> = <a href="core_http_client.c.html#636">httpParserOnStatusCallback</a>;</div><div id="1011" class="line none"> 1011     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#369">on_status_complete</a> = <a href="core_http_client.c.html#677">httpParserOnStatusCompleteCallback</a>;</div><div id="1012" class="line none"> 1012     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#337">on_header_field</a> = <a href="core_http_client.c.html#709">httpParserOnHeaderFieldCallback</a>;</div><div id="1013" class="line none"> 1013     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#338">on_header_value</a> = <a href="core_http_client.c.html#766">httpParserOnHeaderValueCallback</a>;</div><div id="1014" class="line none"> 1014     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#349">on_headers_complete</a> = <a href="core_http_client.c.html#810">httpParserOnHeadersCompleteCallback</a>;</div><div id="1015" class="line none"> 1015     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#355">on_body</a> = <a href="core_http_client.c.html#909">httpParserOnBodyCallback</a>;</div><div id="1016" class="line none"> 1016     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#358">on_message_complete</a> = <a href="core_http_client.c.html#981">httpParserOnMessageCompleteCallback</a>;</div><div id="1017" class="line none"> 1017 </div><div id="1018" class="line none"> 1018     /* Initialize the third-party HTTP parser to parse responses. */</div><div id="1019" class="line none"> 1019     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#381">llhttp_init</a>( &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a> ), <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#113">HTTP_RESPONSE</a>, &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#298">llhttpSettings</a> ) );</div><div id="1020" class="line none"> 1020 </div><div id="1021" class="line none"> 1021     /* No response has been parsed yet. */</div><div id="1022" class="line none"> 1022     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#299">state</a> = <a href="include/core_http_client_private.h.html#212">HTTP_PARSING_NONE</a>;</div><div id="1023" class="line none"> 1023 </div><div id="1024" class="line none"> 1024     /* No response to update is associated with this parsing context yet. */</div><div id="1025" class="line none"> 1025     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a> = NULL;</div><div id="1026" class="line none"> 1026 </div><div id="1027" class="line none"> 1027     /* The parsing context needs to know if the expected response is to a HEAD</div><div id="1028" class="line none"> 1028      * request. For a HEAD response, the third-party parser requires parsing is</div><div id="1029" class="line none"> 1029      * indicated to stop by returning a 1 from httpParserOnHeadersCompleteCallback().</div><div id="1030" class="line none"> 1030      * If this is not done, the parser will not indicate the message is complete. */</div><div id="1031" class="line none"> 1031     if( strncmp( ( const char * ) ( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> ),</div><div id="1032" class="line none"> 1032                  <a href="include/core_http_client.h.html#65">HTTP_METHOD_HEAD</a>,</div><div id="1033" class="line none"> 1033                  sizeof( <a href="include/core_http_client.h.html#65">HTTP_METHOD_HEAD</a> ) - 1U ) == 0 )</div><div id="1034" class="line none"> 1034     {</div><div id="1035" class="line none"> 1035         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#301">isHeadResponse</a> = 1U;</div><div id="1036" class="line none"> 1036     }</div><div id="1037" class="line none"> 1037 }</div><div id="1038" class="line none"> 1038 </div><div id="1039" class="line none"> 1039 /*-----------------------------------------------------------*/</div><div id="1040" class="line none"> 1040 </div><div id="1041" class="line none"> 1041 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1041">processLlhttpError</a>( const <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="1042" class="line none"> 1042 {</div><div id="1043" class="line none"> 1043     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1044" class="line none"> 1044 </div><div id="1045" class="line none"> 1045     assert( pHttpParser != NULL );</div><div id="1046" class="line none"> 1046 </div><div id="1047" class="line none"> 1047     /* llhttp_get_err_pos() may be used to get exact error locations, which was</div><div id="1048" class="line none"> 1048      * not possible with the previous http-parser. */</div><div id="1049" class="line none"> 1049 </div><div id="1050" class="line none"> 1050     switch( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#487">llhttp_get_errno</a>( pHttpParser ) )</div><div id="1051" class="line none"> 1051     {</div><div id="1052" class="line none"> 1052         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#59">HPE_OK</a>:</div><div id="1053" class="line none"> 1053         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#82">HPE_PAUSED_UPGRADE</a>:</div><div id="1054" class="line none"> 1054             /* There were no errors. */</div><div id="1055" class="line none"> 1055             break;</div><div id="1056" class="line none"> 1056 </div><div id="1057" class="line none"> 1057         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#74">HPE_INVALID_EOF_STATE</a>:</div><div id="1058" class="line none"> 1058 </div><div id="1059" class="line none"> 1059             /* In this case the parser was passed a length of zero, which indicates</div><div id="1060" class="line none"> 1060              * an EOF from the server, in the middle of parsing the response.</div><div id="1061" class="line none"> 1061              * This case is already handled by checking HTTPParsingContext_t.state. */</div><div id="1062" class="line none"> 1062             break;</div><div id="1063" class="line none"> 1063 </div><div id="1064" class="line none"> 1064         /* No header overflow in llhttp since no header size was set. */</div><div id="1065" class="line none"> 1065 </div><div id="1066" class="line none"> 1066         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#65">HPE_CLOSED_CONNECTION</a>:</div><div id="1067" class="line none"> 1067             LogError( ( "Response parsing error: Data received past complete "</div><div id="1068" class="line none"> 1068                         "response with \"Connection: close\" header present." ) );</div><div id="1069" class="line none"> 1069             returnStatus = <a href="include/core_http_client.h.html#267">HTTPSecurityAlertExtraneousResponseData</a>;</div><div id="1070" class="line none"> 1070             break;</div><div id="1071" class="line none"> 1071 </div><div id="1072" class="line none"> 1072         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#72">HPE_INVALID_CHUNK_SIZE</a>:</div><div id="1073" class="line none"> 1073 </div><div id="1074" class="line none"> 1074             /* http_parser_execute() does not give feedback on the exact failing</div><div id="1075" class="line none"> 1075              * character and location. */</div><div id="1076" class="line none"> 1076             LogError( ( "Response parsing error: Invalid character found in "</div><div id="1077" class="line none"> 1077                         "chunk header." ) );</div><div id="1078" class="line none"> 1078             returnStatus = <a href="include/core_http_client.h.html#275">HTTPSecurityAlertInvalidChunkHeader</a>;</div><div id="1079" class="line none"> 1079             break;</div><div id="1080" class="line none"> 1080 </div><div id="1081" class="line none"> 1081         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#69">HPE_INVALID_VERSION</a>:</div><div id="1082" class="line none"> 1082 </div><div id="1083" class="line none"> 1083             /* http_parser_execute() does not give feedback on the exact failing</div><div id="1084" class="line none"> 1084              * character and location. */</div><div id="1085" class="line none"> 1085             LogError( ( "Response parsing error: Invalid character found in "</div><div id="1086" class="line none"> 1086                         "HTTP protocol version." ) );</div><div id="1087" class="line none"> 1087 </div><div id="1088" class="line none"> 1088             returnStatus = <a href="include/core_http_client.h.html#284">HTTPSecurityAlertInvalidProtocolVersion</a>;</div><div id="1089" class="line none"> 1089             break;</div><div id="1090" class="line none"> 1090 </div><div id="1091" class="line none"> 1091         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#73">HPE_INVALID_STATUS</a>:</div><div id="1092" class="line none"> 1092 </div><div id="1093" class="line none"> 1093             /* There could be an invalid character or the status code number</div><div id="1094" class="line none"> 1094              * could be out of range. This feedback is not given back by the</div><div id="1095" class="line none"> 1095              * http-parser library. */</div><div id="1096" class="line none"> 1096             LogError( ( "Response parsing error: Invalid Status code." ) );</div><div id="1097" class="line none"> 1097             returnStatus = <a href="include/core_http_client.h.html#293">HTTPSecurityAlertInvalidStatusCode</a>;</div><div id="1098" class="line none"> 1098             break;</div><div id="1099" class="line none"> 1099 </div><div id="1100" class="line none"> 1100         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#61">HPE_STRICT</a>:</div><div id="1101" class="line none"> 1101         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#68">HPE_INVALID_CONSTANT</a>:</div><div id="1102" class="line none"> 1102             LogError( ( "Response parsing error: Invalid character found in "</div><div id="1103" class="line none"> 1103                         "Status-Line or header delimiters." ) );</div><div id="1104" class="line none"> 1104             returnStatus = <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>;</div><div id="1105" class="line none"> 1105             break;</div><div id="1106" class="line none"> 1106 </div><div id="1107" class="line none"> 1107         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#63">HPE_LF_EXPECTED</a>:</div><div id="1108" class="line none"> 1108             LogError( ( "Response parsing error: Expected line-feed in header "</div><div id="1109" class="line none"> 1109                         "not found." ) );</div><div id="1110" class="line none"> 1110             returnStatus = <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>;</div><div id="1111" class="line none"> 1111             break;</div><div id="1112" class="line none"> 1112 </div><div id="1113" class="line none"> 1113         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#70">HPE_INVALID_HEADER_TOKEN</a>:</div><div id="1114" class="line none"> 1114 </div><div id="1115" class="line none"> 1115             /* http_parser_execute() does not give feedback on the exact failing</div><div id="1116" class="line none"> 1116              * character and location. */</div><div id="1117" class="line none"> 1117             LogError( ( "Response parsing error: Invalid character found in "</div><div id="1118" class="line none"> 1118                         "headers." ) );</div><div id="1119" class="line none"> 1119             returnStatus = <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>;</div><div id="1120" class="line none"> 1120             break;</div><div id="1121" class="line none"> 1121 </div><div id="1122" class="line none"> 1122         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#71">HPE_INVALID_CONTENT_LENGTH</a>:</div><div id="1123" class="line none"> 1123 </div><div id="1124" class="line none"> 1124             /* http_parser_execute() does not give feedback on the exact failing</div><div id="1125" class="line none"> 1125              * character and location. */</div><div id="1126" class="line none"> 1126             LogError( ( "Response parsing error: Invalid character found in "</div><div id="1127" class="line none"> 1127                         "content-length headers." ) );</div><div id="1128" class="line none"> 1128             returnStatus = <a href="include/core_http_client.h.html#313">HTTPSecurityAlertInvalidContentLength</a>;</div><div id="1129" class="line none"> 1129             break;</div><div id="1130" class="line none"> 1130 </div><div id="1131" class="line none"> 1131         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#64">HPE_UNEXPECTED_CONTENT_LENGTH</a>:</div><div id="1132" class="line none"> 1132             LogError( ( "Response parsing error: A Content-Length header was "</div><div id="1133" class="line none"> 1133                         "found when it shouldn't have been." ) );</div><div id="1134" class="line none"> 1134             returnStatus = <a href="include/core_http_client.h.html#313">HTTPSecurityAlertInvalidContentLength</a>;</div><div id="1135" class="line none"> 1135             break;</div><div id="1136" class="line none"> 1136 </div><div id="1137" class="line none"> 1137         case <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#81">HPE_PAUSED</a>:</div><div id="1138" class="line none"> 1138             LogInfo( ( "User intervention: Parsing stopped by user." ) );</div><div id="1139" class="line none"> 1139             returnStatus = <a href="include/core_http_client.h.html#324">HTTPParserPaused</a>;</div><div id="1140" class="line none"> 1140             break;</div><div id="1141" class="line none"> 1141 </div><div id="1142" class="line none"> 1142         /* All other error cases cannot be triggered and indicate an error in the</div><div id="1143" class="line none"> 1143          * third-party parsing library if found. */</div><div id="1144" class="line none"> 1144         default:</div><div id="1145" class="line none"> 1145             LogError( ( "Error in third-party llhttp library: %s", llhttp_errno_name( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#487">llhttp_get_errno</a>( pHttpParser ) ) ) );</div><div id="1146" class="line none"> 1146             returnStatus = <a href="include/core_http_client.h.html#333">HTTPParserInternalError</a>;</div><div id="1147" class="line none"> 1147             break;</div><div id="1148" class="line none"> 1148     }</div><div id="1149" class="line none"> 1149 </div><div id="1150" class="line none"> 1150     /* Errors with HPE_CB_ prepended are manual returns of non-zero in the</div><div id="1151" class="line none"> 1151      * response parsing callback. */</div><div id="1152" class="line none"> 1152     LogDebug( ( "llhttp errno description: %s %s",</div><div id="1153" class="line none"> 1153                 llhttp_errno_name( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#487">llhttp_get_errno</a>( pHttpParser ) ),</div><div id="1154" class="line none"> 1154                 llhttp_get_error_reason( pHttpParser ) ) );</div><div id="1155" class="line none"> 1155 </div><div id="1156" class="line none"> 1156     return returnStatus;</div><div id="1157" class="line none"> 1157 }</div><div id="1158" class="line none"> 1158 </div><div id="1159" class="line none"> 1159 /*-----------------------------------------------------------*/</div><div id="1160" class="line none"> 1160 </div><div id="1161" class="line none"> 1161 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1161">parseHttpResponse</a>( <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> * pParsingContext,</div><div id="1162" class="line none"> 1162                                        <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="1163" class="line none"> 1163                                        size_t parseLen )</div><div id="1164" class="line none"> 1164 {</div><div id="1165" class="line none"> 1165     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus;</div><div id="1166" class="line none"> 1166     const char * parsingStartLoc = NULL;</div><div id="1167" class="line none"> 1167     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#86">llhttp_errno_t</a> eReturn;</div><div id="1168" class="line none"> 1168 </div><div id="1169" class="line none"> 1169     assert( pParsingContext != NULL );</div><div id="1170" class="line none"> 1170     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="1171" class="line none"> 1171 </div><div id="1172" class="line none"> 1172     /* If this is the first time this parsing context is used, then set the</div><div id="1173" class="line none"> 1173      * response input. */</div><div id="1174" class="line none"> 1174     if( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a> == NULL )</div><div id="1175" class="line none"> 1175     {</div><div id="1176" class="line none"> 1176         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a> = <a href="include/core_http_client_private.h.html#300">pResponse</a>;</div><div id="1177" class="line none"> 1177         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = ( const char * ) <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a>;</div><div id="1178" class="line none"> 1178 </div><div id="1179" class="line none"> 1179         /* Initialize the status-code returned in the response. */</div><div id="1180" class="line none"> 1180         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#547">statusCode</a> = 0U;</div><div id="1181" class="line none"> 1181         /* Initialize the start of the response body and length. */</div><div id="1182" class="line none"> 1182         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a> = NULL;</div><div id="1183" class="line none"> 1183         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#538">bodyLen</a> = 0U;</div><div id="1184" class="line none"> 1184 </div><div id="1185" class="line none"> 1185         /* Initialize the start of the headers, its length, and the count for</div><div id="1186" class="line none"> 1186          * the parsing that follows the status. */</div><div id="1187" class="line none"> 1187         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#517">pHeaders</a> = NULL;</div><div id="1188" class="line none"> 1188         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = 0U;</div><div id="1189" class="line none"> 1189         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#561">headerCount</a> = 0U;</div><div id="1190" class="line none"> 1190         /* Initialize the response flags. */</div><div id="1191" class="line none"> 1191         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#583">respFlags</a> = 0U;</div><div id="1192" class="line none"> 1192     }</div><div id="1193" class="line none"> 1193     else</div><div id="1194" class="line none"> 1194     {</div><div id="1195" class="line none"> 1195         /* This function is currently private to the HTTP Client library. It is</div><div id="1196" class="line none"> 1196          * therefore a development bug to have this function invoked in</div><div id="1197" class="line none"> 1197          * succession without the same response. */</div><div id="1198" class="line none"> 1198         assert( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#300">pResponse</a> == <a href="include/core_http_client_private.h.html#300">pResponse</a> );</div><div id="1199" class="line none"> 1199     }</div><div id="1200" class="line none"> 1200 </div><div id="1201" class="line none"> 1201     /* Setting this allows the parsing context and response to be carried to</div><div id="1202" class="line none"> 1202      * each of the callbacks that llhttp_execute() will invoke. */</div><div id="1203" class="line none"> 1203     pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> = pParsingContext;</div><div id="1204" class="line none"> 1204 </div><div id="1205" class="line none"> 1205     /* Save the starting response buffer location to parse. This is needed to</div><div id="1206" class="line none"> 1206      * ensure that we move the next location to parse to exactly how many</div><div id="1207" class="line none"> 1207      * characters were parsed in this call. */</div><div id="1208" class="line none"> 1208     parsingStartLoc = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>;</div><div id="1209" class="line none"> 1209 </div><div id="1210" class="line none"> 1210     /* This will begin the parsing. Each of the callbacks set in</div><div id="1211" class="line none"> 1211      * parserSettings will be invoked as parts of the HTTP response are</div><div id="1212" class="line none"> 1212      * reached. The return code is parsed in #processLlhttpError. */</div><div id="1213" class="line none"> 1213     eReturn = <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#435">llhttp_execute</a>( &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a> ), parsingStartLoc, parseLen );</div><div id="1214" class="line none"> 1214 </div><div id="1215" class="line none"> 1215     if( eReturn == <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#82">HPE_PAUSED_UPGRADE</a> )</div><div id="1216" class="line none"> 1216     {</div><div id="1217" class="line none"> 1217         <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#483">llhttp_resume_after_upgrade</a>( &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a> ) );</div><div id="1218" class="line none"> 1218     }</div><div id="1219" class="line none"> 1219 </div><div id="1220" class="line none"> 1220     if( eReturn == <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#81">HPE_PAUSED</a> )</div><div id="1221" class="line none"> 1221     {</div><div id="1222" class="line none"> 1222         /* The next location to parse is where the parser was paused. */</div><div id="1223" class="line none"> 1223         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a>.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#27">error_pos</a>;</div><div id="1224" class="line none"> 1224     }</div><div id="1225" class="line none"> 1225     else</div><div id="1226" class="line none"> 1226     {</div><div id="1227" class="line none"> 1227         /* The next location to parse is after what has already been parsed. */</div><div id="1228" class="line none"> 1228         pParsingContext-&gt;<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;parsingStartLoc[ parseLen ];</div><div id="1229" class="line none"> 1229     }</div><div id="1230" class="line none"> 1230 </div><div id="1231" class="line none"> 1231     returnStatus = <a href="core_http_client.c.html#1041">processLlhttpError</a>( &amp;( pParsingContext-&gt;<a href="include/core_http_client_private.h.html#297">llhttpParser</a> ) );</div><div id="1232" class="line none"> 1232 </div><div id="1233" class="line none"> 1233     return returnStatus;</div><div id="1234" class="line none"> 1234 }</div><div id="1235" class="line none"> 1235 </div><div id="1236" class="line none"> 1236 /*-----------------------------------------------------------*/</div><div id="1237" class="line none"> 1237 </div><div id="1238" class="line none"> 1238 static uint8_t <a href="core_http_client.c.html#1238">convertInt32ToAscii</a>( int32_t value,</div><div id="1239" class="line none"> 1239                                     char * <a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="1240" class="line none"> 1240                                     size_t bufferLength )</div><div id="1241" class="line none"> 1241 {</div><div id="1242" class="line none"> 1242     /* As input value may be altered and MISRA C 2012 rule 17.8 prevents</div><div id="1243" class="line none"> 1243      * modification of parameter, a local copy of the parameter is stored.</div><div id="1244" class="line none"> 1244      * absoluteValue stores the positive version of the input value. Its type</div><div id="1245" class="line none"> 1245      * remains the same type as the input value to avoid unnecessary casting on</div><div id="1246" class="line none"> 1246      * a privately used variable. This variable's size will always be less</div><div id="1247" class="line none"> 1247      * than INT32_MAX. */</div><div id="1248" class="line none"> 1248     int32_t absoluteValue = value;</div><div id="1249" class="line none"> 1249     uint8_t numOfDigits = 0U;</div><div id="1250" class="line none"> 1250     uint8_t index = 0U;</div><div id="1251" class="line none"> 1251     uint8_t isNegative = 0U;</div><div id="1252" class="line none"> 1252     int32_t bufferIndex;</div><div id="1253" class="line none"> 1253     char temp = '\0';</div><div id="1254" class="line none"> 1254 </div><div id="1255" class="line none"> 1255     assert( <a href="include/core_http_client.h.html#380">pBuffer</a> != NULL );</div><div id="1256" class="line none"> 1256     assert( bufferLength &gt;= <a href="include/core_http_client_private.h.html#145">MAX_INT32_NO_OF_DECIMAL_DIGITS</a> );</div><div id="1257" class="line none"> 1257     ( void ) bufferLength;</div><div id="1258" class="line none"> 1258 </div><div id="1259" class="line none"> 1259     /* If the value is negative, write the '-' (minus) character to the buffer. */</div><div id="1260" class="line none"> 1260     if( value &lt; 0 )</div><div id="1261" class="line none"> 1261     {</div><div id="1262" class="line none"> 1262         isNegative = 1U;</div><div id="1263" class="line none"> 1263 </div><div id="1264" class="line none"> 1264         *<a href="include/core_http_client.h.html#380">pBuffer</a> = '-';</div><div id="1265" class="line none"> 1265 </div><div id="1266" class="line none"> 1266         /* Convert the value to its absolute representation. */</div><div id="1267" class="line none"> 1267         absoluteValue = value * ( -1 );</div><div id="1268" class="line none"> 1268     }</div><div id="1269" class="line none"> 1269 </div><div id="1270" class="line none"> 1270     /* Write the absolute integer value in reverse ASCII representation. */</div><div id="1271" class="line none"> 1271     do</div><div id="1272" class="line none"> 1272     {</div><div id="1273" class="line none"> 1273         <a href="include/core_http_client.h.html#380">pBuffer</a>[ isNegative + numOfDigits ] = ( char ) ( ( absoluteValue % 10 ) + '0' );</div><div id="1274" class="line none"> 1274         numOfDigits++;</div><div id="1275" class="line none"> 1275         absoluteValue /= 10;</div><div id="1276" class="line none"> 1276     } while( absoluteValue != 0 );</div><div id="1277" class="line none"> 1277 </div><div id="1278" class="line none"> 1278     /* Reverse the digits in the buffer to store the correct ASCII representation</div><div id="1279" class="line none"> 1279      * of the value. */</div><div id="1280" class="line none"> 1280     for( index = 0U; index &lt; ( numOfDigits / 2U ); index++ )</div><div id="1281" class="line none"> 1281     {</div><div id="1282" class="line none"> 1282         temp = <a href="include/core_http_client.h.html#380">pBuffer</a>[ isNegative + index ];</div><div id="1283" class="line none"> 1283         bufferIndex = ( int32_t ) isNegative + ( int32_t ) numOfDigits - ( int32_t ) index - 1;</div><div id="1284" class="line none"> 1284         <a href="include/core_http_client.h.html#380">pBuffer</a>[ isNegative + index ] = <a href="include/core_http_client.h.html#380">pBuffer</a>[ bufferIndex ];</div><div id="1285" class="line none"> 1285         <a href="include/core_http_client.h.html#380">pBuffer</a>[ bufferIndex ] = temp;</div><div id="1286" class="line none"> 1286     }</div><div id="1287" class="line none"> 1287 </div><div id="1288" class="line none"> 1288     return ( uint8_t ) ( isNegative + numOfDigits );</div><div id="1289" class="line none"> 1289 }</div><div id="1290" class="line none"> 1290 </div><div id="1291" class="line none"> 1291 /*-----------------------------------------------------------*/</div><div id="1292" class="line none"> 1292 </div><div id="1293" class="line none"> 1293 static char * <a href="core_http_client.c.html#1293">httpHeaderStrncpy</a>( char * pDest,</div><div id="1294" class="line none"> 1294                                  const char * pSrc,</div><div id="1295" class="line none"> 1295                                  size_t len,</div><div id="1296" class="line none"> 1296                                  uint8_t isField )</div><div id="1297" class="line none"> 1297 {</div><div id="1298" class="line none"> 1298     size_t i = 0U;</div><div id="1299" class="line none"> 1299     char * pRet = pDest;</div><div id="1300" class="line none"> 1300     uint8_t hasError = 0U;</div><div id="1301" class="line none"> 1301 </div><div id="1302" class="line none"> 1302     assert( pDest != NULL );</div><div id="1303" class="line none"> 1303     assert( pSrc != NULL );</div><div id="1304" class="line none"> 1304 </div><div id="1305" class="line none"> 1305     for( ; i &lt; len; i++ )</div><div id="1306" class="line none"> 1306     {</div><div id="1307" class="line none"> 1307         if( pSrc[ i ] == <a href="include/core_http_client_private.h.html#76">CARRIAGE_RETURN_CHARACTER</a> )</div><div id="1308" class="line none"> 1308         {</div><div id="1309" class="line none"> 1309             LogError( ( "Invalid character '\r' found in %.*s",</div><div id="1310" class="line none"> 1310                         ( int ) len, pSrc ) );</div><div id="1311" class="line none"> 1311             hasError = 1U;</div><div id="1312" class="line none"> 1312         }</div><div id="1313" class="line none"> 1313         else if( pSrc[ i ] == <a href="include/core_http_client_private.h.html#77">LINEFEED_CHARACTER</a> )</div><div id="1314" class="line none"> 1314         {</div><div id="1315" class="line none"> 1315             LogError( ( "Invalid character '\n' found in %.*s",</div><div id="1316" class="line none"> 1316                         ( int ) len, pSrc ) );</div><div id="1317" class="line none"> 1317             hasError = 1U;</div><div id="1318" class="line none"> 1318         }</div><div id="1319" class="line none"> 1319         else if( ( isField == 1U ) &amp;&amp; ( pSrc[ i ] == <a href="include/core_http_client_private.h.html#78">COLON_CHARACTER</a> ) )</div><div id="1320" class="line none"> 1320         {</div><div id="1321" class="line none"> 1321             LogError( ( "Invalid character ':' found in %.*s",</div><div id="1322" class="line none"> 1322                         ( int ) len, pSrc ) );</div><div id="1323" class="line none"> 1323             hasError = 1U;</div><div id="1324" class="line none"> 1324         }</div><div id="1325" class="line none"> 1325         else</div><div id="1326" class="line none"> 1326         {</div><div id="1327" class="line none"> 1327             pDest[ i ] = pSrc[ i ];</div><div id="1328" class="line none"> 1328         }</div><div id="1329" class="line none"> 1329 </div><div id="1330" class="line none"> 1330         if( hasError == 1U )</div><div id="1331" class="line none"> 1331         {</div><div id="1332" class="line none"> 1332             pRet = NULL;</div><div id="1333" class="line none"> 1333             break;</div><div id="1334" class="line none"> 1334         }</div><div id="1335" class="line none"> 1335     }</div><div id="1336" class="line none"> 1336 </div><div id="1337" class="line none"> 1337     return pRet;</div><div id="1338" class="line none"> 1338 }</div><div id="1339" class="line none"> 1339 </div><div id="1340" class="line none"> 1340 /*-----------------------------------------------------------*/</div><div id="1341" class="line none"> 1341 </div><div id="1342" class="line none"> 1342 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1342">addHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1343" class="line none"> 1343                                const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="1344" class="line none"> 1344                                size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="1345" class="line none"> 1345                                const char * pValue,</div><div id="1346" class="line none"> 1346                                size_t valueLen )</div><div id="1347" class="line none"> 1347 {</div><div id="1348" class="line none"> 1348     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1349" class="line none"> 1349     char * <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = NULL;</div><div id="1350" class="line none"> 1350     size_t toAddLen = 0U;</div><div id="1351" class="line none"> 1351     size_t backtrackHeaderLen = 0U;</div><div id="1352" class="line none"> 1352 </div><div id="1353" class="line none"> 1353     /* Directly passing in these strings to memcpy is a MISRA Rule 7.4 violation</div><div id="1354" class="line none"> 1354      * Due to this we allocate these pointers for MISRA compliance */</div><div id="1355" class="line none"> 1355     const char * pHeaderEndIndicator = <a href="include/core_http_client_private.h.html#66">HTTP_HEADER_END_INDICATOR</a>;</div><div id="1356" class="line none"> 1356     const char * httpFieldSeparator = <a href="include/core_http_client_private.h.html#68">HTTP_HEADER_FIELD_SEPARATOR</a>;</div><div id="1357" class="line none"> 1357 </div><div id="1358" class="line none"> 1358     assert( pRequestHeaders != NULL );</div><div id="1359" class="line none"> 1359     assert( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> != NULL );</div><div id="1360" class="line none"> 1360     assert( <a href="include/core_http_client_private.h.html#224">pField</a> != NULL );</div><div id="1361" class="line none"> 1361     assert( pValue != NULL );</div><div id="1362" class="line none"> 1362     assert( <a href="include/core_http_client_private.h.html#225">fieldLen</a> != 0U );</div><div id="1363" class="line none"> 1363     assert( valueLen != 0U );</div><div id="1364" class="line none"> 1364 </div><div id="1365" class="line none"> 1365     <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = ( char * ) &amp;( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a>[ pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ] );</div><div id="1366" class="line none"> 1366     backtrackHeaderLen = pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a>;</div><div id="1367" class="line none"> 1367 </div><div id="1368" class="line none"> 1368     /* Backtrack before trailing "\r\n" (HTTP header end) if it's already written.</div><div id="1369" class="line none"> 1369      * Note that this method also writes trailing "\r\n" before returning.</div><div id="1370" class="line none"> 1370      * The first condition prevents reading before start of the header. */</div><div id="1371" class="line none"> 1371     if( ( <a href="include/core_http_client_private.h.html#67">HTTP_HEADER_END_INDICATOR_LEN</a> &lt;= pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ) &amp;&amp;</div><div id="1372" class="line none"> 1372         ( strncmp( ( char * ) &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ 0 - ( ( int ) <a href="include/core_http_client_private.h.html#67">HTTP_HEADER_END_INDICATOR_LEN</a> ) ],</div><div id="1373" class="line none"> 1373                    <a href="include/core_http_client_private.h.html#66">HTTP_HEADER_END_INDICATOR</a>, <a href="include/core_http_client_private.h.html#67">HTTP_HEADER_END_INDICATOR_LEN</a> ) == 0 ) )</div><div id="1374" class="line none"> 1374     {</div><div id="1375" class="line none"> 1375         backtrackHeaderLen -= <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a>;</div><div id="1376" class="line none"> 1376         <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ 0 - ( ( int ) <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a> ) ];</div><div id="1377" class="line none"> 1377     }</div><div id="1378" class="line none"> 1378 </div><div id="1379" class="line none"> 1379     /* Check if there is enough space in buffer for additional header. */</div><div id="1380" class="line none"> 1380     toAddLen = <a href="include/core_http_client_private.h.html#225">fieldLen</a> + <a href="include/core_http_client_private.h.html#69">HTTP_HEADER_FIELD_SEPARATOR_LEN</a> + valueLen +</div><div id="1381" class="line none"> 1381                <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a> +</div><div id="1382" class="line none"> 1382                <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a>;</div><div id="1383" class="line none"> 1383 </div><div id="1384" class="line none"> 1384     /* If we have enough room for the new header line, then write it to the</div><div id="1385" class="line none"> 1385      * header buffer. */</div><div id="1386" class="line none"> 1386     if( ( backtrackHeaderLen + toAddLen ) &lt;= pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> )</div><div id="1387" class="line none"> 1387     {</div><div id="1388" class="line none"> 1388         /* Write "&lt;Field&gt;: &lt;Value&gt; \r\n" to the headers buffer. */</div><div id="1389" class="line none"> 1389 </div><div id="1390" class="line none"> 1390         /* Copy the header name into the buffer. */</div><div id="1391" class="line none"> 1391         if( <a href="core_http_client.c.html#1293">httpHeaderStrncpy</a>( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>, <a href="include/core_http_client_private.h.html#224">pField</a>, <a href="include/core_http_client_private.h.html#225">fieldLen</a>, <a href="include/core_http_client_private.h.html#90">HTTP_HEADER_STRNCPY_IS_FIELD</a> ) == NULL )</div><div id="1392" class="line none"> 1392         {</div><div id="1393" class="line none"> 1393             returnStatus = <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>;</div><div id="1394" class="line none"> 1394         }</div><div id="1395" class="line none"> 1395 </div><div id="1396" class="line none"> 1396         if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1397" class="line none"> 1397         {</div><div id="1398" class="line none"> 1398             <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#225">fieldLen</a> ];</div><div id="1399" class="line none"> 1399 </div><div id="1400" class="line none"> 1400             /* Copy the field separator, ": ", into the buffer. */</div><div id="1401" class="line none"> 1401             ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>,</div><div id="1402" class="line none"> 1402                              httpFieldSeparator,</div><div id="1403" class="line none"> 1403                              <a href="include/core_http_client_private.h.html#69">HTTP_HEADER_FIELD_SEPARATOR_LEN</a> );</div><div id="1404" class="line none"> 1404 </div><div id="1405" class="line none"> 1405             <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#69">HTTP_HEADER_FIELD_SEPARATOR_LEN</a> ];</div><div id="1406" class="line none"> 1406 </div><div id="1407" class="line none"> 1407             /* Copy the header value into the buffer. */</div><div id="1408" class="line none"> 1408             if( <a href="core_http_client.c.html#1293">httpHeaderStrncpy</a>( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>, pValue, valueLen, <a href="include/core_http_client_private.h.html#84">HTTP_HEADER_STRNCPY_IS_VALUE</a> ) == NULL )</div><div id="1409" class="line none"> 1409             {</div><div id="1410" class="line none"> 1410                 returnStatus = <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>;</div><div id="1411" class="line none"> 1411             }</div><div id="1412" class="line none"> 1412         }</div><div id="1413" class="line none"> 1413 </div><div id="1414" class="line none"> 1414         if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1415" class="line none"> 1415         {</div><div id="1416" class="line none"> 1416             <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ valueLen ];</div><div id="1417" class="line none"> 1417 </div><div id="1418" class="line none"> 1418             /* Copy the header end indicator, "\r\n\r\n" into the buffer. */</div><div id="1419" class="line none"> 1419             ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>,</div><div id="1420" class="line none"> 1420                              pHeaderEndIndicator,</div><div id="1421" class="line none"> 1421                              <a href="include/core_http_client_private.h.html#67">HTTP_HEADER_END_INDICATOR_LEN</a> );</div><div id="1422" class="line none"> 1422 </div><div id="1423" class="line none"> 1423             /* Update the headers length value only when everything is successful. */</div><div id="1424" class="line none"> 1424             pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = backtrackHeaderLen + toAddLen;</div><div id="1425" class="line none"> 1425         }</div><div id="1426" class="line none"> 1426     }</div><div id="1427" class="line none"> 1427     else</div><div id="1428" class="line none"> 1428     {</div><div id="1429" class="line none"> 1429         LogError( ( "Unable to add header in buffer: "</div><div id="1430" class="line none"> 1430                     "Buffer has insufficient memory: "</div><div id="1431" class="line none"> 1431                     "RequiredBytes=%lu, RemainingBufferSize=%lu",</div><div id="1432" class="line none"> 1432                     ( unsigned long ) toAddLen,</div><div id="1433" class="line none"> 1433                     ( unsigned long ) ( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> - pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ) ) );</div><div id="1434" class="line none"> 1434         returnStatus = <a href="include/core_http_client.h.html#258">HTTPInsufficientMemory</a>;</div><div id="1435" class="line none"> 1435     }</div><div id="1436" class="line none"> 1436 </div><div id="1437" class="line none"> 1437     return returnStatus;</div><div id="1438" class="line none"> 1438 }</div><div id="1439" class="line none"> 1439 </div><div id="1440" class="line none"> 1440 /*-----------------------------------------------------------*/</div><div id="1441" class="line none"> 1441 </div><div id="1442" class="line none"> 1442 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1442">addRangeHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1443" class="line none"> 1443                                     int32_t rangeStartOrlastNbytes,</div><div id="1444" class="line none"> 1444                                     int32_t rangeEnd )</div><div id="1445" class="line none"> 1445 {</div><div id="1446" class="line none"> 1446     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1447" class="line none"> 1447     char rangeValueBuffer[ <a href="include/core_http_client_private.h.html#153">HTTP_MAX_RANGE_REQUEST_VALUE_LEN</a> ];</div><div id="1448" class="line none"> 1448     size_t rangeValueLength = 0U;</div><div id="1449" class="line none"> 1449 </div><div id="1450" class="line none"> 1450     /* Directly passing in these strings to memcpy is a MISRA Rule 7.4 violation</div><div id="1451" class="line none"> 1451      * Due to this we allocate these pointers for MISRA compliance */</div><div id="1452" class="line none"> 1452     const char * pHttpRangeRequestHeaderValuePrefix = <a href="include/core_http_client_private.h.html#133">HTTP_RANGE_REQUEST_HEADER_VALUE_PREFIX</a>;</div><div id="1453" class="line none"> 1453     const char * pHttpRangeRequestHeaderField = <a href="include/core_http_client_private.h.html#123">HTTP_RANGE_REQUEST_HEADER_FIELD</a>;</div><div id="1454" class="line none"> 1454 </div><div id="1455" class="line none"> 1455     assert( pRequestHeaders != NULL );</div><div id="1456" class="line none"> 1456 </div><div id="1457" class="line none"> 1457     /* This buffer uses a char type instead of the general purpose uint8_t</div><div id="1458" class="line none"> 1458      * because the range value expected to be written is within the ASCII</div><div id="1459" class="line none"> 1459      * character set. */</div><div id="1460" class="line none"> 1460     ( void ) memset( rangeValueBuffer, 0, <a href="include/core_http_client_private.h.html#153">HTTP_MAX_RANGE_REQUEST_VALUE_LEN</a> );</div><div id="1461" class="line none"> 1461 </div><div id="1462" class="line none"> 1462     /* Generate the value data for the Range Request header.*/</div><div id="1463" class="line none"> 1463 </div><div id="1464" class="line none"> 1464     /* Write the range value prefix in the buffer. */</div><div id="1465" class="line none"> 1465     ( void ) memcpy( rangeValueBuffer,</div><div id="1466" class="line none"> 1466                      pHttpRangeRequestHeaderValuePrefix,</div><div id="1467" class="line none"> 1467                      <a href="include/core_http_client_private.h.html#138">HTTP_RANGE_REQUEST_HEADER_VALUE_PREFIX_LEN</a> );</div><div id="1468" class="line none"> 1468     rangeValueLength += <a href="include/core_http_client_private.h.html#138">HTTP_RANGE_REQUEST_HEADER_VALUE_PREFIX_LEN</a>;</div><div id="1469" class="line none"> 1469 </div><div id="1470" class="line none"> 1470     /* Write the range start value in the buffer. */</div><div id="1471" class="line none"> 1471     rangeValueLength += <a href="core_http_client.c.html#1238">convertInt32ToAscii</a>( rangeStartOrlastNbytes,</div><div id="1472" class="line none"> 1472                                              &amp;rangeValueBuffer[ rangeValueLength ],</div><div id="1473" class="line none"> 1473                                              sizeof( rangeValueBuffer ) - rangeValueLength );</div><div id="1474" class="line none"> 1474 </div><div id="1475" class="line none"> 1475     /* Add remaining value data depending on the range specification type. */</div><div id="1476" class="line none"> 1476 </div><div id="1477" class="line none"> 1477     /* Add rangeEnd value if request is for [rangeStart, rangeEnd] byte range */</div><div id="1478" class="line none"> 1478     if( rangeEnd != <a href="include/core_http_client.h.html#189">HTTP_RANGE_REQUEST_END_OF_FILE</a> )</div><div id="1479" class="line none"> 1479     {</div><div id="1480" class="line none"> 1480         /* Write the "-" character to the buffer.*/</div><div id="1481" class="line none"> 1481         rangeValueBuffer[ rangeValueLength ] = <a href="include/core_http_client_private.h.html#72">DASH_CHARACTER</a>;</div><div id="1482" class="line none"> 1482         rangeValueLength += <a href="include/core_http_client_private.h.html#73">DASH_CHARACTER_LEN</a>;</div><div id="1483" class="line none"> 1483 </div><div id="1484" class="line none"> 1484         /* Write the rangeEnd value of the request range to the buffer. */</div><div id="1485" class="line none"> 1485         rangeValueLength += <a href="core_http_client.c.html#1238">convertInt32ToAscii</a>( rangeEnd,</div><div id="1486" class="line none"> 1486                                                  &amp;rangeValueBuffer[ rangeValueLength ],</div><div id="1487" class="line none"> 1487                                                  sizeof( rangeValueBuffer ) - rangeValueLength );</div><div id="1488" class="line none"> 1488     }</div><div id="1489" class="line none"> 1489     /* Case when request is for bytes in the range [rangeStart, EoF). */</div><div id="1490" class="line none"> 1490     else if( rangeStartOrlastNbytes &gt;= 0 )</div><div id="1491" class="line none"> 1491     {</div><div id="1492" class="line none"> 1492         /* Write the "-" character to the buffer.*/</div><div id="1493" class="line none"> 1493         rangeValueBuffer[ rangeValueLength ] = <a href="include/core_http_client_private.h.html#72">DASH_CHARACTER</a>;</div><div id="1494" class="line none"> 1494         rangeValueLength += <a href="include/core_http_client_private.h.html#73">DASH_CHARACTER_LEN</a>;</div><div id="1495" class="line none"> 1495     }</div><div id="1496" class="line none"> 1496     else</div><div id="1497" class="line none"> 1497     {</div><div id="1498" class="line none"> 1498         /* Empty else MISRA 15.7 */</div><div id="1499" class="line none"> 1499     }</div><div id="1500" class="line none"> 1500 </div><div id="1501" class="line none"> 1501     /* Add the Range Request header field and value to the buffer. */</div><div id="1502" class="line none"> 1502     returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1503" class="line none"> 1503                               pHttpRangeRequestHeaderField,</div><div id="1504" class="line none"> 1504                               <a href="include/core_http_client_private.h.html#128">HTTP_RANGE_REQUEST_HEADER_FIELD_LEN</a>,</div><div id="1505" class="line none"> 1505                               rangeValueBuffer,</div><div id="1506" class="line none"> 1506                               rangeValueLength );</div><div id="1507" class="line none"> 1507 </div><div id="1508" class="line none"> 1508     return returnStatus;</div><div id="1509" class="line none"> 1509 }</div><div id="1510" class="line none"> 1510 </div><div id="1511" class="line none"> 1511 /*-----------------------------------------------------------*/</div><div id="1512" class="line none"> 1512 </div><div id="1513" class="line none"> 1513 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1513">writeRequestLine</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1514" class="line none"> 1514                                       const char * <a href="include/core_http_client.h.html#400">pMethod</a>,</div><div id="1515" class="line none"> 1515                                       size_t <a href="include/core_http_client.h.html#401">methodLen</a>,</div><div id="1516" class="line none"> 1516                                       const char * <a href="include/core_http_client.h.html#406">pPath</a>,</div><div id="1517" class="line none"> 1517                                       size_t <a href="include/core_http_client.h.html#407">pathLen</a> )</div><div id="1518" class="line none"> 1518 {</div><div id="1519" class="line none"> 1519     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1520" class="line none"> 1520     char * <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = NULL;</div><div id="1521" class="line none"> 1521     size_t toAddLen = 0U;</div><div id="1522" class="line none"> 1522 </div><div id="1523" class="line none"> 1523     /* Directly passing in these strings to memcpy is a MISRA Rule 7.4 violation</div><div id="1524" class="line none"> 1524      * Due to this we allocate these pointers for MISRA compliance */</div><div id="1525" class="line none"> 1525     const char * pHeaderLineSeparator = <a href="include/core_http_client_private.h.html#64">HTTP_HEADER_LINE_SEPARATOR</a>;</div><div id="1526" class="line none"> 1526     const char * pHttpProtocolVersion = <a href="include/core_http_client_private.h.html#54">HTTP_PROTOCOL_VERSION</a>;</div><div id="1527" class="line none"> 1527     const char * pHttpEmptyPath = <a href="include/core_http_client_private.h.html#60">HTTP_EMPTY_PATH</a>;</div><div id="1528" class="line none"> 1528 </div><div id="1529" class="line none"> 1529     assert( pRequestHeaders != NULL );</div><div id="1530" class="line none"> 1530     assert( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> != NULL );</div><div id="1531" class="line none"> 1531     assert( <a href="include/core_http_client.h.html#400">pMethod</a> != NULL );</div><div id="1532" class="line none"> 1532     assert( <a href="include/core_http_client.h.html#401">methodLen</a> != 0U );</div><div id="1533" class="line none"> 1533 </div><div id="1534" class="line none"> 1534     toAddLen = <a href="include/core_http_client.h.html#401">methodLen</a> +                 \</div><div id="1535" class="line none"> 1535                <a href="include/core_http_client_private.h.html#71">SPACE_CHARACTER_LEN</a> +       \</div><div id="1536" class="line none"> 1536                <a href="include/core_http_client_private.h.html#71">SPACE_CHARACTER_LEN</a> +       \</div><div id="1537" class="line none"> 1537                <a href="include/core_http_client_private.h.html#55">HTTP_PROTOCOL_VERSION_LEN</a> + \</div><div id="1538" class="line none"> 1538                <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a>;</div><div id="1539" class="line none"> 1539 </div><div id="1540" class="line none"> 1540     <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = ( char * ) ( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> );</div><div id="1541" class="line none"> 1541     toAddLen += ( ( <a href="include/core_http_client.h.html#406">pPath</a> == NULL ) || ( <a href="include/core_http_client.h.html#407">pathLen</a> == 0U ) ) ? <a href="include/core_http_client_private.h.html#61">HTTP_EMPTY_PATH_LEN</a> : <a href="include/core_http_client.h.html#407">pathLen</a>;</div><div id="1542" class="line none"> 1542 </div><div id="1543" class="line none"> 1543     if( ( toAddLen + pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ) &gt; pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> )</div><div id="1544" class="line none"> 1544     {</div><div id="1545" class="line none"> 1545         returnStatus = <a href="include/core_http_client.h.html#258">HTTPInsufficientMemory</a>;</div><div id="1546" class="line none"> 1546     }</div><div id="1547" class="line none"> 1547 </div><div id="1548" class="line none"> 1548     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1549" class="line none"> 1549     {</div><div id="1550" class="line none"> 1550         /* Write "&lt;METHOD&gt; &lt;PATH&gt; HTTP/1.1\r\n" to start the HTTP header. */</div><div id="1551" class="line none"> 1551         ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>, <a href="include/core_http_client.h.html#400">pMethod</a>, <a href="include/core_http_client.h.html#401">methodLen</a> );</div><div id="1552" class="line none"> 1552         <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client.h.html#401">methodLen</a> ];</div><div id="1553" class="line none"> 1553 </div><div id="1554" class="line none"> 1554         *<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = <a href="include/core_http_client_private.h.html#70">SPACE_CHARACTER</a>;</div><div id="1555" class="line none"> 1555         <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#71">SPACE_CHARACTER_LEN</a> ];</div><div id="1556" class="line none"> 1556 </div><div id="1557" class="line none"> 1557         /* Use "/" as default value if &lt;PATH&gt; is NULL. */</div><div id="1558" class="line none"> 1558         if( ( <a href="include/core_http_client.h.html#406">pPath</a> == NULL ) || ( <a href="include/core_http_client.h.html#407">pathLen</a> == 0U ) )</div><div id="1559" class="line none"> 1559         {</div><div id="1560" class="line none"> 1560             ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>,</div><div id="1561" class="line none"> 1561                              pHttpEmptyPath,</div><div id="1562" class="line none"> 1562                              <a href="include/core_http_client_private.h.html#61">HTTP_EMPTY_PATH_LEN</a> );</div><div id="1563" class="line none"> 1563             <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#61">HTTP_EMPTY_PATH_LEN</a> ];</div><div id="1564" class="line none"> 1564         }</div><div id="1565" class="line none"> 1565         else</div><div id="1566" class="line none"> 1566         {</div><div id="1567" class="line none"> 1567             ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>, <a href="include/core_http_client.h.html#406">pPath</a>, <a href="include/core_http_client.h.html#407">pathLen</a> );</div><div id="1568" class="line none"> 1568             <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client.h.html#407">pathLen</a> ];</div><div id="1569" class="line none"> 1569         }</div><div id="1570" class="line none"> 1570 </div><div id="1571" class="line none"> 1571         *<a href="include/core_http_client_private.h.html#303">pBufferCur</a> = <a href="include/core_http_client_private.h.html#70">SPACE_CHARACTER</a>;</div><div id="1572" class="line none"> 1572         <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#71">SPACE_CHARACTER_LEN</a> ];</div><div id="1573" class="line none"> 1573 </div><div id="1574" class="line none"> 1574         ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>,</div><div id="1575" class="line none"> 1575                          pHttpProtocolVersion,</div><div id="1576" class="line none"> 1576                          <a href="include/core_http_client_private.h.html#55">HTTP_PROTOCOL_VERSION_LEN</a> );</div><div id="1577" class="line none"> 1577         <a href="include/core_http_client_private.h.html#303">pBufferCur</a> = &amp;<a href="include/core_http_client_private.h.html#303">pBufferCur</a>[ <a href="include/core_http_client_private.h.html#55">HTTP_PROTOCOL_VERSION_LEN</a> ];</div><div id="1578" class="line none"> 1578         ( void ) memcpy( <a href="include/core_http_client_private.h.html#303">pBufferCur</a>,</div><div id="1579" class="line none"> 1579                          pHeaderLineSeparator,</div><div id="1580" class="line none"> 1580                          <a href="include/core_http_client_private.h.html#65">HTTP_HEADER_LINE_SEPARATOR_LEN</a> );</div><div id="1581" class="line none"> 1581         pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = toAddLen;</div><div id="1582" class="line none"> 1582     }</div><div id="1583" class="line none"> 1583 </div><div id="1584" class="line none"> 1584     return returnStatus;</div><div id="1585" class="line none"> 1585 }</div><div id="1586" class="line none"> 1586 </div><div id="1587" class="line none"> 1587 /*-----------------------------------------------------------*/</div><div id="1588" class="line none"> 1588 </div><div id="1589" class="line none"> 1589 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1589">HTTPClient_InitializeRequestHeaders</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1590" class="line none"> 1590                                                   const <a href="include/core_http_client.h.html#423">HTTPRequestInfo_t</a> * pRequestInfo )</div><div id="1591" class="line none"> 1591 {</div><div id="1592" class="line none"> 1592     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1593" class="line none"> 1593 </div><div id="1594" class="line none"> 1594     /* Check for NULL parameters. */</div><div id="1595" class="line none"> 1595     if( pRequestHeaders == NULL )</div><div id="1596" class="line none"> 1596     {</div><div id="1597" class="line none"> 1597         LogError( ( "Parameter check failed: pRequestHeaders is NULL." ) );</div><div id="1598" class="line none"> 1598         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1599" class="line none"> 1599     }</div><div id="1600" class="line none"> 1600     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="1601" class="line none"> 1601     {</div><div id="1602" class="line none"> 1602         LogError( ( "Parameter check failed: pRequestHeaders-&gt;pBuffer is NULL." ) );</div><div id="1603" class="line none"> 1603         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1604" class="line none"> 1604     }</div><div id="1605" class="line none"> 1605     else if( pRequestInfo == NULL )</div><div id="1606" class="line none"> 1606     {</div><div id="1607" class="line none"> 1607         LogError( ( "Parameter check failed: pRequestInfo is NULL." ) );</div><div id="1608" class="line none"> 1608         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1609" class="line none"> 1609     }</div><div id="1610" class="line none"> 1610     else if( pRequestInfo-&gt;<a href="include/core_http_client.h.html#400">pMethod</a> == NULL )</div><div id="1611" class="line none"> 1611     {</div><div id="1612" class="line none"> 1612         LogError( ( "Parameter check failed: pRequestInfo-&gt;pMethod is NULL." ) );</div><div id="1613" class="line none"> 1613         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1614" class="line none"> 1614     }</div><div id="1615" class="line none"> 1615     else if( pRequestInfo-&gt;<a href="include/core_http_client.h.html#414">pHost</a> == NULL )</div><div id="1616" class="line none"> 1616     {</div><div id="1617" class="line none"> 1617         LogError( ( "Parameter check failed: pRequestInfo-&gt;pHost is NULL." ) );</div><div id="1618" class="line none"> 1618         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1619" class="line none"> 1619     }</div><div id="1620" class="line none"> 1620     else if( pRequestInfo-&gt;<a href="include/core_http_client.h.html#401">methodLen</a> == 0U )</div><div id="1621" class="line none"> 1621     {</div><div id="1622" class="line none"> 1622         LogError( ( "Parameter check failed: pRequestInfo-&gt;methodLen must be greater than 0." ) );</div><div id="1623" class="line none"> 1623         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1624" class="line none"> 1624     }</div><div id="1625" class="line none"> 1625     else if( pRequestInfo-&gt;<a href="include/core_http_client.h.html#415">hostLen</a> == 0U )</div><div id="1626" class="line none"> 1626     {</div><div id="1627" class="line none"> 1627         LogError( ( "Parameter check failed: pRequestInfo-&gt;hostLen must be greater than 0." ) );</div><div id="1628" class="line none"> 1628         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1629" class="line none"> 1629     }</div><div id="1630" class="line none"> 1630     else</div><div id="1631" class="line none"> 1631     {</div><div id="1632" class="line none"> 1632         /* Empty else MISRA 15.7 */</div><div id="1633" class="line none"> 1633     }</div><div id="1634" class="line none"> 1634 </div><div id="1635" class="line none"> 1635     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1636" class="line none"> 1636     {</div><div id="1637" class="line none"> 1637         /* Reset application-provided parameters. */</div><div id="1638" class="line none"> 1638         pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> = 0U;</div><div id="1639" class="line none"> 1639 </div><div id="1640" class="line none"> 1640         /* Write "&lt;METHOD&gt; &lt;PATH&gt; HTTP/1.1\r\n" to start the HTTP header. */</div><div id="1641" class="line none"> 1641         returnStatus = <a href="core_http_client.c.html#1513">writeRequestLine</a>( pRequestHeaders,</div><div id="1642" class="line none"> 1642                                          pRequestInfo-&gt;<a href="include/core_http_client.h.html#400">pMethod</a>,</div><div id="1643" class="line none"> 1643                                          pRequestInfo-&gt;<a href="include/core_http_client.h.html#401">methodLen</a>,</div><div id="1644" class="line none"> 1644                                          pRequestInfo-&gt;<a href="include/core_http_client.h.html#406">pPath</a>,</div><div id="1645" class="line none"> 1645                                          pRequestInfo-&gt;<a href="include/core_http_client.h.html#407">pathLen</a> );</div><div id="1646" class="line none"> 1646     }</div><div id="1647" class="line none"> 1647 </div><div id="1648" class="line none"> 1648     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1649" class="line none"> 1649     {</div><div id="1650" class="line none"> 1650         if( ( <a href="include/core_http_client.h.html#125">HTTP_REQUEST_NO_USER_AGENT_FLAG</a> &amp; pRequestInfo-&gt;<a href="include/core_http_client.h.html#422">reqFlags</a> ) == 0U )</div><div id="1651" class="line none"> 1651         {</div><div id="1652" class="line none"> 1652             /* Write "User-Agent: &lt;Value&gt;". */</div><div id="1653" class="line none"> 1653             returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1654" class="line none"> 1654                                       <a href="include/core_http_client_private.h.html#94">HTTP_USER_AGENT_FIELD</a>,</div><div id="1655" class="line none"> 1655                                       <a href="include/core_http_client_private.h.html#95">HTTP_USER_AGENT_FIELD_LEN</a>,</div><div id="1656" class="line none"> 1656                                       HTTP_USER_AGENT_VALUE,</div><div id="1657" class="line none"> 1657                                       <a href="include/core_http_client_private.h.html#98">HTTP_USER_AGENT_VALUE_LEN</a> );</div><div id="1658" class="line none"> 1658         }</div><div id="1659" class="line none"> 1659     }</div><div id="1660" class="line none"> 1660 </div><div id="1661" class="line none"> 1661     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1662" class="line none"> 1662     {</div><div id="1663" class="line none"> 1663         /* Write "Host: &lt;Value&gt;". */</div><div id="1664" class="line none"> 1664         returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1665" class="line none"> 1665                                   <a href="include/core_http_client_private.h.html#96">HTTP_HOST_FIELD</a>,</div><div id="1666" class="line none"> 1666                                   <a href="include/core_http_client_private.h.html#97">HTTP_HOST_FIELD_LEN</a>,</div><div id="1667" class="line none"> 1667                                   pRequestInfo-&gt;<a href="include/core_http_client.h.html#414">pHost</a>,</div><div id="1668" class="line none"> 1668                                   pRequestInfo-&gt;<a href="include/core_http_client.h.html#415">hostLen</a> );</div><div id="1669" class="line none"> 1669     }</div><div id="1670" class="line none"> 1670 </div><div id="1671" class="line none"> 1671     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1672" class="line none"> 1672     {</div><div id="1673" class="line none"> 1673         if( ( <a href="include/core_http_client.h.html#114">HTTP_REQUEST_KEEP_ALIVE_FLAG</a> &amp; pRequestInfo-&gt;<a href="include/core_http_client.h.html#422">reqFlags</a> ) != 0U )</div><div id="1674" class="line none"> 1674         {</div><div id="1675" class="line none"> 1675             /* Write "Connection: keep-alive". */</div><div id="1676" class="line none"> 1676             returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1677" class="line none"> 1677                                       <a href="include/core_http_client_private.h.html#101">HTTP_CONNECTION_FIELD</a>,</div><div id="1678" class="line none"> 1678                                       <a href="include/core_http_client_private.h.html#102">HTTP_CONNECTION_FIELD_LEN</a>,</div><div id="1679" class="line none"> 1679                                       <a href="include/core_http_client_private.h.html#111">HTTP_CONNECTION_KEEP_ALIVE_VALUE</a>,</div><div id="1680" class="line none"> 1680                                       <a href="include/core_http_client_private.h.html#116">HTTP_CONNECTION_KEEP_ALIVE_VALUE_LEN</a> );</div><div id="1681" class="line none"> 1681         }</div><div id="1682" class="line none"> 1682     }</div><div id="1683" class="line none"> 1683 </div><div id="1684" class="line none"> 1684     return returnStatus;</div><div id="1685" class="line none"> 1685 }</div><div id="1686" class="line none"> 1686 </div><div id="1687" class="line none"> 1687 /*-----------------------------------------------------------*/</div><div id="1688" class="line none"> 1688 </div><div id="1689" class="line none"> 1689 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1689">HTTPClient_AddHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1690" class="line none"> 1690                                    const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="1691" class="line none"> 1691                                    size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="1692" class="line none"> 1692                                    const char * pValue,</div><div id="1693" class="line none"> 1693                                    size_t valueLen )</div><div id="1694" class="line none"> 1694 {</div><div id="1695" class="line none"> 1695     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1696" class="line none"> 1696 </div><div id="1697" class="line none"> 1697     /* Check for NULL parameters. */</div><div id="1698" class="line none"> 1698     if( pRequestHeaders == NULL )</div><div id="1699" class="line none"> 1699     {</div><div id="1700" class="line none"> 1700         LogError( ( "Parameter check failed: pRequestHeaders is NULL." ) );</div><div id="1701" class="line none"> 1701         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1702" class="line none"> 1702     }</div><div id="1703" class="line none"> 1703     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="1704" class="line none"> 1704     {</div><div id="1705" class="line none"> 1705         LogError( ( "Parameter check failed: pRequestHeaders-&gt;pBuffer is NULL." ) );</div><div id="1706" class="line none"> 1706         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1707" class="line none"> 1707     }</div><div id="1708" class="line none"> 1708     else if( <a href="include/core_http_client_private.h.html#224">pField</a> == NULL )</div><div id="1709" class="line none"> 1709     {</div><div id="1710" class="line none"> 1710         LogError( ( "Parameter check failed: pField is NULL." ) );</div><div id="1711" class="line none"> 1711         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1712" class="line none"> 1712     }</div><div id="1713" class="line none"> 1713     else if( pValue == NULL )</div><div id="1714" class="line none"> 1714     {</div><div id="1715" class="line none"> 1715         LogError( ( "Parameter check failed: pValue is NULL." ) );</div><div id="1716" class="line none"> 1716         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1717" class="line none"> 1717     }</div><div id="1718" class="line none"> 1718     else if( <a href="include/core_http_client_private.h.html#225">fieldLen</a> == 0U )</div><div id="1719" class="line none"> 1719     {</div><div id="1720" class="line none"> 1720         LogError( ( "Parameter check failed: fieldLen must be greater than 0." ) );</div><div id="1721" class="line none"> 1721         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1722" class="line none"> 1722     }</div><div id="1723" class="line none"> 1723     else if( valueLen == 0U )</div><div id="1724" class="line none"> 1724     {</div><div id="1725" class="line none"> 1725         LogError( ( "Parameter check failed: valueLen must be greater than 0." ) );</div><div id="1726" class="line none"> 1726         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1727" class="line none"> 1727     }</div><div id="1728" class="line none"> 1728     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> &gt; pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> )</div><div id="1729" class="line none"> 1729     {</div><div id="1730" class="line none"> 1730         LogError( ( "Parameter check failed: pRequestHeaders-&gt;headersLen &gt; pRequestHeaders-&gt;bufferLen." ) );</div><div id="1731" class="line none"> 1731         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1732" class="line none"> 1732     }</div><div id="1733" class="line none"> 1733     else</div><div id="1734" class="line none"> 1734     {</div><div id="1735" class="line none"> 1735         /* Empty else MISRA 15.7 */</div><div id="1736" class="line none"> 1736     }</div><div id="1737" class="line none"> 1737 </div><div id="1738" class="line none"> 1738     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1739" class="line none"> 1739     {</div><div id="1740" class="line none"> 1740         returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1741" class="line none"> 1741                                   <a href="include/core_http_client_private.h.html#224">pField</a>, <a href="include/core_http_client_private.h.html#225">fieldLen</a>, pValue, valueLen );</div><div id="1742" class="line none"> 1742     }</div><div id="1743" class="line none"> 1743 </div><div id="1744" class="line none"> 1744     return returnStatus;</div><div id="1745" class="line none"> 1745 }</div><div id="1746" class="line none"> 1746 </div><div id="1747" class="line none"> 1747 /*-----------------------------------------------------------*/</div><div id="1748" class="line none"> 1748 </div><div id="1749" class="line none"> 1749 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1749">HTTPClient_AddRangeHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1750" class="line none"> 1750                                         int32_t rangeStartOrlastNbytes,</div><div id="1751" class="line none"> 1751                                         int32_t rangeEnd )</div><div id="1752" class="line none"> 1752 {</div><div id="1753" class="line none"> 1753     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1754" class="line none"> 1754 </div><div id="1755" class="line none"> 1755     if( pRequestHeaders == NULL )</div><div id="1756" class="line none"> 1756     {</div><div id="1757" class="line none"> 1757         LogError( ( "Parameter check failed: pRequestHeaders is NULL." ) );</div><div id="1758" class="line none"> 1758         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1759" class="line none"> 1759     }</div><div id="1760" class="line none"> 1760     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="1761" class="line none"> 1761     {</div><div id="1762" class="line none"> 1762         LogError( ( "Parameter check failed: pRequestHeaders-&gt;pBuffer is NULL." ) );</div><div id="1763" class="line none"> 1763         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1764" class="line none"> 1764     }</div><div id="1765" class="line none"> 1765     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> &gt; pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> )</div><div id="1766" class="line none"> 1766     {</div><div id="1767" class="line none"> 1767         LogError( ( "Parameter check failed: pRequestHeaders-&gt;headersLen &gt; pRequestHeaders-&gt;bufferLen." ) );</div><div id="1768" class="line none"> 1768         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1769" class="line none"> 1769     }</div><div id="1770" class="line none"> 1770     else if( rangeEnd &lt; <a href="include/core_http_client.h.html#189">HTTP_RANGE_REQUEST_END_OF_FILE</a> )</div><div id="1771" class="line none"> 1771     {</div><div id="1772" class="line none"> 1772         LogError( ( "Parameter check failed: rangeEnd is invalid: "</div><div id="1773" class="line none"> 1773                     "rangeEnd should be &gt;=-1: RangeEnd=%ld", ( long int ) rangeEnd ) );</div><div id="1774" class="line none"> 1774         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1775" class="line none"> 1775     }</div><div id="1776" class="line none"> 1776     else if( ( rangeStartOrlastNbytes &lt; 0 ) &amp;&amp;</div><div id="1777" class="line none"> 1777              ( rangeEnd != <a href="include/core_http_client.h.html#189">HTTP_RANGE_REQUEST_END_OF_FILE</a> ) )</div><div id="1778" class="line none"> 1778     {</div><div id="1779" class="line none"> 1779         LogError( ( "Parameter check failed: Invalid range values: "</div><div id="1780" class="line none"> 1780                     "rangeEnd should be -1 when rangeStart &lt; 0: "</div><div id="1781" class="line none"> 1781                     "RangeStart=%ld, RangeEnd=%ld",</div><div id="1782" class="line none"> 1782                     ( long int ) rangeStartOrlastNbytes, ( long int ) rangeEnd ) );</div><div id="1783" class="line none"> 1783         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1784" class="line none"> 1784     }</div><div id="1785" class="line none"> 1785     else if( ( rangeEnd != <a href="include/core_http_client.h.html#189">HTTP_RANGE_REQUEST_END_OF_FILE</a> ) &amp;&amp;</div><div id="1786" class="line none"> 1786              ( rangeStartOrlastNbytes &gt; rangeEnd ) )</div><div id="1787" class="line none"> 1787     {</div><div id="1788" class="line none"> 1788         LogError( ( "Parameter check failed: Invalid range values: "</div><div id="1789" class="line none"> 1789                     "rangeStart should be &lt; rangeEnd when both are &gt;= 0: "</div><div id="1790" class="line none"> 1790                     "RangeStart=%ld, RangeEnd=%ld",</div><div id="1791" class="line none"> 1791                     ( long int ) rangeStartOrlastNbytes, ( long int ) rangeEnd ) );</div><div id="1792" class="line none"> 1792         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1793" class="line none"> 1793     }</div><div id="1794" class="line none"> 1794     else if( rangeStartOrlastNbytes == INT32_MIN )</div><div id="1795" class="line none"> 1795     {</div><div id="1796" class="line none"> 1796         LogError( ( "Parameter check failed: Arithmetic overflow detected: "</div><div id="1797" class="line none"> 1797                     "rangeStart should be &gt; -2147483648 (INT32_MIN): "</div><div id="1798" class="line none"> 1798                     "RangeStart=%ld",</div><div id="1799" class="line none"> 1799                     ( long int ) rangeStartOrlastNbytes ) );</div><div id="1800" class="line none"> 1800         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="1801" class="line none"> 1801     }</div><div id="1802" class="line none"> 1802     else</div><div id="1803" class="line none"> 1803     {</div><div id="1804" class="line none"> 1804         returnStatus = <a href="core_http_client.c.html#1442">addRangeHeader</a>( pRequestHeaders,</div><div id="1805" class="line none"> 1805                                        rangeStartOrlastNbytes,</div><div id="1806" class="line none"> 1806                                        rangeEnd );</div><div id="1807" class="line none"> 1807     }</div><div id="1808" class="line none"> 1808 </div><div id="1809" class="line none"> 1809     return returnStatus;</div><div id="1810" class="line none"> 1810 }</div><div id="1811" class="line none"> 1811 </div><div id="1812" class="line none"> 1812 /*-----------------------------------------------------------*/</div><div id="1813" class="line none"> 1813 </div><div id="1814" class="line none"> 1814 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1814">HTTPClient_SendHttpData</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="1815" class="line none"> 1815                                       <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="1816" class="line none"> 1816                                       const uint8_t * pData,</div><div id="1817" class="line none"> 1817                                       size_t dataLen )</div><div id="1818" class="line none"> 1818 {</div><div id="1819" class="line none"> 1819     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1820" class="line none"> 1820     const uint8_t * pIndex = pData;</div><div id="1821" class="line none"> 1821     int32_t bytesSent = 0;</div><div id="1822" class="line none"> 1822     size_t bytesRemaining = dataLen;</div><div id="1823" class="line none"> 1823     uint32_t lastSendTimeMs = 0U, timeSinceLastSendMs = 0U;</div><div id="1824" class="line none"> 1824     uint32_t retryTimeoutMs = HTTP_SEND_RETRY_TIMEOUT_MS;</div><div id="1825" class="line none"> 1825 </div><div id="1826" class="line none"> 1826     assert( pTransport != NULL );</div><div id="1827" class="line none"> 1827     assert( pTransport-&gt;<a href="interface/transport_interface.h.html#301">send</a> != NULL );</div><div id="1828" class="line none"> 1828     assert( pData != NULL );</div><div id="1829" class="line none"> 1829 </div><div id="1830" class="line none"> 1830     /* If the timestamp function was undefined by the application, then do not</div><div id="1831" class="line none"> 1831      * retry the transport send. */</div><div id="1832" class="line none"> 1832     if( getTimestampMs == <a href="core_http_client.c.html#523">getZeroTimestampMs</a> )</div><div id="1833" class="line none"> 1833     {</div><div id="1834" class="line none"> 1834         retryTimeoutMs = 0U;</div><div id="1835" class="line none"> 1835     }</div><div id="1836" class="line none"> 1836 </div><div id="1837" class="line none"> 1837     /* Initialize the last send time to allow retries, if 0 bytes are sent on</div><div id="1838" class="line none"> 1838      * the first try. */</div><div id="1839" class="line none"> 1839     lastSendTimeMs = getTimestampMs();</div><div id="1840" class="line none"> 1840 </div><div id="1841" class="line none"> 1841     /* Loop until all data is sent. */</div><div id="1842" class="line none"> 1842     while( ( bytesRemaining &gt; 0UL ) &amp;&amp; ( returnStatus != <a href="include/core_http_client.h.html#227">HTTPNetworkError</a> ) )</div><div id="1843" class="line none"> 1843     {</div><div id="1844" class="line none"> 1844         bytesSent = pTransport-&gt;<a href="interface/transport_interface.h.html#301">send</a>( pTransport-&gt;<a href="interface/transport_interface.h.html#303">pNetworkContext</a>,</div><div id="1845" class="line none"> 1845                                       pIndex,</div><div id="1846" class="line none"> 1846                                       bytesRemaining );</div><div id="1847" class="line none"> 1847 </div><div id="1848" class="line none"> 1848         /* BytesSent less than zero is an error. */</div><div id="1849" class="line none"> 1849         if( bytesSent &lt; 0 )</div><div id="1850" class="line none"> 1850         {</div><div id="1851" class="line none"> 1851             LogError( ( "Failed to send data: Transport send error: "</div><div id="1852" class="line none"> 1852                         "TransportStatus=%ld", ( long int ) bytesSent ) );</div><div id="1853" class="line none"> 1853             returnStatus = <a href="include/core_http_client.h.html#227">HTTPNetworkError</a>;</div><div id="1854" class="line none"> 1854         }</div><div id="1855" class="line none"> 1855         else if( bytesSent &gt; 0 )</div><div id="1856" class="line none"> 1856         {</div><div id="1857" class="line none"> 1857             /* It is a bug in the application's transport send implementation if</div><div id="1858" class="line none"> 1858              * more bytes than expected are sent. To avoid a possible overflow</div><div id="1859" class="line none"> 1859              * in converting bytesRemaining from unsigned to signed, this assert</div><div id="1860" class="line none"> 1860              * must exist after the check for bytesSent being negative. */</div><div id="1861" class="line none"> 1861             assert( ( size_t ) bytesSent &lt;= bytesRemaining );</div><div id="1862" class="line none"> 1862 </div><div id="1863" class="line none"> 1863             /* Record the most recent time of successful transmission. */</div><div id="1864" class="line none"> 1864             lastSendTimeMs = getTimestampMs();</div><div id="1865" class="line none"> 1865 </div><div id="1866" class="line none"> 1866             bytesRemaining -= ( size_t ) bytesSent;</div><div id="1867" class="line none"> 1867             pIndex = &amp;pIndex[ bytesSent ];</div><div id="1868" class="line none"> 1868             LogDebug( ( "Sent data over the transport: "</div><div id="1869" class="line none"> 1869                         "BytesSent=%ld, BytesRemaining=%lu, TotalBytesSent=%lu",</div><div id="1870" class="line none"> 1870                         ( long int ) bytesSent,</div><div id="1871" class="line none"> 1871                         ( unsigned long ) bytesRemaining,</div><div id="1872" class="line none"> 1872                         ( unsigned long ) ( dataLen - bytesRemaining ) ) );</div><div id="1873" class="line none"> 1873         }</div><div id="1874" class="line none"> 1874         else</div><div id="1875" class="line none"> 1875         {</div><div id="1876" class="line none"> 1876             /* No bytes were sent over the network. */</div><div id="1877" class="line none"> 1877             timeSinceLastSendMs = getTimestampMs() - lastSendTimeMs;</div><div id="1878" class="line none"> 1878 </div><div id="1879" class="line none"> 1879             /* Check for timeout if we have been waiting to send any data over</div><div id="1880" class="line none"> 1880              * the network. */</div><div id="1881" class="line none"> 1881             if( timeSinceLastSendMs &gt;= retryTimeoutMs )</div><div id="1882" class="line none"> 1882             {</div><div id="1883" class="line none"> 1883                 LogError( ( "Unable to send packet: Timed out in transport send." ) );</div><div id="1884" class="line none"> 1884                 returnStatus = <a href="include/core_http_client.h.html#227">HTTPNetworkError</a>;</div><div id="1885" class="line none"> 1885             }</div><div id="1886" class="line none"> 1886         }</div><div id="1887" class="line none"> 1887     }</div><div id="1888" class="line none"> 1888 </div><div id="1889" class="line none"> 1889     return returnStatus;</div><div id="1890" class="line none"> 1890 }</div><div id="1891" class="line none"> 1891 </div><div id="1892" class="line none"> 1892 /*-----------------------------------------------------------*/</div><div id="1893" class="line none"> 1893 </div><div id="1894" class="line none"> 1894 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1894">addContentLengthHeader</a>( <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1895" class="line none"> 1895                                             size_t <a href="include/core_http_client.h.html#554">contentLength</a> )</div><div id="1896" class="line none"> 1896 {</div><div id="1897" class="line none"> 1897     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1898" class="line none"> 1898     char pContentLengthValue[ <a href="include/core_http_client_private.h.html#145">MAX_INT32_NO_OF_DECIMAL_DIGITS</a> ] = { '\0' };</div><div id="1899" class="line none"> 1899     uint8_t contentLengthValueNumBytes = 0U;</div><div id="1900" class="line none"> 1900 </div><div id="1901" class="line none"> 1901     assert( pRequestHeaders != NULL );</div><div id="1902" class="line none"> 1902     assert( <a href="include/core_http_client.h.html#554">contentLength</a> &gt; 0U );</div><div id="1903" class="line none"> 1903 </div><div id="1904" class="line none"> 1904     contentLengthValueNumBytes = <a href="core_http_client.c.html#1238">convertInt32ToAscii</a>( ( int32_t ) <a href="include/core_http_client.h.html#554">contentLength</a>,</div><div id="1905" class="line none"> 1905                                                       pContentLengthValue,</div><div id="1906" class="line none"> 1906                                                       sizeof( pContentLengthValue ) );</div><div id="1907" class="line none"> 1907 </div><div id="1908" class="line none"> 1908     returnStatus = <a href="core_http_client.c.html#1342">addHeader</a>( pRequestHeaders,</div><div id="1909" class="line none"> 1909                               <a href="include/core_http_client_private.h.html#103">HTTP_CONTENT_LENGTH_FIELD</a>,</div><div id="1910" class="line none"> 1910                               <a href="include/core_http_client_private.h.html#104">HTTP_CONTENT_LENGTH_FIELD_LEN</a>,</div><div id="1911" class="line none"> 1911                               pContentLengthValue,</div><div id="1912" class="line none"> 1912                               contentLengthValueNumBytes );</div><div id="1913" class="line none"> 1913 </div><div id="1914" class="line none"> 1914     if( returnStatus != <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1915" class="line none"> 1915     {</div><div id="1916" class="line none"> 1916         LogError( ( "Failed to write Content-Length header to the request "</div><div id="1917" class="line none"> 1917                     "header buffer: ContentLengthValue: %lu",</div><div id="1918" class="line none"> 1918                     ( unsigned long ) <a href="include/core_http_client.h.html#554">contentLength</a> ) );</div><div id="1919" class="line none"> 1919     }</div><div id="1920" class="line none"> 1920 </div><div id="1921" class="line none"> 1921     return returnStatus;</div><div id="1922" class="line none"> 1922 }</div><div id="1923" class="line none"> 1923 </div><div id="1924" class="line none"> 1924 /*-----------------------------------------------------------*/</div><div id="1925" class="line none"> 1925 </div><div id="1926" class="line none"> 1926 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1926">HTTPClient_SendHttpHeaders</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="1927" class="line none"> 1927                                          <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="1928" class="line none"> 1928                                          <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="1929" class="line none"> 1929                                          size_t reqBodyLen,</div><div id="1930" class="line none"> 1930                                          uint32_t sendFlags )</div><div id="1931" class="line none"> 1931 {</div><div id="1932" class="line none"> 1932     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1933" class="line none"> 1933     uint8_t shouldSendContentLength = 0U;</div><div id="1934" class="line none"> 1934 </div><div id="1935" class="line none"> 1935     assert( pTransport != NULL );</div><div id="1936" class="line none"> 1936     assert( pTransport-&gt;<a href="interface/transport_interface.h.html#301">send</a> != NULL );</div><div id="1937" class="line none"> 1937     assert( pRequestHeaders != NULL );</div><div id="1938" class="line none"> 1938 </div><div id="1939" class="line none"> 1939     /* Send the content length header if the flag to disable is not set and the</div><div id="1940" class="line none"> 1940      * body length is greater than zero. */</div><div id="1941" class="line none"> 1941     shouldSendContentLength = ( ( ( sendFlags &amp; <a href="include/core_http_client.h.html#92">HTTP_SEND_DISABLE_CONTENT_LENGTH_FLAG</a> ) == 0U ) &amp;&amp;</div><div id="1942" class="line none"> 1942                                 ( reqBodyLen &gt; 0U ) ) ? 1U : 0U;</div><div id="1943" class="line none"> 1943 </div><div id="1944" class="line none"> 1944     if( shouldSendContentLength == 1U )</div><div id="1945" class="line none"> 1945     {</div><div id="1946" class="line none"> 1946         returnStatus = <a href="core_http_client.c.html#1894">addContentLengthHeader</a>( pRequestHeaders, reqBodyLen );</div><div id="1947" class="line none"> 1947     }</div><div id="1948" class="line none"> 1948 </div><div id="1949" class="line none"> 1949     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="1950" class="line none"> 1950     {</div><div id="1951" class="line none"> 1951         LogDebug( ( "Sending HTTP request headers: HeaderBytes=%lu",</div><div id="1952" class="line none"> 1952                     ( unsigned long ) ( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ) ) );</div><div id="1953" class="line none"> 1953         returnStatus = <a href="core_http_client.c.html#1814">HTTPClient_SendHttpData</a>( pTransport,</div><div id="1954" class="line none"> 1954                                                 getTimestampMs,</div><div id="1955" class="line none"> 1955                                                 pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="1956" class="line none"> 1956                                                 pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> );</div><div id="1957" class="line none"> 1957     }</div><div id="1958" class="line none"> 1958 </div><div id="1959" class="line none"> 1959     return returnStatus;</div><div id="1960" class="line none"> 1960 }</div><div id="1961" class="line none"> 1961 </div><div id="1962" class="line none"> 1962 /*-----------------------------------------------------------*/</div><div id="1963" class="line none"> 1963 </div><div id="1964" class="line none"> 1964 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1964">sendHttpBody</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="1965" class="line none"> 1965                                   <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="1966" class="line none"> 1966                                   const uint8_t * pRequestBodyBuf,</div><div id="1967" class="line none"> 1967                                   size_t reqBodyBufLen )</div><div id="1968" class="line none"> 1968 {</div><div id="1969" class="line none"> 1969     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1970" class="line none"> 1970 </div><div id="1971" class="line none"> 1971     assert( pTransport != NULL );</div><div id="1972" class="line none"> 1972     assert( pTransport-&gt;<a href="interface/transport_interface.h.html#301">send</a> != NULL );</div><div id="1973" class="line none"> 1973     assert( pRequestBodyBuf != NULL );</div><div id="1974" class="line none"> 1974 </div><div id="1975" class="line none"> 1975     /* Send the request body. */</div><div id="1976" class="line none"> 1976     LogDebug( ( "Sending the HTTP request body: BodyBytes=%lu",</div><div id="1977" class="line none"> 1977                 ( unsigned long ) reqBodyBufLen ) );</div><div id="1978" class="line none"> 1978     returnStatus = <a href="core_http_client.c.html#1814">HTTPClient_SendHttpData</a>( pTransport, getTimestampMs, pRequestBodyBuf, reqBodyBufLen );</div><div id="1979" class="line none"> 1979 </div><div id="1980" class="line none"> 1980     return returnStatus;</div><div id="1981" class="line none"> 1981 }</div><div id="1982" class="line none"> 1982 </div><div id="1983" class="line none"> 1983 /*-----------------------------------------------------------*/</div><div id="1984" class="line none"> 1984 </div><div id="1985" class="line none"> 1985 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#1985">getFinalResponseStatus</a>( <a href="include/core_http_client_private.h.html#215">HTTPParsingState_t</a> parsingState,</div><div id="1986" class="line none"> 1986                                             size_t totalReceived,</div><div id="1987" class="line none"> 1987                                             size_t responseBufferLen )</div><div id="1988" class="line none"> 1988 {</div><div id="1989" class="line none"> 1989     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="1990" class="line none"> 1990 </div><div id="1991" class="line none"> 1991     assert( parsingState &gt;= <a href="include/core_http_client_private.h.html#212">HTTP_PARSING_NONE</a> &amp;&amp;</div><div id="1992" class="line none"> 1992             parsingState &lt;= <a href="include/core_http_client_private.h.html#214">HTTP_PARSING_COMPLETE</a> );</div><div id="1993" class="line none"> 1993     assert( totalReceived &lt;= responseBufferLen );</div><div id="1994" class="line none"> 1994 </div><div id="1995" class="line none"> 1995     /* If no parsing occurred, that means network data was never received. */</div><div id="1996" class="line none"> 1996     if( parsingState == <a href="include/core_http_client_private.h.html#212">HTTP_PARSING_NONE</a> )</div><div id="1997" class="line none"> 1997     {</div><div id="1998" class="line none"> 1998         LogError( ( "Response not received: Zero returned from "</div><div id="1999" class="line none"> 1999                     "transport recv: totalReceived=%lu",</div><div id="2000" class="line none"> 2000                     ( unsigned long ) totalReceived ) );</div><div id="2001" class="line none"> 2001         returnStatus = <a href="include/core_http_client.h.html#246">HTTPNoResponse</a>;</div><div id="2002" class="line none"> 2002     }</div><div id="2003" class="line none"> 2003     else if( parsingState == <a href="include/core_http_client_private.h.html#213">HTTP_PARSING_INCOMPLETE</a> )</div><div id="2004" class="line none"> 2004     {</div><div id="2005" class="line none"> 2005         if( totalReceived == responseBufferLen )</div><div id="2006" class="line none"> 2006         {</div><div id="2007" class="line none"> 2007             LogError( ( "Cannot receive complete response from transport"</div><div id="2008" class="line none"> 2008                         " interface: Response buffer has insufficient "</div><div id="2009" class="line none"> 2009                         "space: responseBufferLen=%lu",</div><div id="2010" class="line none"> 2010                         ( unsigned long ) responseBufferLen ) );</div><div id="2011" class="line none"> 2011             returnStatus = <a href="include/core_http_client.h.html#258">HTTPInsufficientMemory</a>;</div><div id="2012" class="line none"> 2012         }</div><div id="2013" class="line none"> 2013         else</div><div id="2014" class="line none"> 2014         {</div><div id="2015" class="line none"> 2015             LogError( ( "Received partial response from transport "</div><div id="2016" class="line none"> 2016                         "receive(): ResponseSize=%lu, TotalBufferSize=%lu",</div><div id="2017" class="line none"> 2017                         ( unsigned long ) totalReceived,</div><div id="2018" class="line none"> 2018                         ( unsigned long ) ( responseBufferLen - totalReceived ) ) );</div><div id="2019" class="line none"> 2019             returnStatus = <a href="include/core_http_client.h.html#235">HTTPPartialResponse</a>;</div><div id="2020" class="line none"> 2020         }</div><div id="2021" class="line none"> 2021     }</div><div id="2022" class="line none"> 2022     else</div><div id="2023" class="line none"> 2023     {</div><div id="2024" class="line none"> 2024         /* Empty else for MISRA 15.7 compliance. */</div><div id="2025" class="line none"> 2025     }</div><div id="2026" class="line none"> 2026 </div><div id="2027" class="line none"> 2027     return returnStatus;</div><div id="2028" class="line none"> 2028 }</div><div id="2029" class="line none"> 2029 </div><div id="2030" class="line none"> 2030 /*-----------------------------------------------------------*/</div><div id="2031" class="line none"> 2031 </div><div id="2032" class="line none"> 2032 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2032">HTTPClient_ReceiveAndParseHttpResponse</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="2033" class="line none"> 2033                                                      <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="2034" class="line none"> 2034                                                      const <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders )</div><div id="2035" class="line none"> 2035 {</div><div id="2036" class="line none"> 2036     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2037" class="line none"> 2037     size_t totalReceived = 0U;</div><div id="2038" class="line none"> 2038     int32_t currentReceived = 0;</div><div id="2039" class="line none"> 2039     <a href="include/core_http_client_private.h.html#308">HTTPParsingContext_t</a> parsingContext = { 0 };</div><div id="2040" class="line none"> 2040     uint8_t shouldRecv = 1U, shouldParse = 1U, timeoutReached = 0U;</div><div id="2041" class="line none"> 2041     uint32_t lastRecvTimeMs = 0U, timeSinceLastRecvMs = 0U;</div><div id="2042" class="line none"> 2042     uint32_t retryTimeoutMs = HTTP_RECV_RETRY_TIMEOUT_MS;</div><div id="2043" class="line none"> 2043 </div><div id="2044" class="line none"> 2044     assert( pTransport != NULL );</div><div id="2045" class="line none"> 2045     assert( pTransport-&gt;<a href="interface/transport_interface.h.html#300">recv</a> != NULL );</div><div id="2046" class="line none"> 2046     assert( <a href="include/core_http_client_private.h.html#300">pResponse</a> != NULL );</div><div id="2047" class="line none"> 2047     assert( pRequestHeaders != NULL );</div><div id="2048" class="line none"> 2048 </div><div id="2049" class="line none"> 2049     /* Initialize the parsing context for parsing the response received from the</div><div id="2050" class="line none"> 2050      * network. */</div><div id="2051" class="line none"> 2051     <a href="core_http_client.c.html#1000">initializeParsingContextForFirstResponse</a>( &amp;parsingContext, pRequestHeaders );</div><div id="2052" class="line none"> 2052 </div><div id="2053" class="line none"> 2053     /* If the timestamp function was undefined by the application, then do not</div><div id="2054" class="line none"> 2054      * retry the transport receive. */</div><div id="2055" class="line none"> 2055     if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a> == <a href="core_http_client.c.html#523">getZeroTimestampMs</a> )</div><div id="2056" class="line none"> 2056     {</div><div id="2057" class="line none"> 2057         retryTimeoutMs = 0U;</div><div id="2058" class="line none"> 2058     }</div><div id="2059" class="line none"> 2059 </div><div id="2060" class="line none"> 2060     /* Initialize the last send time to allow retries, if 0 bytes are sent on</div><div id="2061" class="line none"> 2061      * the first try. */</div><div id="2062" class="line none"> 2062     lastRecvTimeMs = <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a>();</div><div id="2063" class="line none"> 2063 </div><div id="2064" class="line none"> 2064     while( shouldRecv == 1U )</div><div id="2065" class="line none"> 2065     {</div><div id="2066" class="line none"> 2066         /* Receive the HTTP response data into the pResponse-&gt;pBuffer. */</div><div id="2067" class="line none"> 2067         currentReceived = pTransport-&gt;<a href="interface/transport_interface.h.html#300">recv</a>( pTransport-&gt;<a href="interface/transport_interface.h.html#303">pNetworkContext</a>,</div><div id="2068" class="line none"> 2068                                             &amp;( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a>[ totalReceived ] ),</div><div id="2069" class="line none"> 2069                                             <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> - totalReceived );</div><div id="2070" class="line none"> 2070 </div><div id="2071" class="line none"> 2071         /* Transport receive errors are negative. */</div><div id="2072" class="line none"> 2072         if( currentReceived &lt; 0 )</div><div id="2073" class="line none"> 2073         {</div><div id="2074" class="line none"> 2074             LogError( ( "Failed to receive HTTP data: Transport recv() "</div><div id="2075" class="line none"> 2075                         "returned error: TransportStatus=%ld",</div><div id="2076" class="line none"> 2076                         ( long int ) currentReceived ) );</div><div id="2077" class="line none"> 2077             returnStatus = <a href="include/core_http_client.h.html#227">HTTPNetworkError</a>;</div><div id="2078" class="line none"> 2078 </div><div id="2079" class="line none"> 2079             /* Do not invoke the parser on network errors. */</div><div id="2080" class="line none"> 2080             shouldParse = 0U;</div><div id="2081" class="line none"> 2081         }</div><div id="2082" class="line none"> 2082         else if( currentReceived &gt; 0 )</div><div id="2083" class="line none"> 2083         {</div><div id="2084" class="line none"> 2084             /* Reset the time of the last data received when data is received. */</div><div id="2085" class="line none"> 2085             lastRecvTimeMs = <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a>();</div><div id="2086" class="line none"> 2086 </div><div id="2087" class="line none"> 2087             /* Parsing is done on data as soon as it is received from the network.</div><div id="2088" class="line none"> 2088              * Because we cannot know how large the HTTP response will be in</div><div id="2089" class="line none"> 2089              * total, parsing will tell us if the end of the message is reached.*/</div><div id="2090" class="line none"> 2090             shouldParse = 1U;</div><div id="2091" class="line none"> 2091 </div><div id="2092" class="line none"> 2092             /* MISRA compliance requires the cast to an unsigned type, since we have checked that</div><div id="2093" class="line none"> 2093              * the value of current received is greater than 0 we don't need to worry about int overflow. */</div><div id="2094" class="line none"> 2094             totalReceived += ( size_t ) currentReceived;</div><div id="2095" class="line none"> 2095         }</div><div id="2096" class="line none"> 2096         else</div><div id="2097" class="line none"> 2097         {</div><div id="2098" class="line none"> 2098             timeSinceLastRecvMs = <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a>() - lastRecvTimeMs;</div><div id="2099" class="line none"> 2099             /* Do not invoke the response parsing for intermediate zero data. */</div><div id="2100" class="line none"> 2100             shouldParse = 0U;</div><div id="2101" class="line none"> 2101 </div><div id="2102" class="line none"> 2102             /* Check if the allowed elapsed time between non-zero data has been</div><div id="2103" class="line none"> 2103              * reached. */</div><div id="2104" class="line none"> 2104             if( timeSinceLastRecvMs &gt;= retryTimeoutMs )</div><div id="2105" class="line none"> 2105             {</div><div id="2106" class="line none"> 2106                 /* Invoke the parsing upon this final zero data to indicate</div><div id="2107" class="line none"> 2107                  * to the parser that there is no more data available from the</div><div id="2108" class="line none"> 2108                  * server. */</div><div id="2109" class="line none"> 2109                 shouldParse = 1U;</div><div id="2110" class="line none"> 2110                 timeoutReached = 1U;</div><div id="2111" class="line none"> 2111             }</div><div id="2112" class="line none"> 2112         }</div><div id="2113" class="line none"> 2113 </div><div id="2114" class="line none"> 2114         if( shouldParse == 1U )</div><div id="2115" class="line none"> 2115         {</div><div id="2116" class="line none"> 2116             /* Data is received into the buffer is immediately parsed. Parsing</div><div id="2117" class="line none"> 2117              * is invoked even with a length of zero. A length of zero indicates</div><div id="2118" class="line none"> 2118              * to the parser that there is no more data from the server (EOF).</div><div id="2119" class="line none"> 2119              * Additionally MISRA compliance requires the cast to a larger type, but since we</div><div id="2120" class="line none"> 2120              * know that the value is greater than 0 we don't need to worry about int overflow. */</div><div id="2121" class="line none"> 2121             returnStatus = <a href="core_http_client.c.html#1161">parseHttpResponse</a>( &amp;parsingContext,</div><div id="2122" class="line none"> 2122                                               <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="2123" class="line none"> 2123                                               ( uint64_t ) currentReceived );</div><div id="2124" class="line none"> 2124         }</div><div id="2125" class="line none"> 2125 </div><div id="2126" class="line none"> 2126         /* Reading should continue if there are no errors in the transport receive</div><div id="2127" class="line none"> 2127          * or parsing, the retry on zero data timeout has not been reached, the</div><div id="2128" class="line none"> 2128          * parser indicated the response message is not finished, and there is</div><div id="2129" class="line none"> 2129          * room in the response buffer. */</div><div id="2130" class="line none"> 2130         shouldRecv = ( ( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> ) &amp;&amp;</div><div id="2131" class="line none"> 2131                        ( timeoutReached == 0U ) &amp;&amp;</div><div id="2132" class="line none"> 2132                        ( parsingContext.<a href="include/core_http_client_private.h.html#299">state</a> != <a href="include/core_http_client_private.h.html#214">HTTP_PARSING_COMPLETE</a> ) &amp;&amp;</div><div id="2133" class="line none"> 2133                        ( totalReceived &lt; <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> ) ) ? 1U : 0U;</div><div id="2134" class="line none"> 2134     }</div><div id="2135" class="line none"> 2135 </div><div id="2136" class="line none"> 2136     if( ( returnStatus == <a href="include/core_http_client.h.html#324">HTTPParserPaused</a> ) &amp;&amp;</div><div id="2137" class="line none"> 2137         ( ( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#575">respOptionFlags</a> &amp; <a href="include/core_http_client.h.html#175">HTTP_RESPONSE_DO_NOT_PARSE_BODY_FLAG</a> ) != 0U ) )</div><div id="2138" class="line none"> 2138     {</div><div id="2139" class="line none"> 2139         returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2140" class="line none"> 2140 </div><div id="2141" class="line none"> 2141         /* There may be dangling data if we parse with do not parse body flag.</div><div id="2142" class="line none"> 2142          * We expose this data through body to let the applications access it. */</div><div id="2143" class="line none"> 2143         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a> = ( const uint8_t * ) parsingContext.<a href="include/core_http_client_private.h.html#303">pBufferCur</a>;</div><div id="2144" class="line none"> 2144 </div><div id="2145" class="line none"> 2145         /* MISRA Ref 11.4.1 [Casting pointer to int] */</div><div id="2146" class="line none"> 2146         /* More details at: https://github.com/FreeRTOS/coreHTTP/blob/main/MISRA.md#rule-114 */</div><div id="2147" class="line none"> 2147         /* coverity[misra_c_2012_rule_11_4_violation] */</div><div id="2148" class="line none"> 2148         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#538">bodyLen</a> = totalReceived - ( size_t ) ( ( ( uintptr_t ) <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#531">pBody</a> ) - ( ( uintptr_t ) <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> ) );</div><div id="2149" class="line none"> 2149     }</div><div id="2150" class="line none"> 2150 </div><div id="2151" class="line none"> 2151     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="2152" class="line none"> 2152     {</div><div id="2153" class="line none"> 2153         /* If there are errors in receiving from the network or during parsing,</div><div id="2154" class="line none"> 2154          * the final status of the response message is derived from the state of</div><div id="2155" class="line none"> 2155          * the parsing and how much data is in the buffer. */</div><div id="2156" class="line none"> 2156         returnStatus = <a href="core_http_client.c.html#1985">getFinalResponseStatus</a>( parsingContext.<a href="include/core_http_client_private.h.html#299">state</a>,</div><div id="2157" class="line none"> 2157                                                totalReceived,</div><div id="2158" class="line none"> 2158                                                <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> );</div><div id="2159" class="line none"> 2159     }</div><div id="2160" class="line none"> 2160 </div><div id="2161" class="line none"> 2161     return returnStatus;</div><div id="2162" class="line none"> 2162 }</div><div id="2163" class="line none"> 2163 </div><div id="2164" class="line none"> 2164 /*-----------------------------------------------------------*/</div><div id="2165" class="line none"> 2165 </div><div id="2166" class="line none"> 2166 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2166">sendHttpRequest</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="2167" class="line none"> 2167                                      <a href="include/core_http_client.h.html#463">HTTPClient_GetCurrentTimeFunc_t</a> getTimestampMs,</div><div id="2168" class="line none"> 2168                                      <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="2169" class="line none"> 2169                                      const uint8_t * pRequestBodyBuf,</div><div id="2170" class="line none"> 2170                                      size_t reqBodyBufLen,</div><div id="2171" class="line none"> 2171                                      uint32_t sendFlags )</div><div id="2172" class="line none"> 2172 {</div><div id="2173" class="line none"> 2173     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2174" class="line none"> 2174 </div><div id="2175" class="line none"> 2175     assert( pTransport != NULL );</div><div id="2176" class="line none"> 2176     assert( pRequestHeaders != NULL );</div><div id="2177" class="line none"> 2177     assert( ( pRequestBodyBuf != NULL ) ||</div><div id="2178" class="line none"> 2178             ( ( pRequestBodyBuf == NULL ) &amp;&amp; ( reqBodyBufLen == 0 ) ) );</div><div id="2179" class="line none"> 2179     assert( getTimestampMs != NULL );</div><div id="2180" class="line none"> 2180 </div><div id="2181" class="line none"> 2181     /* Send the headers, which are at one location in memory. */</div><div id="2182" class="line none"> 2182     returnStatus = <a href="core_http_client.c.html#1926">HTTPClient_SendHttpHeaders</a>( pTransport,</div><div id="2183" class="line none"> 2183                                                getTimestampMs,</div><div id="2184" class="line none"> 2184                                                pRequestHeaders,</div><div id="2185" class="line none"> 2185                                                reqBodyBufLen,</div><div id="2186" class="line none"> 2186                                                sendFlags );</div><div id="2187" class="line none"> 2187 </div><div id="2188" class="line none"> 2188     /* Send the body, which is at another location in memory. */</div><div id="2189" class="line none"> 2189     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="2190" class="line none"> 2190     {</div><div id="2191" class="line none"> 2191         if( pRequestBodyBuf != NULL )</div><div id="2192" class="line none"> 2192         {</div><div id="2193" class="line none"> 2193             returnStatus = <a href="core_http_client.c.html#1964">sendHttpBody</a>( pTransport,</div><div id="2194" class="line none"> 2194                                          getTimestampMs,</div><div id="2195" class="line none"> 2195                                          pRequestBodyBuf,</div><div id="2196" class="line none"> 2196                                          reqBodyBufLen );</div><div id="2197" class="line none"> 2197         }</div><div id="2198" class="line none"> 2198         else</div><div id="2199" class="line none"> 2199         {</div><div id="2200" class="line none"> 2200             LogDebug( ( "A request body was not sent: pRequestBodyBuf is NULL." ) );</div><div id="2201" class="line none"> 2201         }</div><div id="2202" class="line none"> 2202     }</div><div id="2203" class="line none"> 2203 </div><div id="2204" class="line none"> 2204     return returnStatus;</div><div id="2205" class="line none"> 2205 }</div><div id="2206" class="line none"> 2206 </div><div id="2207" class="line none"> 2207 /*-----------------------------------------------------------*/</div><div id="2208" class="line none"> 2208 </div><div id="2209" class="line none"> 2209 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2209">HTTPClient_Send</a>( const <a href="interface/transport_interface.h.html#304">TransportInterface_t</a> * pTransport,</div><div id="2210" class="line none"> 2210                               <a href="include/core_http_client.h.html#389">HTTPRequestHeaders_t</a> * pRequestHeaders,</div><div id="2211" class="line none"> 2211                               const uint8_t * pRequestBodyBuf,</div><div id="2212" class="line none"> 2212                               size_t reqBodyBufLen,</div><div id="2213" class="line none"> 2213                               <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="2214" class="line none"> 2214                               uint32_t sendFlags )</div><div id="2215" class="line none"> 2215 {</div><div id="2216" class="line none"> 2216     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2217" class="line none"> 2217 </div><div id="2218" class="line none"> 2218     if( pTransport == NULL )</div><div id="2219" class="line none"> 2219     {</div><div id="2220" class="line none"> 2220         LogError( ( "Parameter check failed: pTransport interface is NULL." ) );</div><div id="2221" class="line none"> 2221     }</div><div id="2222" class="line none"> 2222     else if( pTransport-&gt;<a href="interface/transport_interface.h.html#301">send</a> == NULL )</div><div id="2223" class="line none"> 2223     {</div><div id="2224" class="line none"> 2224         LogError( ( "Parameter check failed: pTransport-&gt;send is NULL." ) );</div><div id="2225" class="line none"> 2225     }</div><div id="2226" class="line none"> 2226     else if( pTransport-&gt;<a href="interface/transport_interface.h.html#300">recv</a> == NULL )</div><div id="2227" class="line none"> 2227     {</div><div id="2228" class="line none"> 2228         LogError( ( "Parameter check failed: pTransport-&gt;recv is NULL." ) );</div><div id="2229" class="line none"> 2229     }</div><div id="2230" class="line none"> 2230     else if( pRequestHeaders == NULL )</div><div id="2231" class="line none"> 2231     {</div><div id="2232" class="line none"> 2232         LogError( ( "Parameter check failed: pRequestHeaders is NULL." ) );</div><div id="2233" class="line none"> 2233     }</div><div id="2234" class="line none"> 2234     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="2235" class="line none"> 2235     {</div><div id="2236" class="line none"> 2236         LogError( ( "Parameter check failed: pRequestHeaders-&gt;pBuffer is NULL." ) );</div><div id="2237" class="line none"> 2237     }</div><div id="2238" class="line none"> 2238     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> &lt; <a href="include/core_http_client_private.h.html#204">HTTP_MINIMUM_REQUEST_LINE_LENGTH</a> )</div><div id="2239" class="line none"> 2239     {</div><div id="2240" class="line none"> 2240         LogError( ( "Parameter check failed: pRequestHeaders-&gt;headersLen "</div><div id="2241" class="line none"> 2241                     "does not meet minimum the required length. "</div><div id="2242" class="line none"> 2242                     "MinimumRequiredLength=%u, HeadersLength=%lu",</div><div id="2243" class="line none"> 2243                     <a href="include/core_http_client_private.h.html#204">HTTP_MINIMUM_REQUEST_LINE_LENGTH</a>,</div><div id="2244" class="line none"> 2244                     ( unsigned long ) ( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> ) ) );</div><div id="2245" class="line none"> 2245     }</div><div id="2246" class="line none"> 2246     else if( pRequestHeaders-&gt;<a href="include/core_http_client.h.html#388">headersLen</a> &gt; pRequestHeaders-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> )</div><div id="2247" class="line none"> 2247     {</div><div id="2248" class="line none"> 2248         LogError( ( "Parameter check failed: pRequestHeaders-&gt;headersLen &gt; "</div><div id="2249" class="line none"> 2249                     "pRequestHeaders-&gt;bufferLen." ) );</div><div id="2250" class="line none"> 2250     }</div><div id="2251" class="line none"> 2251     else if( <a href="include/core_http_client_private.h.html#300">pResponse</a> == NULL )</div><div id="2252" class="line none"> 2252     {</div><div id="2253" class="line none"> 2253         LogError( ( "Parameter check failed: pResponse is NULL. " ) );</div><div id="2254" class="line none"> 2254     }</div><div id="2255" class="line none"> 2255     else if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="2256" class="line none"> 2256     {</div><div id="2257" class="line none"> 2257         LogError( ( "Parameter check failed: pResponse-&gt;pBuffer is NULL." ) );</div><div id="2258" class="line none"> 2258     }</div><div id="2259" class="line none"> 2259     else if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> == 0U )</div><div id="2260" class="line none"> 2260     {</div><div id="2261" class="line none"> 2261         LogError( ( "Parameter check failed: pResponse-&gt;bufferLen is zero." ) );</div><div id="2262" class="line none"> 2262     }</div><div id="2263" class="line none"> 2263     else if( ( pRequestBodyBuf == NULL ) &amp;&amp; ( reqBodyBufLen &gt; 0U ) )</div><div id="2264" class="line none"> 2264     {</div><div id="2265" class="line none"> 2265         /* If there is no body to send we must ensure that the reqBodyBufLen is</div><div id="2266" class="line none"> 2266          * zero so that no Content-Length header is automatically written. */</div><div id="2267" class="line none"> 2267         LogError( ( "Parameter check failed: pRequestBodyBuf is NULL, but "</div><div id="2268" class="line none"> 2268                     "reqBodyBufLen is greater than zero." ) );</div><div id="2269" class="line none"> 2269     }</div><div id="2270" class="line none"> 2270     else if( reqBodyBufLen &gt; ( size_t ) ( INT32_MAX ) )</div><div id="2271" class="line none"> 2271     {</div><div id="2272" class="line none"> 2272         /* This check is needed because convertInt32ToAscii() is used on the</div><div id="2273" class="line none"> 2273          * reqBodyBufLen to create a Content-Length header value string. */</div><div id="2274" class="line none"> 2274         LogError( ( "Parameter check failed: reqBodyBufLen &gt; INT32_MAX."</div><div id="2275" class="line none"> 2275                     "reqBodyBufLen=%lu",</div><div id="2276" class="line none"> 2276                     ( unsigned long ) reqBodyBufLen ) );</div><div id="2277" class="line none"> 2277     }</div><div id="2278" class="line none"> 2278     else</div><div id="2279" class="line none"> 2279     {</div><div id="2280" class="line none"> 2280         if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a> == NULL )</div><div id="2281" class="line none"> 2281         {</div><div id="2282" class="line none"> 2282             /* Set a zero timestamp function when the application did not configure</div><div id="2283" class="line none"> 2283              * one. */</div><div id="2284" class="line none"> 2284             <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a> = <a href="core_http_client.c.html#523">getZeroTimestampMs</a>;</div><div id="2285" class="line none"> 2285         }</div><div id="2286" class="line none"> 2286 </div><div id="2287" class="line none"> 2287         returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2288" class="line none"> 2288     }</div><div id="2289" class="line none"> 2289 </div><div id="2290" class="line none"> 2290     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="2291" class="line none"> 2291     {</div><div id="2292" class="line none"> 2292         returnStatus = <a href="core_http_client.c.html#2166">sendHttpRequest</a>( pTransport,</div><div id="2293" class="line none"> 2293                                         <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#510">getTime</a>,</div><div id="2294" class="line none"> 2294                                         pRequestHeaders,</div><div id="2295" class="line none"> 2295                                         pRequestBodyBuf,</div><div id="2296" class="line none"> 2296                                         reqBodyBufLen,</div><div id="2297" class="line none"> 2297                                         sendFlags );</div><div id="2298" class="line none"> 2298     }</div><div id="2299" class="line none"> 2299 </div><div id="2300" class="line none"> 2300     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="2301" class="line none"> 2301     {</div><div id="2302" class="line none"> 2302         returnStatus = <a href="core_http_client.c.html#2032">HTTPClient_ReceiveAndParseHttpResponse</a>( pTransport,</div><div id="2303" class="line none"> 2303                                                                <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="2304" class="line none"> 2304                                                                pRequestHeaders );</div><div id="2305" class="line none"> 2305     }</div><div id="2306" class="line none"> 2306 </div><div id="2307" class="line none"> 2307     return returnStatus;</div><div id="2308" class="line none"> 2308 }</div><div id="2309" class="line none"> 2309 </div><div id="2310" class="line none"> 2310 /*-----------------------------------------------------------*/</div><div id="2311" class="line none"> 2311 </div><div id="2312" class="line none"> 2312 static int <a href="core_http_client.c.html#2312">findHeaderFieldParserCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="2313" class="line none"> 2313                                           const char * pFieldLoc,</div><div id="2314" class="line none"> 2314                                           size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a> )</div><div id="2315" class="line none"> 2315 {</div><div id="2316" class="line none"> 2316     <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * <a href="include/core_http_client.h.html#453">pContext</a> = NULL;</div><div id="2317" class="line none"> 2317 </div><div id="2318" class="line none"> 2318     assert( pHttpParser != NULL );</div><div id="2319" class="line none"> 2319     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="2320" class="line none"> 2320     assert( pFieldLoc != NULL );</div><div id="2321" class="line none"> 2321     assert( <a href="include/core_http_client_private.h.html#225">fieldLen</a> &gt; 0U );</div><div id="2322" class="line none"> 2322 </div><div id="2323" class="line none"> 2323     <a href="include/core_http_client.h.html#453">pContext</a> = ( <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * ) pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a>;</div><div id="2324" class="line none"> 2324 </div><div id="2325" class="line none"> 2325     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a> != NULL );</div><div id="2326" class="line none"> 2326     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#225">fieldLen</a> &gt; 0U );</div><div id="2327" class="line none"> 2327 </div><div id="2328" class="line none"> 2328     /* The header found flags should not be set. */</div><div id="2329" class="line none"> 2329     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#228">fieldFound</a> == 0U );</div><div id="2330" class="line none"> 2330     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#229">valueFound</a> == 0U );</div><div id="2331" class="line none"> 2331 </div><div id="2332" class="line none"> 2332     /* Check whether the parsed header matches the header we are looking for. */</div><div id="2333" class="line none"> 2333     /* Each header field consists of a case-insensitive field name (RFC 7230, section 3.2). */</div><div id="2334" class="line none"> 2334     if( ( <a href="include/core_http_client_private.h.html#225">fieldLen</a> == <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#225">fieldLen</a> ) &amp;&amp;</div><div id="2335" class="line none"> 2335         ( <a href="core_http_client.c.html#529">caseInsensitiveStringCmp</a>( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a>, pFieldLoc, <a href="include/core_http_client_private.h.html#225">fieldLen</a> ) == 0 ) )</div><div id="2336" class="line none"> 2336     {</div><div id="2337" class="line none"> 2337         LogDebug( ( "Found header field in response: "</div><div id="2338" class="line none"> 2338                     "HeaderName=%.*s, HeaderLocation=0x%p",</div><div id="2339" class="line none"> 2339                     ( int ) <a href="include/core_http_client_private.h.html#225">fieldLen</a>, <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a>, pFieldLoc ) );</div><div id="2340" class="line none"> 2340 </div><div id="2341" class="line none"> 2341         /* Set the flag to indicate that header has been found in response. */</div><div id="2342" class="line none"> 2342         <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#228">fieldFound</a> = 1U;</div><div id="2343" class="line none"> 2343     }</div><div id="2344" class="line none"> 2344     else</div><div id="2345" class="line none"> 2345     {</div><div id="2346" class="line none"> 2346         /* Empty else for MISRA 15.7 compliance. */</div><div id="2347" class="line none"> 2347     }</div><div id="2348" class="line none"> 2348 </div><div id="2349" class="line none"> 2349     return <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="2350" class="line none"> 2350 }</div><div id="2351" class="line none"> 2351 </div><div id="2352" class="line none"> 2352 /*-----------------------------------------------------------*/</div><div id="2353" class="line none"> 2353 </div><div id="2354" class="line none"> 2354 static int <a href="core_http_client.c.html#2354">findHeaderValueParserCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser,</div><div id="2355" class="line none"> 2355                                           const char * <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="2356" class="line none"> 2356                                           size_t valueLen )</div><div id="2357" class="line none"> 2357 {</div><div id="2358" class="line hit"> 2358     int retCode = <a href="include/core_http_client_private.h.html#161">LLHTTP_CONTINUE_PARSING</a>;</div><div id="2359" class="line hit"> 2359     <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * <a href="include/core_http_client.h.html#453">pContext</a> = NULL;</div><div id="2360" class="line none"> 2360 </div><div id="2361" class="line hit"> 2361     assert( pHttpParser != NULL );</div><div id="2362" class="line hit"> 2362     assert( pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> != NULL );</div><div id="2363" class="line hit"> 2363     assert( <a href="include/core_http_client_private.h.html#226">pValueLoc</a> != NULL );</div><div id="2364" class="line none"> 2364 </div><div id="2365" class="line hit"> 2365     <a href="include/core_http_client.h.html#453">pContext</a> = ( <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * ) pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a>;</div><div id="2366" class="line none"> 2366 </div><div id="2367" class="line hit"> 2367     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a> != NULL );</div><div id="2368" class="line hit"> 2368     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#225">fieldLen</a> &gt; 0U );</div><div id="2369" class="line hit"> 2369     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#226">pValueLoc</a> != NULL );</div><div id="2370" class="line hit"> 2370     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#227">pValueLen</a> != NULL );</div><div id="2371" class="line none"> 2371 </div><div id="2372" class="line none"> 2372     /* The header value found flag should not be set. */</div><div id="2373" class="line hit"> 2373     assert( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#229">valueFound</a> == 0U );</div><div id="2374" class="line none"> 2374 </div><div id="2375" class="line hit"> 2375     if( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#228">fieldFound</a> == 1U )</div><div id="2376" class="line none"> 2376     {</div><div id="2377" class="line none"> 2377         LogDebug( ( "Found header value in response: "</div><div id="2378" class="line none"> 2378                     "RequestedField=%.*s, ValueLocation=0x%p",</div><div id="2379" class="line none"> 2379                     ( int ) ( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#225">fieldLen</a> ), <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a>, <a href="include/core_http_client_private.h.html#226">pValueLoc</a> ) );</div><div id="2380" class="line none"> 2380 </div><div id="2381" class="line hit"> 2381         if( valueLen &gt; 0U )</div><div id="2382" class="line none"> 2382         {</div><div id="2383" class="line none"> 2383             /* Populate the output parameters with the location of the header</div><div id="2384" class="line none"> 2384              * value in the response buffer. */</div><div id="2385" class="line hit"> 2385             *<a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#226">pValueLoc</a> = <a href="include/core_http_client_private.h.html#226">pValueLoc</a>;</div><div id="2386" class="line hit"> 2386             *<a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#227">pValueLen</a> = valueLen;</div><div id="2387" class="line hit"> 2387         }</div><div id="2388" class="line none"> 2388         else</div><div id="2389" class="line none"> 2389         {</div><div id="2390" class="line none"> 2390             /* It is not invalid according to RFC 2616 to have an empty header</div><div id="2391" class="line none"> 2391              * value. */</div><div id="2392" class="line hit"> 2392             *<a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#226">pValueLoc</a> = NULL;</div><div id="2393" class="line hit"> 2393             *<a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#227">pValueLen</a> = 0U;</div><div id="2394" class="line none"> 2394         }</div><div id="2395" class="line none"> 2395 </div><div id="2396" class="line none"> 2396         /* Set the header value found flag. */</div><div id="2397" class="line hit"> 2397         <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#229">valueFound</a> = 1U;</div><div id="2398" class="line none"> 2398 </div><div id="2399" class="line none"> 2399         /* As we have found the value associated with the header, we don't need</div><div id="2400" class="line none"> 2400          * to parse the response any further. */</div><div id="2401" class="line hit"> 2401         retCode = ( int ) <a href="include/core_http_client_private.h.html#167">LLHTTP_STOP_PARSING</a>;</div><div id="2402" class="line none"> 2402     }</div><div id="2403" class="line none"> 2403     else</div><div id="2404" class="line none"> 2404     {</div><div id="2405" class="line none"> 2405         /* Empty else for MISRA 15.7 compliance. */</div><div id="2406" class="line none"> 2406     }</div><div id="2407" class="line none"> 2407 </div><div id="2408" class="line hit"> 2408     return retCode;</div><div id="2409" class="line hit"> 2409 }</div><div id="2410" class="line none"> 2410 </div><div id="2411" class="line none"> 2411 /*-----------------------------------------------------------*/</div><div id="2412" class="line none"> 2412 </div><div id="2413" class="line none"> 2413 static int <a href="core_http_client.c.html#2413">findHeaderOnHeaderCompleteCallback</a>( <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> * pHttpParser )</div><div id="2414" class="line none"> 2414 {</div><div id="2415" class="line none"> 2415     const <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * <a href="include/core_http_client.h.html#453">pContext</a> = NULL;</div><div id="2416" class="line none"> 2416 </div><div id="2417" class="line none"> 2417     /* Disable unused parameter warning. */</div><div id="2418" class="line none"> 2418     ( void ) pHttpParser;</div><div id="2419" class="line none"> 2419     /* Disable unused variable warning. */</div><div id="2420" class="line none"> 2420     ( void ) <a href="include/core_http_client.h.html#453">pContext</a>;</div><div id="2421" class="line none"> 2421 </div><div id="2422" class="line none"> 2422     assert( pHttpParser != NULL );</div><div id="2423" class="line none"> 2423 </div><div id="2424" class="line none"> 2424     <a href="include/core_http_client.h.html#453">pContext</a> = ( <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> * ) pHttpParser-&gt;<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a>;</div><div id="2425" class="line none"> 2425 </div><div id="2426" class="line none"> 2426     /* If we have reached here, all headers in the response have been parsed but the requested</div><div id="2427" class="line none"> 2427      * header has not been found in the response buffer. */</div><div id="2428" class="line none"> 2428     LogDebug( ( "Reached end of header parsing: Header not found in response: "</div><div id="2429" class="line none"> 2429                 "RequestedHeader=%.*s",</div><div id="2430" class="line none"> 2430                 ( int ) ( <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#225">fieldLen</a> ),</div><div id="2431" class="line none"> 2431                 <a href="include/core_http_client.h.html#453">pContext</a>-&gt;<a href="include/core_http_client_private.h.html#224">pField</a> ) );</div><div id="2432" class="line none"> 2432 </div><div id="2433" class="line none"> 2433     /* No further parsing is required; thus, indicate the parser to stop parsing.</div><div id="2434" class="line none"> 2434      * The documentation for on_headers_complete states that this function can</div><div id="2435" class="line none"> 2435      * return 1 to indicate the response has no body, or -1 to indicate error.</div><div id="2436" class="line none"> 2436      * Returning 1 causes llhttp_execute() to exit with success, while -1</div><div id="2437" class="line none"> 2437      * causes it to return the HPE_CB_HEADERS_COMPLETE error code (in strict</div><div id="2438" class="line none"> 2438      * mode) or success (in non-strict mode). We are fine with the success</div><div id="2439" class="line none"> 2439      * return value, as llhttp_execute will not be invoked again in the same call.*/</div><div id="2440" class="line none"> 2440     return <a href="include/core_http_client_private.h.html#188">LLHTTP_STOP_PARSING_NO_HEADER</a>;</div><div id="2441" class="line none"> 2441 }</div><div id="2442" class="line none"> 2442 </div><div id="2443" class="line none"> 2443 /*-----------------------------------------------------------*/</div><div id="2444" class="line none"> 2444 </div><div id="2445" class="line none"> 2445 static <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2445">findHeaderInResponse</a>( const uint8_t * <a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="2446" class="line none"> 2446                                           size_t <a href="include/core_http_client.h.html#381">bufferLen</a>,</div><div id="2447" class="line none"> 2447                                           const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="2448" class="line none"> 2448                                           size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2449" class="line none"> 2449                                           const char ** <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="2450" class="line none"> 2450                                           size_t * <a href="include/core_http_client_private.h.html#227">pValueLen</a> )</div><div id="2451" class="line none"> 2451 {</div><div id="2452" class="line none"> 2452     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2453" class="line none"> 2453     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#324">llhttp_t</a> parser = { 0 };</div><div id="2454" class="line none"> 2454     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#325">llhttp_settings_t</a> parserSettings = { 0 };</div><div id="2455" class="line none"> 2455     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#86">llhttp_errno_t</a> parserErrno;</div><div id="2456" class="line none"> 2456     <a href="include/core_http_client_private.h.html#230">findHeaderContext_t</a> context = { 0 };</div><div id="2457" class="line none"> 2457 </div><div id="2458" class="line none"> 2458     context.<a href="include/core_http_client_private.h.html#224">pField</a> = <a href="include/core_http_client_private.h.html#224">pField</a>;</div><div id="2459" class="line none"> 2459     context.<a href="include/core_http_client_private.h.html#225">fieldLen</a> = <a href="include/core_http_client_private.h.html#225">fieldLen</a>;</div><div id="2460" class="line none"> 2460     context.<a href="include/core_http_client_private.h.html#226">pValueLoc</a> = <a href="include/core_http_client_private.h.html#226">pValueLoc</a>;</div><div id="2461" class="line none"> 2461     context.<a href="include/core_http_client_private.h.html#227">pValueLen</a> = <a href="include/core_http_client_private.h.html#227">pValueLen</a>;</div><div id="2462" class="line none"> 2462     context.<a href="include/core_http_client_private.h.html#228">fieldFound</a> = 0U;</div><div id="2463" class="line none"> 2463     context.<a href="include/core_http_client_private.h.html#229">valueFound</a> = 0U;</div><div id="2464" class="line none"> 2464 </div><div id="2465" class="line none"> 2465     /* The intention here to define callbacks just for searching the headers. We will</div><div id="2466" class="line none"> 2466      * need to create a private context in llhttp-&gt;data that has the field and</div><div id="2467" class="line none"> 2467      * value to update and pass back. */</div><div id="2468" class="line none"> 2468     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#416">llhttp_settings_init</a>( &amp;parserSettings );</div><div id="2469" class="line none"> 2469     parserSettings.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#337">on_header_field</a> = <a href="core_http_client.c.html#2312">findHeaderFieldParserCallback</a>;</div><div id="2470" class="line none"> 2470     parserSettings.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#338">on_header_value</a> = <a href="core_http_client.c.html#2354">findHeaderValueParserCallback</a>;</div><div id="2471" class="line none"> 2471     parserSettings.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#349">on_headers_complete</a> = <a href="core_http_client.c.html#2413">findHeaderOnHeaderCompleteCallback</a>;</div><div id="2472" class="line none"> 2472     <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#381">llhttp_init</a>( &amp;parser, <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#113">HTTP_RESPONSE</a>, &amp;parserSettings );</div><div id="2473" class="line none"> 2473 </div><div id="2474" class="line none"> 2474     /* Set the context for the parser. */</div><div id="2475" class="line none"> 2475     parser.<a href="dependency/3rdparty/llhttp/include/llhttp.h.html#28">data</a> = &amp;context;</div><div id="2476" class="line none"> 2476 </div><div id="2477" class="line none"> 2477     /* Search for the desired header. */</div><div id="2478" class="line none"> 2478     parserErrno = <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#435">llhttp_execute</a>( &amp;parser, ( const char * ) <a href="include/core_http_client.h.html#380">pBuffer</a>, <a href="include/core_http_client.h.html#381">bufferLen</a> );</div><div id="2479" class="line none"> 2479 </div><div id="2480" class="line none"> 2480     if( context.<a href="include/core_http_client_private.h.html#228">fieldFound</a> == 0U )</div><div id="2481" class="line none"> 2481     {</div><div id="2482" class="line none"> 2482         /* If header field is not found, then both the flags should be zero. */</div><div id="2483" class="line none"> 2483         assert( context.<a href="include/core_http_client_private.h.html#229">valueFound</a> == 0U );</div><div id="2484" class="line none"> 2484 </div><div id="2485" class="line none"> 2485         /* Header is not present in buffer. */</div><div id="2486" class="line none"> 2486         LogWarn( ( "Header not found in response buffer: RequestedHeader=%.*s",</div><div id="2487" class="line none"> 2487                    ( int ) <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2488" class="line none"> 2488                    <a href="include/core_http_client_private.h.html#224">pField</a> ) );</div><div id="2489" class="line none"> 2489 </div><div id="2490" class="line none"> 2490         returnStatus = <a href="include/core_http_client.h.html#341">HTTPHeaderNotFound</a>;</div><div id="2491" class="line none"> 2491     }</div><div id="2492" class="line none"> 2492     else if( context.<a href="include/core_http_client_private.h.html#229">valueFound</a> == 0U )</div><div id="2493" class="line none"> 2493     {</div><div id="2494" class="line none"> 2494         /* The response buffer is invalid as only the header field was found</div><div id="2495" class="line none"> 2495          * in the "&lt;field&gt;: &lt;value&gt;\r\n" format of an HTTP header. */</div><div id="2496" class="line none"> 2496         LogError( ( "Unable to find header value in response: "</div><div id="2497" class="line none"> 2497                     "Response data is invalid: "</div><div id="2498" class="line none"> 2498                     "RequestedHeader=%.*s, ParserError=%s %s",</div><div id="2499" class="line none"> 2499                     ( int ) <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2500" class="line none"> 2500                     <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="2501" class="line none"> 2501                     llhttp_errno_name( parserErrno ),</div><div id="2502" class="line none"> 2502                     llhttp_get_error_reason( &amp;parser ) ) );</div><div id="2503" class="line none"> 2503         returnStatus = <a href="include/core_http_client.h.html#350">HTTPInvalidResponse</a>;</div><div id="2504" class="line none"> 2504     }</div><div id="2505" class="line none"> 2505     else</div><div id="2506" class="line none"> 2506     {</div><div id="2507" class="line none"> 2507         /* Header is found. */</div><div id="2508" class="line none"> 2508         assert( ( context.<a href="include/core_http_client_private.h.html#228">fieldFound</a> == 1U ) &amp;&amp; ( context.<a href="include/core_http_client_private.h.html#229">valueFound</a> == 1U ) );</div><div id="2509" class="line none"> 2509 </div><div id="2510" class="line none"> 2510         LogDebug( ( "Found requested header in response: "</div><div id="2511" class="line none"> 2511                     "HeaderName=%.*s, HeaderValue=%.*s",</div><div id="2512" class="line none"> 2512                     ( int ) <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2513" class="line none"> 2513                     <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="2514" class="line none"> 2514                     ( int ) ( *<a href="include/core_http_client_private.h.html#227">pValueLen</a> ),</div><div id="2515" class="line none"> 2515                     *<a href="include/core_http_client_private.h.html#226">pValueLoc</a> ) );</div><div id="2516" class="line none"> 2516         returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2517" class="line none"> 2517     }</div><div id="2518" class="line none"> 2518 </div><div id="2519" class="line none"> 2519     /* If the header field-value pair is found in response, then the return</div><div id="2520" class="line none"> 2520      * value of the on_header_value callback should set the llhttp.error to</div><div id="2521" class="line none"> 2521      * HPE_USER. */</div><div id="2522" class="line none"> 2522     if( ( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> ) &amp;&amp;</div><div id="2523" class="line none"> 2523         ( parserErrno != <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#84">HPE_USER</a> ) )</div><div id="2524" class="line none"> 2524     {</div><div id="2525" class="line none"> 2525         LogError( ( "Header found in response but llhttp returned error: "</div><div id="2526" class="line none"> 2526                     "ParserError=%s %s",</div><div id="2527" class="line none"> 2527                     llhttp_errno_name( parserErrno ),</div><div id="2528" class="line none"> 2528                     llhttp_get_error_reason( &amp;parser ) ) );</div><div id="2529" class="line none"> 2529         returnStatus = <a href="include/core_http_client.h.html#333">HTTPParserInternalError</a>;</div><div id="2530" class="line none"> 2530     }</div><div id="2531" class="line none"> 2531 </div><div id="2532" class="line none"> 2532     /* If header was not found, then the "on_header_complete" callback is</div><div id="2533" class="line none"> 2533      * expected to be called which should set the llhttp.error to HPE_OK. */</div><div id="2534" class="line none"> 2534     else if( ( returnStatus == <a href="include/core_http_client.h.html#341">HTTPHeaderNotFound</a> ) &amp;&amp;</div><div id="2535" class="line none"> 2535              ( parserErrno != <a href="dependency/3rdparty/llhttp/include/llhttp.h.html#59">HPE_OK</a> ) )</div><div id="2536" class="line none"> 2536     {</div><div id="2537" class="line none"> 2537         LogError( ( "Header not found in response: llhttp returned error: "</div><div id="2538" class="line none"> 2538                     "ParserError=%s %s",</div><div id="2539" class="line none"> 2539                     llhttp_errno_name( parserErrno ),</div><div id="2540" class="line none"> 2540                     llhttp_get_error_reason( &amp;parser ) ) );</div><div id="2541" class="line none"> 2541         returnStatus = <a href="include/core_http_client.h.html#350">HTTPInvalidResponse</a>;</div><div id="2542" class="line none"> 2542     }</div><div id="2543" class="line none"> 2543     else</div><div id="2544" class="line none"> 2544     {</div><div id="2545" class="line none"> 2545         /* Empty else for MISRA 15.7 compliance. */</div><div id="2546" class="line none"> 2546     }</div><div id="2547" class="line none"> 2547 </div><div id="2548" class="line none"> 2548     return returnStatus;</div><div id="2549" class="line none"> 2549 }</div><div id="2550" class="line none"> 2550 </div><div id="2551" class="line none"> 2551 /*-----------------------------------------------------------*/</div><div id="2552" class="line none"> 2552 </div><div id="2553" class="line none"> 2553 <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> <a href="core_http_client.c.html#2553">HTTPClient_ReadHeader</a>( const <a href="include/core_http_client.h.html#584">HTTPResponse_t</a> * <a href="include/core_http_client_private.h.html#300">pResponse</a>,</div><div id="2554" class="line none"> 2554                                     const char * <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="2555" class="line none"> 2555                                     size_t <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2556" class="line none"> 2556                                     const char ** <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="2557" class="line none"> 2557                                     size_t * <a href="include/core_http_client_private.h.html#227">pValueLen</a> )</div><div id="2558" class="line none"> 2558 {</div><div id="2559" class="line none"> 2559     <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> returnStatus = <a href="include/core_http_client.h.html#207">HTTPSuccess</a>;</div><div id="2560" class="line none"> 2560 </div><div id="2561" class="line none"> 2561     if( <a href="include/core_http_client_private.h.html#300">pResponse</a> == NULL )</div><div id="2562" class="line none"> 2562     {</div><div id="2563" class="line none"> 2563         LogError( ( "Parameter check failed: pResponse is NULL." ) );</div><div id="2564" class="line none"> 2564         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2565" class="line none"> 2565     }</div><div id="2566" class="line none"> 2566     else if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a> == NULL )</div><div id="2567" class="line none"> 2567     {</div><div id="2568" class="line none"> 2568         LogError( ( "Parameter check failed: pResponse-&gt;pBuffer is NULL." ) );</div><div id="2569" class="line none"> 2569         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2570" class="line none"> 2570     }</div><div id="2571" class="line none"> 2571     else if( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a> == 0U )</div><div id="2572" class="line none"> 2572     {</div><div id="2573" class="line none"> 2573         LogError( ( "Parameter check failed: pResponse-&gt;bufferLen is 0: "</div><div id="2574" class="line none"> 2574                     "Buffer len should be &gt; 0." ) );</div><div id="2575" class="line none"> 2575         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2576" class="line none"> 2576     }</div><div id="2577" class="line none"> 2577     else if( <a href="include/core_http_client_private.h.html#224">pField</a> == NULL )</div><div id="2578" class="line none"> 2578     {</div><div id="2579" class="line none"> 2579         LogError( ( "Parameter check failed: Input header name is NULL." ) );</div><div id="2580" class="line none"> 2580         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2581" class="line none"> 2581     }</div><div id="2582" class="line none"> 2582     else if( <a href="include/core_http_client_private.h.html#225">fieldLen</a> == 0U )</div><div id="2583" class="line none"> 2583     {</div><div id="2584" class="line none"> 2584         LogError( ( "Parameter check failed: Input header name length is 0: "</div><div id="2585" class="line none"> 2585                     "fieldLen should be &gt; 0." ) );</div><div id="2586" class="line none"> 2586         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2587" class="line none"> 2587     }</div><div id="2588" class="line none"> 2588     else if( <a href="include/core_http_client_private.h.html#226">pValueLoc</a> == NULL )</div><div id="2589" class="line none"> 2589     {</div><div id="2590" class="line none"> 2590         LogError( ( "Parameter check failed: Output parameter for header value location is NULL." ) );</div><div id="2591" class="line none"> 2591         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2592" class="line none"> 2592     }</div><div id="2593" class="line none"> 2593     else if( <a href="include/core_http_client_private.h.html#227">pValueLen</a> == NULL )</div><div id="2594" class="line none"> 2594     {</div><div id="2595" class="line none"> 2595         LogError( ( "Parameter check failed: Output parameter for header value length is NULL." ) );</div><div id="2596" class="line none"> 2596         returnStatus = <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>;</div><div id="2597" class="line none"> 2597     }</div><div id="2598" class="line none"> 2598     else</div><div id="2599" class="line none"> 2599     {</div><div id="2600" class="line none"> 2600         /* Empty else for MISRA 15.7 compliance. */</div><div id="2601" class="line none"> 2601     }</div><div id="2602" class="line none"> 2602 </div><div id="2603" class="line none"> 2603     if( returnStatus == <a href="include/core_http_client.h.html#207">HTTPSuccess</a> )</div><div id="2604" class="line none"> 2604     {</div><div id="2605" class="line none"> 2605         returnStatus = <a href="core_http_client.c.html#2445">findHeaderInResponse</a>( <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#380">pBuffer</a>,</div><div id="2606" class="line none"> 2606                                              <a href="include/core_http_client_private.h.html#300">pResponse</a>-&gt;<a href="include/core_http_client.h.html#381">bufferLen</a>,</div><div id="2607" class="line none"> 2607                                              <a href="include/core_http_client_private.h.html#224">pField</a>,</div><div id="2608" class="line none"> 2608                                              <a href="include/core_http_client_private.h.html#225">fieldLen</a>,</div><div id="2609" class="line none"> 2609                                              <a href="include/core_http_client_private.h.html#226">pValueLoc</a>,</div><div id="2610" class="line none"> 2610                                              <a href="include/core_http_client_private.h.html#227">pValueLen</a> );</div><div id="2611" class="line none"> 2611     }</div><div id="2612" class="line none"> 2612 </div><div id="2613" class="line none"> 2613     return returnStatus;</div><div id="2614" class="line none"> 2614 }</div><div id="2615" class="line none"> 2615 </div><div id="2616" class="line none"> 2616 /*-----------------------------------------------------------*/</div><div id="2617" class="line none"> 2617 </div><div id="2618" class="line none"> 2618 const char * <a href="core_http_client.c.html#2618">HTTPClient_strerror</a>( <a href="include/core_http_client.h.html#351">HTTPStatus_t</a> status )</div><div id="2619" class="line none"> 2619 {</div><div id="2620" class="line none"> 2620     const char * str = NULL;</div><div id="2621" class="line none"> 2621 </div><div id="2622" class="line none"> 2622     switch( status )</div><div id="2623" class="line none"> 2623     {</div><div id="2624" class="line none"> 2624         case <a href="include/core_http_client.h.html#207">HTTPSuccess</a>:</div><div id="2625" class="line none"> 2625             str = "HTTPSuccess";</div><div id="2626" class="line none"> 2626             break;</div><div id="2627" class="line none"> 2627 </div><div id="2628" class="line none"> 2628         case <a href="include/core_http_client.h.html#219">HTTPInvalidParameter</a>:</div><div id="2629" class="line none"> 2629             str = "HTTPInvalidParameter";</div><div id="2630" class="line none"> 2630             break;</div><div id="2631" class="line none"> 2631 </div><div id="2632" class="line none"> 2632         case <a href="include/core_http_client.h.html#227">HTTPNetworkError</a>:</div><div id="2633" class="line none"> 2633             str = "HTTPNetworkError";</div><div id="2634" class="line none"> 2634             break;</div><div id="2635" class="line none"> 2635 </div><div id="2636" class="line none"> 2636         case <a href="include/core_http_client.h.html#235">HTTPPartialResponse</a>:</div><div id="2637" class="line none"> 2637             str = "HTTPPartialResponse";</div><div id="2638" class="line none"> 2638             break;</div><div id="2639" class="line none"> 2639 </div><div id="2640" class="line none"> 2640         case <a href="include/core_http_client.h.html#246">HTTPNoResponse</a>:</div><div id="2641" class="line none"> 2641             str = "HTTPNoResponse";</div><div id="2642" class="line none"> 2642             break;</div><div id="2643" class="line none"> 2643 </div><div id="2644" class="line none"> 2644         case <a href="include/core_http_client.h.html#258">HTTPInsufficientMemory</a>:</div><div id="2645" class="line none"> 2645             str = "HTTPInsufficientMemory";</div><div id="2646" class="line none"> 2646             break;</div><div id="2647" class="line none"> 2647 </div><div id="2648" class="line none"> 2648         case <a href="include/core_http_client.h.html#267">HTTPSecurityAlertExtraneousResponseData</a>:</div><div id="2649" class="line none"> 2649             str = "HTTPSecurityAlertExtraneousResponseData";</div><div id="2650" class="line none"> 2650             break;</div><div id="2651" class="line none"> 2651 </div><div id="2652" class="line none"> 2652         case <a href="include/core_http_client.h.html#275">HTTPSecurityAlertInvalidChunkHeader</a>:</div><div id="2653" class="line none"> 2653             str = "HTTPSecurityAlertInvalidChunkHeader";</div><div id="2654" class="line none"> 2654             break;</div><div id="2655" class="line none"> 2655 </div><div id="2656" class="line none"> 2656         case <a href="include/core_http_client.h.html#284">HTTPSecurityAlertInvalidProtocolVersion</a>:</div><div id="2657" class="line none"> 2657             str = "HTTPSecurityAlertInvalidProtocolVersion";</div><div id="2658" class="line none"> 2658             break;</div><div id="2659" class="line none"> 2659 </div><div id="2660" class="line none"> 2660         case <a href="include/core_http_client.h.html#293">HTTPSecurityAlertInvalidStatusCode</a>:</div><div id="2661" class="line none"> 2661             str = "HTTPSecurityAlertInvalidStatusCode";</div><div id="2662" class="line none"> 2662             break;</div><div id="2663" class="line none"> 2663 </div><div id="2664" class="line none"> 2664         case <a href="include/core_http_client.h.html#303">HTTPSecurityAlertInvalidCharacter</a>:</div><div id="2665" class="line none"> 2665             str = "HTTPSecurityAlertInvalidCharacter";</div><div id="2666" class="line none"> 2666             break;</div><div id="2667" class="line none"> 2667 </div><div id="2668" class="line none"> 2668         case <a href="include/core_http_client.h.html#313">HTTPSecurityAlertInvalidContentLength</a>:</div><div id="2669" class="line none"> 2669             str = "HTTPSecurityAlertInvalidContentLength";</div><div id="2670" class="line none"> 2670             break;</div><div id="2671" class="line none"> 2671 </div><div id="2672" class="line none"> 2672         case <a href="include/core_http_client.h.html#324">HTTPParserPaused</a>:</div><div id="2673" class="line none"> 2673             str = "HTTPParserPaused";</div><div id="2674" class="line none"> 2674             break;</div><div id="2675" class="line none"> 2675 </div><div id="2676" class="line none"> 2676         case <a href="include/core_http_client.h.html#333">HTTPParserInternalError</a>:</div><div id="2677" class="line none"> 2677             str = "HTTPParserInternalError";</div><div id="2678" class="line none"> 2678             break;</div><div id="2679" class="line none"> 2679 </div><div id="2680" class="line none"> 2680         case <a href="include/core_http_client.h.html#341">HTTPHeaderNotFound</a>:</div><div id="2681" class="line none"> 2681             str = "HTTPHeaderNotFound";</div><div id="2682" class="line none"> 2682             break;</div><div id="2683" class="line none"> 2683 </div><div id="2684" class="line none"> 2684         case <a href="include/core_http_client.h.html#350">HTTPInvalidResponse</a>:</div><div id="2685" class="line none"> 2685             str = "HTTPInvalidResponse";</div><div id="2686" class="line none"> 2686             break;</div><div id="2687" class="line none"> 2687 </div><div id="2688" class="line none"> 2688         default:</div><div id="2689" class="line none"> 2689             LogWarn( ( "Invalid status code received for string conversion: "</div><div id="2690" class="line none"> 2690                        "StatusCode=%d", ( int ) status ) );</div><div id="2691" class="line none"> 2691             break;</div><div id="2692" class="line none"> 2692     }</div><div id="2693" class="line none"> 2693 </div><div id="2694" class="line none"> 2694     return str;</div><div id="2695" class="line none"> 2695 }</div><div id="2696" class="line none"> 2696 </div><div id="2697" class="line none"> 2697 /*-----------------------------------------------------------*/</div>
</div>
</body>
</html>
